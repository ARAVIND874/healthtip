<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>роЖро░рпЛроХрпНроХро┐роп рокропройрпНрокро╛роЯрпБ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for Tamil -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil:wght@400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans Tamil', sans-serif;
            transition: background-color 0.5s ease;
        }
        .pain-map-svg .body-part:hover {
            fill: #4299e1;
            cursor: pointer;
        }
        .fixed-bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        .pain-map-container {
            width: 100%;
            max-width: 400px;
            height: auto;
            margin: 0 auto;
        }
        .pain-map-svg path {
            fill: #6b7280; /* Default gray color for body parts */
            transition: fill 0.3s ease;
        }
        .pain-map-svg path.pain {
            fill: #ef4444; /* Red color for a selected painful area */
        }
    </style>
</head>
<body class="bg-gray-100 antialiased text-gray-800">

<!-- Main application container -->
<div id="app" class="min-h-screen flex flex-col items-center justify-center p-4"></div>

<!-- Fixed bottom bar for navigation. The layout is centered now. -->
<div id="bottom-bar" class="fixed-bottom-bar flex justify-center items-center gap-4 p-4 hidden">
    <!-- Content for this bar will be dynamically updated by JavaScript -->
</div>

<!-- Custom Message Box -->
<div id="message-box" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center p-4 z-50">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
        <p class="text-lg font-medium text-gray-800 text-center" id="message-text"></p>
        <button onclick="closeMessageBox()" class="mt-4 w-full py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
            роЪро░ро┐
        </button>
    </div>
</div>

<script type="module">
    // Language translations in Tamil and English
    const translations = {
        'ta': {
            loginTitle : 'ЁЯФТроЙро│рпНроирпБро┤рпИроХ',
            usernamePlaceholder: 'рокропройро░рпН рокрпЖропро░рпН',
            passwordPlaceholder: 'роХроЯро╡рпБроЪрпНроЪрпКро▓рпН',
            loginButton: 'роЙро│рпНроирпБро┤рпИроп',
            loginError: 'родропро╡рпБроЪрпЖропрпНродрпБ рокропройро░рпН рокрпЖропро░рпН рооро▒рпНро▒рпБроорпН роХроЯро╡рпБроЪрпНроЪрпКро▓рпНро▓рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН.',
            allFeaturesTitle: 'роЕройрпИродрпНродрпБ роЖро░рпЛроХрпНроХро┐роп роЕроорпНроЪроЩрпНроХро│рпН',
            backToFeatures: 'роЕроорпНроЪроЩрпНроХро│рпБроХрпНроХрпБ родро┐ро░рпБроорпНрокрпБ',
            featureNotDeveloped: 'роЗроирпНрод роЕроорпНроЪроорпН роЗройрпНройрпБроорпН роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ.',
            mainMenuTitle: 'роорпБроХрпНроХро┐роп роорпЖройрпБ',
            stepTracker: 'рокроЯро┐ роХрогрпНроХро╛рогро┐рокрпНрокрпБ',
            heartRate: 'роЗродропродрпН родрпБроЯро┐рокрпНрокрпБ',
            waterIntake: 'роирпАро░рпН роЙроЯрпНроХрпКро│рпНро│ро▓рпН',
            moodJournal: 'рооройроиро┐ро▓рпИ & роиройрпНро▒ро┐ропрпБрогро░рпНро╡рпБ роиро╛роЯрпНроХрпБро▒ро┐рокрпНрокрпБ',
            medicationReminder: 'рооро░рпБроирпНродрпБ роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпН',
            foodPlan: 'роЙрогро╡рпБродрпН родро┐роЯрпНроЯроорпН',
            exerciseYoga: 'роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ & ропрпЛроХро╛',
            bodyPainMap: 'роЙроЯро▓рпН ро╡ро▓ро┐ ро╡ро░рпИрокроЯроорпН',
            generalTips: 'рокрпКродрпБро╡ро╛рой роЪрпБроХро╛родро╛ро░ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН',
            localTips: 'роЙро│рпНро│рпВро░рпН роЪрпБроХро╛родро╛ро░ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН',
            beautyTips: 'ро╡рпАроЯрпНроЯрпБ роЕро┤роХрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН',
            symptomFinder: 'роЕро▒ро┐роХрпБро▒ро┐роХро│рпН роХрогрпНроЯрпБрокро┐роЯро┐рокрпНрокрпБ AI',
            firstAid: 'роорпБродро▓рпБродро╡ро┐ & роЕро╡роЪро░роорпН',
            foodRecipes: 'роЙрогро╡рпБ роЪрпЖропрпНроорпБро▒рпИроХро│рпН',
            search: 'родрпЗроЯрпБ',
            submit: 'роЪрооро░рпНрокрпНрокро┐',
            yourTipHere: 'роЙроЩрпНроХро│рпН роХрпБро▒ро┐рокрпНрокрпБ роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН.',
            noRecipe: 'роЪрпЖропрпНроорпБро▒рпИ роОродрпБро╡рпБроорпН роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ. роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН.',
            loadingMessage: 'AI роХрпБро▒ро┐рокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроХро┐ро▒родрпБ...',
            inputPlaceholderGeneral: 'роирпАроЩрпНроХро│рпН ро╡ро┐ро░рпБроорпНрокрпБроорпН рокрпКродрпБро╡ро╛рой роЪрпБроХро╛родро╛ро░ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            inputPlaceholderBeauty: 'роирпАроЩрпНроХро│рпН ро╡ро┐ро░рпБроорпНрокрпБроорпН роЕро┤роХрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            inputPlaceholderLocal: 'роирпАроЩрпНроХро│рпН ро╡ро┐ро░рпБроорпНрокрпБроорпН роЙро│рпНро│рпВро░рпН роЪрпБроХро╛родро╛ро░ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            inputPlaceholderSymptom: 'роЙроЩрпНроХро│рпН роЕро▒ро┐роХрпБро▒ро┐роХро│рпН рокро▒рпНро▒ро┐роп родроХро╡ро▓рпНроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            inputPlaceholderRecipes: 'роТро░рпБ роЙрогро╡ро┐ройрпН рокрпЖропро░рпН роЕро▓рпНро▓родрпБ роорпВро▓рокрпНрокрпКро░рпБроЯрпНроХро│рпИ роЙро│рпНро│ро┐роЯрпНроЯрпБ роЪрпЖропрпНроорпБро▒рпИропрпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            getTip: 'роХрпБро▒ро┐рокрпНрокрпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН',
            stepsCount: 'рокроЯро┐роХро│рпН: ',
            startTracking: 'роХрогрпНроХро╛рогро┐рокрпНрокрпИ родрпКроЯроЩрпНроХрпБ',
            stopTracking: 'роХрогрпНроХро╛рогро┐рокрпНрокрпИ роиро┐ро▒рпБродрпНродрпБ',
            reset: 'рокроЯро┐роХро│рпИ роорпАроЯрпНроЯроорпИ',
            stepMotivation: 'роТро░рпБ роиро╛ро│рпИроХрпНроХрпБ 10,000 рокроЯро┐роХро│рпН роироЯрокрпНрокродрпБ роЙроЩрпНроХро│рпН роЖро░рпЛроХрпНроХро┐ропродрпНродрпИ роХрогро┐роЪрооро╛роХ роорпЗроорпНрокроЯрпБродрпНродрпБроорпН.',
            journalPrompt: 'роЙроЩрпНроХро│рпН рооройроиро┐ро▓рпИропрпИропрпБроорпН, роирпАроЩрпНроХро│рпН роиройрпНро▒ро┐ропрпБро│рпНро│ ро╡ро┐ро╖ропроЩрпНроХро│рпИропрпБроорпН родро┐ройроорпБроорпН рокродро┐ро╡рпБ роЪрпЖропрпНропрпБроЩрпНроХро│рпН.',
            moodSelect: '-- рооройроиро┐ро▓рпИропрпИродрпН родрпЗро░рпНро╡рпБроЪрпЖропрпНропро╡рпБроорпН --',
            moodHappy: 'роороХро┐ро┤рпНроЪрпНроЪро┐',
            moodSad: 'роЪрпЛроХроорпН',
            moodNormal: 'роЪро╛родро╛ро░рогроорпН',
            moodAnxious: 'рокродроЯрпНроЯроорпН',
            moodGrateful: 'роиройрпНро▒ро┐ропрпБрогро░рпНро╡рпБ',
            saveEntry: 'рокродро┐ро╡рпИ роЪрпЗрооро┐',
            analyzeMood: 'рооройроиро┐ро▓рпИропрпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпН',
            moodAnalysis: 'рооройроиро┐ро▓рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ',
            moodAnalysisPlaceholder: 'роЙроЩрпНроХро│рпН рооройроиро┐ро▓рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН.',
            yourEntries: 'роЙроЩрпНроХро│рпН рокродро┐ро╡рпБроХро│рпН',
            entriesPlaceholder: 'роЙроЩрпНроХро│рпН роиро╛роЯрпНроХрпБро▒ро┐рокрпНрокрпБ рокродро┐ро╡рпБроХро│рпН роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН.',
            foodPlanPrompt: 'роЙроЩрпНроХро│рпН роЙрогро╡рпБ, роЙроЯро▓рпНроиро▓роорпН, роТро╡рпНро╡ро╛роорпИ роЕро▓рпНро▓родрпБ рокро┐ро░роЪрпНроЪройрпИропрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН.',
            painMapPrompt: 'роЙроЯро▓ро┐ройрпН роОроирпНродрокрпН рокроХрпБродро┐ропро┐ро▓рпН ро╡ро▓ро┐ роЗро░рпБроХрпНроХро┐ро▒родрпЛ, роЕродрпИродрпН родрпКроЯрпНроЯрпБ ро╡ро▓ро┐ рооро▒рпНро▒рпБроорпН роЕродройрпН ро╡ро┐ро│роХрпНроХродрпНродрпИ роЪрпЗро░рпНроХрпНроХро╡рпБроорпН.',
            removePain: 'роирпАроЩрпНроХро│рпН роЕродрпИ роорпАрогрпНроЯрпБроорпН роЕро┤рпБродрпНродро┐ройро╛ро▓рпН ро╡ро▓ро┐ роирпАроХрпНроХрокрпНрокроЯрпБроорпН.',
            aiTipTitle: 'AI роЙродро╡ро┐роХрпНроХрпБро▒ро┐рокрпНрокрпБ',
            firstAidPrompt: 'роЕро╡роЪро░ роХро╛ро▓роЩрпНроХро│ро┐ро▓рпН роЙродро╡ро┐роХро│рпН рооро▒рпНро▒рпБроорпН родроХро╡ро▓рпНроХро│рпИ рокрпЖро▒ро╡рпБроорпН.',
            emergencyContacts: 'роЕро╡роЪро░ родрпКроЯро░рпНрокрпБроХро│рпН',
            addContact: 'родрпКроЯро░рпНрокрпИ роЪрпЗро░рпН',
            noContacts: 'роЕро╡роЪро░ родрпКроЯро░рпНрокрпБроХро│рпН роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ.',
            symptomPrompt: 'роЙроЩрпНроХро│рпН роЕро▒ро┐роХрпБро▒ро┐роХро│рпН рокро▒рпНро▒ро┐роп родроХро╡ро▓рпНроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            exercisePrompt: 'роЙроЩрпНроХро│рпН роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐, ро╡ро▓ро┐ роЕро▓рпНро▓родрпБ рокро┐ро░роЪрпНроЪройрпИроХрпНроХро╛рой ропрпЛроЪройрпИроХро│рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН.',
            painPromptPrefix: 'роЗроирпНрод роЙроЯро▒рпНрокроХрпБродро┐ ро╡ро▓ро┐роХрпНроХрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН:',
            painMapTipInstructions: 'ро╡ро▓ро┐ роЙро│рпНро│ рокроХрпБродро┐ропрпИродрпН родрпКроЯрпНроЯрпБ, роЕродройрпН рокро▒рпНро▒ро┐роп роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            genericPainTip: 'роЙроЯро▓рпН ро╡ро▓ро┐роХрпНроХрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒ роТро░рпБ роЙроЯро▓рпН рокроХрпБродро┐ропрпИродрпН родрпКроЯро╡рпБроорпН.',
            micListening: 'роХрпЗроЯрпНроХро┐ро▒родрпБ...',
            micStopped: 'роорпИроХрпНро░рпЛроГрокрпЛройрпН роиро┐ро▒рпБродрпНродро┐ро╡ро┐роЯрпНроЯродрпБ.',
            speakTip: 'роХрпБро▒ро┐рокрпНрокрпИрокрпН рокрпЗроЪро╡рпБроорпН',
            stopSpeaking: 'рокрпЗроЪрпБро╡родрпИ роиро┐ро▒рпБродрпНродро╡рпБроорпН',
        },
        'en': {
            loginTitle: 'ЁЯФТLogin',
            usernamePlaceholder: 'Username',
            passwordPlaceholder: 'Password',
            loginButton: 'Log In',
            loginError: 'Please enter a username and password.',
            allFeaturesTitle: 'All Health Features',
            backToFeatures: 'Back to Features',
            featureNotDeveloped: 'This feature is not yet developed.',
            mainMenuTitle: 'Main Menu',
            stepTracker: 'Step Tracker',
            heartRate: 'Heart Rate',
            waterIntake: 'Water Intake',
            moodJournal: 'Mood & Gratitude Journal',
            medicationReminder: 'Medication Reminder',
            foodPlan: 'Food Plan',
            exerciseYoga: 'Exercise & Yoga',
            bodyPainMap: 'Body Pain Map',
            generalTips: 'General Health Tips',
            localTips: 'Local Health Tips',
            beautyTips: 'Home Beauty Tips',
            symptomFinder: 'Symptom Finder AI',
            firstAid: 'First Aid & Emergency',
            foodRecipes: 'Food Recipes',
            search: 'Search',
            submit: 'Submit',
            yourTipHere: 'Your tip will appear here.',
            noRecipe: 'No recipe available. Please try again.',
            loadingMessage: 'Generating AI tip...',
            inputPlaceholderGeneral: 'Get the general health tips you want.',
            inputPlaceholderBeauty: 'Get the beauty tips you want.',
            inputPlaceholderLocal: 'Get the local health tips you want.',
            inputPlaceholderSymptom: 'Get information about your symptoms.',
            inputPlaceholderRecipes: 'Enter a food name or ingredients to get the recipe.',
            getTip: 'Get Tips',
            stepsCount: 'Steps: ',
            startTracking: 'Start Tracking',
            stopTracking: 'Stop Tracking',
            reset: 'Reset Steps',
            stepMotivation: 'Walking 10,000 steps a day can significantly improve your health.',
            journalPrompt: 'Record your mood and things you are grateful for daily.',
            moodSelect: '-- Select a mood --',
            moodHappy: 'Happy',
            moodSad: 'Sad',
            moodNormal: 'Normal',
            moodAnxious: 'Anxious',
            moodGrateful: 'Grateful',
            saveEntry: 'Save Entry',
            analyzeMood: 'Analyze Mood',
            moodAnalysis: 'Mood Analysis',
            moodAnalysisPlaceholder: 'Your mood analysis will appear here.',
            yourEntries: 'Your Entries',
            entriesPlaceholder: 'Your journal entries will appear here.',
            foodPlanPrompt: 'Enter your diet, health, allergy or problem.',
            painMapPrompt: 'Touch the area of your body where you have pain to add the pain and its description.',
            removePain: 'You can touch it again to remove the pain.',
            aiTipTitle: 'AI Tip',
            firstAidPrompt: 'Get help and information in emergencies.',
            emergencyContacts: 'Emergency Contacts',
            addContact: 'Add Contact',
            noContacts: 'No emergency contacts added.',
            symptomPrompt: 'Get information about your symptoms.',
            exercisePrompt: 'Enter your exercise, pain or problem for ideas.',
            painPromptPrefix: 'Tips for this body part pain:',
            painMapTipInstructions: 'Touch a painful area to get tips about it.',
            genericPainTip: 'Touch a body part to get tips for pain in that area.',
            micListening: 'Listening...',
            micStopped: 'Microphone stopped.',
            speakTip: 'Speak Tip',
            stopSpeaking: 'Stop Speaking',
        }
    };

    // Mapping from SVG part IDs to human-readable names for AI prompt generation
    const painMapPartNames = {
        'head': { ta: 'родро▓рпИ', en: 'head' },
        'neck': { ta: 'роХро┤рпБродрпНродрпБ', en: 'neck' },
        'shoulder-r': { ta: 'ро╡ро▓родрпБ родрпЛро│рпНрокроЯрпНроЯрпИ', en: 'right shoulder' },
        'shoulder-l': { ta: 'роЗроЯродрпБ родрпЛро│рпНрокроЯрпНроЯрпИ', en: 'left shoulder' },
        'chest': { ta: 'рооро╛ро░рпНрокрпБ', en: 'chest' },
        'stomach': { ta: 'ро╡ропро┐ро▒рпБ', en: 'stomach' },
        'arm-r': { ta: 'ро╡ро▓родрпБ роХрпИ', en: 'right arm' },
        'arm-l': { ta: 'роЗроЯродрпБ роХрпИ', en: 'left arm' },
        'hand-r': { ta: 'ро╡ро▓родрпБ роХрпИ', en: 'right hand' },
        'hand-l': { ta: 'роЗроЯродрпБ роХрпИ', en: 'left hand' },
        'leg-r': { ta: 'ро╡ро▓родрпБ роХро╛ро▓рпН', en: 'right leg' },
        'leg-l': { ta: 'роЗроЯродрпБ роХро╛ро▓рпН', en: 'left leg' },
        'foot-r': { ta: 'ро╡ро▓родрпБ рокро╛родроорпН', en: 'right foot' },
        'foot-l': { ta: 'роЗроЯродрпБ рокро╛родроорпН', en: 'left foot' },
        'back': { ta: 'роорпБродрпБроХрпБ', en: 'back' },
        'buttocks': { ta: 'рокро┐ройрпН рокроХрпБродро┐', en: 'buttocks' }
    };

    let currentPage = 'login';
    let currentLang = 'ta';
    let steps = 0;
    let stepTrackerInterval = null;
    const moodEntries = [];
    const foodPlan = [];
    const emergencyContacts = [];
    const painMapState = {};

    const getTranslation = (key) => translations[currentLang][key] || key;
    const appContainer = document.getElementById('app');
    const bottomBar = document.getElementById('bottom-bar');
    const messageBox = document.getElementById('message-box');
    const messageText = document.getElementById('message-text');

    // Speech Recognition and Synthesis APIs
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const synth = window.speechSynthesis;

    let recognition = null;
    let isListening = false;
    let isSpeaking = false;

    // Function to show a custom message box instead of alert()
    function showMessageBox(message) {
        messageText.textContent = message;
        messageBox.classList.remove('hidden');
        messageBox.classList.add('flex');
    }

    // Function to close the custom message box
    function closeMessageBox() {
        messageBox.classList.add('hidden');
        messageBox.classList.remove('flex');
    }

    /**
     * Toggles speech recognition for a specific input field.
     * @param {string} inputElementId - The ID of the input field to populate.
     */
    const toggleSpeechRecognition = (inputElementId) => {
        const micButton = document.querySelector(`[data-input-id="${inputElementId}"]`);
        const aiTipElement = document.getElementById('aiTip');
        
        // Check for browser support
        if (!SpeechRecognition) {
            showMessageBox('роЙроЩрпНроХро│рпН роЙро▓ро╛ро╡ро┐ рокрпЗроЪрпНроЪрпБ роЕроЩрпНроХрпАроХро╛ро░родрпНродрпИ роЖродро░ро┐роХрпНроХро╡ро┐ро▓рпНро▓рпИ.');
            return;
        }

        if (isListening) {
            // Stop listening if already active
            if (recognition) {
                recognition.stop();
            }
            isListening = false;
            micButton.textContent = 'ЁЯОд';
            if (aiTipElement) {
                aiTipElement.textContent = getTranslation('micStopped');
            }
        } else {
            // Start a new recognition session
            recognition = new SpeechRecognition();
            recognition.lang = currentLang === 'ta' ? 'ta-IN' : 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
            
            const input = document.getElementById(inputElementId);

            recognition.onstart = () => {
                isListening = true;
                micButton.textContent = 'ЁЯЫС';
                if (aiTipElement) {
                    aiTipElement.textContent = getTranslation('micListening');
                }
            };
            
            recognition.onresult = (event) => {
                const speechResult = event.results[0][0].transcript;
                if (input) {
                    input.value = speechResult;
                }
                if (aiTipElement) {
                    aiTipElement.textContent = '';
                }
            };
            
            recognition.onerror = (event) => {
                console.error('Speech recognition error', event.error);
                showMessageBox(`рокрпЗроЪрпНроЪрпБ роЕроЩрпНроХрпАроХро╛ро░роорпН рокро┐ро┤рпИ: ${event.error}`);
            };
            
            recognition.onend = () => {
                isListening = false;
                micButton.textContent = 'ЁЯОд';
            };

            try {
                recognition.start();
            } catch (error) {
                console.error('Failed to start speech recognition:', error);
                showMessageBox('рокрпЗроЪрпНроЪрпБ роЕроЩрпНроХрпАроХро╛ро░родрпНродрпИ родрпКроЯроЩрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ. роЙроЩрпНроХро│рпН роЙро▓ро╛ро╡ро┐ропро┐ро▓рпН роорпИроХрпНро░рпЛроГрокрпЛройрпН роЕройрпБроородро┐ропрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН.');
            }
        }
    };
    
    /**
     * Toggles speech synthesis (text-to-speech) for a given text.
     * @param {string} text - The text to speak.
     */
    const toggleSpeak = (text) => {
        const speakButton = document.getElementById('speakTipBtn');

        if (isSpeaking) {
            // Stop speaking if already active
            synth.cancel();
            isSpeaking = false;
            if (speakButton) speakButton.textContent = 'ЁЯФК';
        } else {
            // Start speaking a new utterance
            if (!text || text.trim() === getTranslation('yourTipHere') || text.trim().startsWith(getTranslation('loadingMessage').split('<')[0])) {
                showMessageBox('рокрпЗроЪ роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ.');
                return;
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = currentLang === 'ta' ? 'ta-IN' : 'en-US';
            
            utterance.onstart = () => {
                isSpeaking = true;
                if (speakButton) speakButton.textContent = 'тП╣я╕П';
            };
            
            utterance.onend = () => {
                isSpeaking = false;
                if (speakButton) speakButton.textContent = 'ЁЯФК';
            };

            synth.speak(utterance);
        }
    };

    // AI Tip Generation using Gemini API
    const getAiTipFromPrompt = async (prompt, outputId) => {
        const outputElement = document.getElementById(outputId);
        outputElement.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i> ${getTranslation('loadingMessage')}`;

        const finalPrompt = `${prompt}
Please provide a response in ${currentLang === 'ta' ? 'Tamil' : 'English'}. Format the response as a detailed, point-by-point list. Do not include any introductory or concluding sentences outside of the list.`;

        try {
            const chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: finalPrompt }] });
            const payload = { contents: chatHistory };
            
            const apiKey = "AIzaSyA5Kji5739tmhOPFJi0De2Pl_io2Jmo-V0"; // API key is provided by the canvas environment at runtime
            
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API call failed with status: ${response.status}. Message: ${errorData.error.message}`);
            }

            const result = await response.json();
            
            let tipText = getTranslation('yourTipHere');
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                tipText = result.candidates[0].content.parts[0].text;
            } else {
                tipText = `Failed to get a tip. Please try again.`;
            }

            outputElement.textContent = tipText;
        } catch (error) {
            console.error('Error generating AI tip:', error);
            outputElement.textContent = `Failed to generate a tip: ${error.message}`;
        }
    };

    // Main render function to control page views
    const render = () => {
        // Clear all event listeners by clearing innerHTML, then re-render
        appContainer.innerHTML = '';
        bottomBar.innerHTML = '';

        // Hide bottom bar by default and show it only when needed
        bottomBar.classList.add('hidden');

        switch(currentPage) {
            case 'login':
                renderLoginPage();
                break;
            case 'main':
                renderMainPage();
                break;
            case 'stepTracker':
                renderStepTrackerPage();
                renderBottomBar();
                break;
            case 'moodJournal':
                renderMoodJournalPage();
                renderBottomBar();
                break;
            case 'foodRecipes':
                renderFoodRecipesPage();
                renderBottomBar();
                break;
            case 'bodyPainMap':
                renderBodyPainMapPage();
                renderBottomBar();
                break;
            case 'firstAid':
                renderFirstAidPage();
                renderBottomBar();
                break;
            case 'exerciseYoga':
            case 'beautyTips':
            case 'generalTips':
            case 'localTips':
            case 'symptomFinder':
            case 'foodPlan':
                const featureTitle = getTranslation(currentPage);
                let placeholderKey = currentPage === 'foodPlan' ? 'foodPlanPrompt' : (currentPage === 'exerciseYoga' ? 'exercisePrompt' : `inputPlaceholder${currentPage.charAt(0).toUpperCase() + currentPage.slice(1)}`);
                if (!translations[currentLang][placeholderKey]) {
                    placeholderKey = 'yourTipHere'; // fallback to a generic placeholder
                }
                renderAiTipsPage(featureTitle, getTranslation(placeholderKey), currentPage);
                renderBottomBar();
                break;
            default:
                renderSimplePage(getTranslation('featureNotDeveloped'), 'ЁЯЪл', '');
                break;
        }
    };

    // Navigation function
    const navigateTo = (page) => {
        if (stepTrackerInterval) {
            clearInterval(stepTrackerInterval);
            stepTrackerInterval = null;
        }
        currentPage = page;
        render();
    };
    
    // Function to toggle language
    const toggleLanguage = () => {
        currentLang = currentLang === 'ta' ? 'en' : 'ta';
        render();
    };
    
    // Renders the bottom bar with the new centered layout
    const renderBottomBar = () => {
        bottomBar.innerHTML = `
            <button id="backButton" class="bg-gray-200 text-gray-800 p-3 rounded-full shadow-lg hover:bg-gray-300 transition-colors flex items-center justify-center">
                <i class="fa fa-arrow-left"></i>
                <span class="ml-2 font-bold">${getTranslation('backToFeatures')}</span>
            </button>
            <button id="langToggleBottom" class="bg-gray-200 text-gray-800 text-xl p-3 rounded-full shadow-lg hover:bg-gray-300 transition-colors flex items-center justify-center">
                <i class="fa fa-globe"></i>
            </button>
        `;
        bottomBar.classList.remove('hidden');
        document.getElementById('backButton').addEventListener('click', () => navigateTo('main'));
        document.getElementById('langToggleBottom').addEventListener('click', toggleLanguage);
    };

    // Renders the login page
    const renderLoginPage = () => {
        appContainer.innerHTML = `
            <div class="flex items-center justify-center min-h-screen bg-gradient-to-br from-green-500 to-blue-500 p-4">
                <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-sm transform transition-transform hover:scale-105">
                    <div class="flex justify-end mb-4">
                        <button id="langToggleLogin" class="text-gray-600 hover:text-blue-500 transition-colors">
                            <i class="fa fa-globe text-2xl"></i>
                        </button>
                    </div>
                    <h1 class="text-3xl font-extrabold text-center text-gray-800 mb-6">${getTranslation('loginTitle')}</h1>
                    <form id="loginForm" class="flex flex-col space-y-4">
                        <input type="text" id="username" placeholder="${getTranslation('usernamePlaceholder')}" class="p-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                        <input type="password" id="password" placeholder="${getTranslation('passwordPlaceholder')}" class="p-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                        <p id="errorMsg" class="text-red-500 text-sm text-center hidden"></p>
                        <button type="submit" class="bg-green-500 text-white font-bold p-3 rounded-lg shadow-md hover:bg-green-600 transition-colors">${getTranslation('loginButton')}</button>
                    </form>
                </div>
            </div>
        `;

        document.getElementById('langToggleLogin').addEventListener('click', toggleLanguage);
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('errorMsg');
            if (username && password) {
                navigateTo('main');
            } else {
                errorMsg.textContent = getTranslation('loginError');
                errorMsg.classList.remove('hidden');
            }
        });
    };

    // Renders the main menu page
    const renderMainPage = () => {
        const mainPageHtml = `
            <div class="flex flex-col items-center min-h-screen bg-gradient-to-br from-blue-500 to-green-500 p-8 text-gray-800 relative">
                <h1 class="text-4xl font-extrabold mb-8 text-center text-white drop-shadow-lg">${getTranslation('allFeaturesTitle')}</h1>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-6 w-full max-w-5xl">
                    ${renderFeatureCardHtml('stepTracker', 'ЁЯЪ╢', getTranslation('stepTracker'))}
                    ${renderFeatureCardHtml('generalTips', 'ЁЯза', getTranslation('generalTips'))}
                    ${renderFeatureCardHtml('localTips', 'ЁЯМ▒', getTranslation('localTips'))}
                    ${renderFeatureCardHtml('beautyTips', 'тЬи', getTranslation('beautyTips'))}
                    ${renderFeatureCardHtml('symptomFinder', 'ЁЯй║', getTranslation('symptomFinder'))}
                    ${renderFeatureCardHtml('foodPlan', 'ЁЯНО', getTranslation('foodPlan'))}
                    ${renderFeatureCardHtml('exerciseYoga', 'ЁЯзШ', getTranslation('exerciseYoga'))}
                    ${renderFeatureCardHtml('firstAid', 'тЫСя╕П', getTranslation('firstAid'))}
                    ${renderFeatureCardHtml('bodyPainMap', 'ЁЯЧ║я╕П', getTranslation('bodyPainMap'))}
                    ${renderFeatureCardHtml('moodJournal', 'ЁЯШК', getTranslation('moodJournal'))}
                    ${renderFeatureCardHtml('foodRecipes', 'ЁЯН▓', getTranslation('foodRecipes'))}
                </div>
            </div>
        `;
        appContainer.innerHTML = mainPageHtml;
        
        // Add event listeners after the HTML is rendered
        document.querySelectorAll('[data-page]').forEach(button => {
            button.addEventListener('click', () => navigateTo(button.dataset.page));
        });
    };

    // Helper function to generate feature card HTML
    const renderFeatureCardHtml = (page, icon, title) => {
        return `
            <button data-page="${page}" class="flex flex-col items-center justify-center p-6 bg-white rounded-2xl shadow-xl hover:shadow-2xl transition-all transform hover:scale-105 border border-gray-200">
                <div class="text-5xl mb-3">${icon}</div>
                <div class="text-md font-semibold text-center text-gray-800">${title}</div>
            </button>
        `;
    };

    // Implemented feature pages below
    const renderStepTrackerPage = () => {
        appContainer.innerHTML = `
            <div class="min-h-screen flex flex-col items-center p-8 bg-gray-100 text-gray-800">
                <div class="max-w-2xl w-full text-center bg-white rounded-2xl shadow-2xl p-8 relative">
                    <h1 class="text-4xl font-extrabold mb-4"><span class="mr-2">ЁЯЪ╢</span>${getTranslation('stepTracker')}</h1>
                    <div class="flex flex-col items-center justify-center space-y-4">
                        <div id="stepsDisplay" class="text-5xl font-bold text-green-600">${steps}</div>
                        <p class="text-lg">${getTranslation('stepMotivation')}</p>
                        <div class="flex space-x-4">
                            <button id="startTrackingBtn" class="bg-blue-500 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-blue-600 transition-colors">${getTranslation('startTracking')}</button>
                            <button id="stopTrackingBtn" class="bg-red-500 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-red-600 transition-colors">${getTranslation('stopTracking')}</button>
                        </div>
                        <button id="resetStepsBtn" class="bg-gray-400 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-gray-500 transition-colors">${getTranslation('reset')}</button>
                    </div>
                </div>
            </div>
        `;

        document.getElementById('startTrackingBtn').addEventListener('click', () => {
            if (!stepTrackerInterval) {
                stepTrackerInterval = setInterval(() => {
                    steps++;
                    document.getElementById('stepsDisplay').textContent = steps;
                }, 2800);
            }
        });
        document.getElementById('stopTrackingBtn').addEventListener('click', () => {
            if (stepTrackerInterval) {
                clearInterval(stepTrackerInterval);
                stepTrackerInterval = null;
            }
        });
        document.getElementById('resetStepsBtn').addEventListener('click', () => {
            steps = 0;
            if (stepTrackerInterval) {
                clearInterval(stepTrackerInterval);
                stepTrackerInterval = null;
            }
            document.getElementById('stepsDisplay').textContent = steps;
        });
    };

    const renderMoodJournalPage = () => {
        appContainer.innerHTML = `
            <div class="min-h-screen flex flex-col items-center p-8 bg-gray-100 text-gray-800">
                <div class="max-w-2xl w-full bg-white rounded-2xl shadow-2xl p-8 relative">
                    <h1 class="text-4xl font-extrabold mb-4 text-center"><span class="mr-2">ЁЯШК</span>${getTranslation('moodJournal')}</h1>
                    <p class="text-center mb-4">${getTranslation('journalPrompt')}</p>
                    <div class="flex flex-col space-y-4">
                        <select id="moodSelect" class="p-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                            <option value="">${getTranslation('moodSelect')}</option>
                            <option value="Happy">${getTranslation('moodHappy')}</option>
                            <option value="Sad">${getTranslation('moodSad')}</option>
                            <option value="Normal">${getTranslation('moodNormal')}</option>
                            <option value="Anxious">${getTranslation('moodAnxious')}</option>
                            <option value="Grateful">${getTranslation('moodGrateful')}</option>
                        </select>
                        <div class="flex items-center space-x-2">
                            <textarea id="moodEntry" placeholder="${getTranslation('journalPrompt')}" rows="5" class="flex-grow p-4 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400"></textarea>
                            <button id="moodMicBtn" class="text-xl text-gray-600 hover:text-blue-500 transition-colors p-2" data-input-id="moodEntry">ЁЯОд</button>
                        </div>
                        <button id="saveEntryBtn" class="bg-green-500 text-white font-bold p-3 rounded-lg shadow-md hover:bg-green-600 transition-colors">${getTranslation('saveEntry')}</button>
                    </div>
                    <div class="mt-8">
                        <h2 class="text-2xl font-bold mb-4">${getTranslation('yourEntries')}</h2>
                        <ul id="entriesList" class="space-y-4">
                            ${moodEntries.map(entry => `<li class="p-4 bg-gray-100 rounded-lg shadow-inner">${entry}</li>`).join('')}
                            ${moodEntries.length === 0 ? `<li class="p-4 text-gray-500">${getTranslation('entriesPlaceholder')}</li>` : ''}
                        </ul>
                    </div>
                    <div class="mt-8">
                        <h2 class="text-2xl font-bold mb-4">${getTranslation('moodAnalysis')}</h2>
                        <div class="flex items-start space-x-2">
                            <div id="moodAnalysisResult" class="flex-grow p-4 bg-gray-100 rounded-lg whitespace-pre-wrap text-gray-800">
                                ${getTranslation('moodAnalysisPlaceholder')}
                            </div>
                            <button id="speakAnalysisBtn" class="text-xl text-gray-600 hover:text-green-500 transition-colors p-2">ЁЯФК</button>
                        </div>
                        <button id="analyzeMoodBtn" class="bg-blue-500 text-white font-bold p-3 rounded-lg shadow-md hover:bg-blue-600 transition-colors mt-4">${getTranslation('analyzeMood')}</button>
                    </div>
                </div>
            </div>
        `;
        
        document.getElementById('saveEntryBtn').addEventListener('click', () => {
            const mood = document.getElementById('moodSelect').value;
            const entryText = document.getElementById('moodEntry').value.trim();
            if (mood && entryText) {
                const entry = `${new Date().toLocaleDateString()} - ${getTranslation(`mood${mood}`)}: ${entryText}`;
                moodEntries.push(entry);
                renderMoodJournalPage(); // Re-render to update the list
            } else {
                showMessageBox('рооройроиро┐ро▓рпИ рооро▒рпНро▒рпБроорпН роЙро│рпНро│рпАроЯрпНроЯрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН.');
            }
        });

        document.getElementById('analyzeMoodBtn').addEventListener('click', () => {
            const allEntriesText = moodEntries.join('\n');
            const prompt = `Based on these journal entries: "${allEntriesText}", please provide a brief analysis of my mood trends.`;
            getAiTipFromPrompt(prompt, 'moodAnalysisResult');
        });

        document.getElementById('moodMicBtn').addEventListener('click', () => toggleSpeechRecognition('moodEntry'));
        document.getElementById('speakAnalysisBtn').addEventListener('click', () => {
            const textToSpeak = document.getElementById('moodAnalysisResult').textContent;
            toggleSpeak(textToSpeak);
        });
    };

    const renderFoodRecipesPage = () => {
        appContainer.innerHTML = `
            <div class="min-h-screen flex flex-col items-center p-8 bg-gray-100 text-gray-800">
                <div class="max-w-2xl w-full bg-white rounded-2xl shadow-2xl p-8 relative">
                    <h1 class="text-4xl font-extrabold mb-4 text-center"><span class="mr-2">ЁЯН▓</span>${getTranslation('foodRecipes')}</h1>
                    <p class="text-center mb-4">${getTranslation('inputPlaceholderRecipes')}</p>
                    <div class="flex items-center space-x-2">
                        <input type="text" id="recipeInput" placeholder="${getTranslation('inputPlaceholderRecipes')}" class="flex-grow p-4 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                        <button id="recipeMicBtn" class="text-xl text-gray-600 hover:text-blue-500 transition-colors p-2" data-input-id="recipeInput">ЁЯОд</button>
                    </div>
                    <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mt-4">
                        <button id="getRecipeBtn" class="w-full bg-green-500 text-white font-bold p-3 rounded-lg shadow-md hover:bg-green-600 transition-colors">${getTranslation('getTip')}</button>
                    </div>
                    <div class="mt-8">
                        <h2 class="text-2xl font-bold mb-4">${getTranslation('aiTipTitle')}</h2>
                        <div class="flex items-start space-x-2">
                            <div id="aiTip" class="flex-grow p-4 bg-gray-100 rounded-lg whitespace-pre-wrap text-gray-800">${getTranslation('yourTipHere')}</div>
                            <button id="speakTipBtn" class="text-xl text-gray-600 hover:text-green-500 transition-colors p-2">ЁЯФК</button>
                        </div>
                    </div>
                </div>
            </div>
        `;

        document.getElementById('getRecipeBtn').addEventListener('click', () => {
            const input = document.getElementById('recipeInput').value;
            if (input.trim()) {
                const prompt = `Give me a recipe for ${input}.`;
                getAiTipFromPrompt(prompt, 'aiTip');
            } else {
                showMessageBox(getTranslation('noRecipe'));
            }
        });
        document.getElementById('recipeMicBtn').addEventListener('click', () => toggleSpeechRecognition('recipeInput'));
        document.getElementById('speakTipBtn').addEventListener('click', () => {
            const textToSpeak = document.getElementById('aiTip').textContent;
            toggleSpeak(textToSpeak);
        });
    };

    const renderAiTipsPage = (featureTitle, placeholderText, tipType) => {
        appContainer.innerHTML = `
            <div class="min-h-screen flex flex-col items-center p-8 bg-gray-100 text-gray-800">
                <div class="max-w-2xl w-full bg-white rounded-2xl shadow-2xl p-8 relative">
                    <h1 class="text-4xl font-extrabold mb-4 text-center">${featureTitle}</h1>
                    <p class="text-center mb-4">${placeholderText}</p>
                    <div class="flex items-center space-x-2">
                        <input type="text" id="aiTipInput" placeholder="${placeholderText}" class="flex-grow p-4 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                        <button id="aiTipMicBtn" class="text-xl text-gray-600 hover:text-blue-500 transition-colors p-2" data-input-id="aiTipInput">ЁЯОд</button>
                    </div>
                    <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mt-4">
                        <button id="getAiTipBtn" class="w-full bg-green-500 text-white font-bold p-3 rounded-lg shadow-md hover:bg-green-600 transition-colors">${getTranslation('getTip')}</button>
                    </div>
                    <div class="mt-8">
                        <h2 class="text-2xl font-bold mb-4">${getTranslation('aiTipTitle')}</h2>
                        <div class="flex items-start space-x-2">
                            <div id="aiTip" class="flex-grow p-4 bg-gray-100 rounded-lg whitespace-pre-wrap text-gray-800">${getTranslation('yourTipHere')}</div>
                            <button id="speakTipBtn" class="text-xl text-gray-600 hover:text-green-500 transition-colors p-2">ЁЯФК</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.getElementById('getAiTipBtn').addEventListener('click', () => {
            const input = document.getElementById('aiTipInput').value.trim();
            if (input) {
                let prompt = '';
                switch (tipType) {
                    case 'generalTips':
                        prompt = `Provide a general health tip about: ${input}`;
                        break;
                    case 'localTips':
                        prompt = `Provide a local health tip about: ${input}`;
                        break;
                    case 'beautyTips':
                        prompt = `Provide a home beauty tip about: ${input}`;
                        break;
                    case 'symptomFinder':
                        prompt = `What are common issues related to the symptoms: ${input}`;
                        break;
                    case 'foodPlan':
                        prompt = `Provide a food plan for someone with this health consideration: ${input}`;
                        break;
                    case 'exerciseYoga':
                        prompt = `Provide exercise and yoga tips for someone with: ${input}`;
                        break;
                    default:
                        prompt = `Provide a health tip for: ${input}`;
                }
                getAiTipFromPrompt(prompt, 'aiTip');
            } else {
                showMessageBox(getTranslation('inputPlaceholder') || 'родропро╡рпБроЪрпЖропрпНродрпБ роЙро│рпНро│рпАроЯрпНроЯрпИ ро╡ро┤роЩрпНроХро╡рпБроорпН.');
            }
        });
        document.getElementById('aiTipMicBtn').addEventListener('click', () => toggleSpeechRecognition('aiTipInput'));
        document.getElementById('speakTipBtn').addEventListener('click', () => {
            const textToSpeak = document.getElementById('aiTip').textContent;
            toggleSpeak(textToSpeak);
        });
    };

    const renderBodyPainMapPage = () => {
        appContainer.innerHTML = `
            <div class="min-h-screen flex flex-col items-center p-8 bg-gray-100 text-gray-800">
                <div class="max-w-2xl w-full bg-white rounded-2xl shadow-2xl p-8 relative">
                    <h1 class="text-4xl font-extrabold mb-4 text-center"><span class="mr-2">ЁЯЧ║я╕П</span>${getTranslation('bodyPainMap')}</h1>
                    <p class="text-center mb-4">${getTranslation('painMapPrompt')}</p>
                    <p class="text-center mb-4 text-sm text-gray-500">${getTranslation('removePain')}</p>
                    <div class="pain-map-container my-8">
                        <!-- SVG Body Pain Map -->
                        <svg class="pain-map-svg" width="100%" height="100%" viewBox="0 0 400 600" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g id="body-parts">
                                <path id="head" d="M199.5 40C222.105 40 240.5 58.3946 240.5 81C240.5 103.605 222.105 122 199.5 122C176.895 122 158.5 103.605 158.5 81C158.5 58.3946 176.895 40 199.5 40Z" class="body-part cursor-pointer" />
                                <path id="neck" d="M199.5 122V155H220V122H199.5Z" class="body-part cursor-pointer" />
                                <path id="shoulder-r" d="M220 155H250C250 155 260 180 260 200V240C260 240 250 245 250 250H220V155Z" class="body-part cursor-pointer" />
                                <path id="shoulder-l" d="M179 155H150C150 155 140 180 140 200V240C140 240 150 245 150 250H179V155Z" class="body-part cursor-pointer" />
                                <path id="chest" d="M179 155H220V240H179V155Z" class="body-part cursor-pointer" />
                                <path id="back" d="M179 240H220V320H179V240Z" class="body-part cursor-pointer" />
                                <path id="buttocks" d="M179 320H220V380H179V320Z" class="body-part cursor-pointer" />
                                <path id="arm-r" d="M260 200V350H270V200H260Z" class="body-part cursor-pointer" />
                                <path id="arm-l" d="M140 200V350H130V200H140Z" class="body-part cursor-pointer" />
                                <path id="hand-r" d="M270 350H280V370H270V350Z" class="body-part cursor-pointer" />
                                <path id="hand-l" d="M130 350H120V370H130V350Z" class="body-part cursor-pointer" />
                                <path id="leg-r" d="M200 380V520H210V380H200Z" class="body-part cursor-pointer" />
                                <path id="leg-l" d="M199 380V520H189V380H199Z" class="body-part cursor-pointer" />
                                <path id="foot-r" d="M200 520V550H220V520H200Z" class="body-part cursor-pointer" />
                                <path id="foot-l" d="M189 520V550H169V520H189Z" class="body-part cursor-pointer" />
                                <path id="stomach" d="M179 240H220V320H179V240Z" class="body-part cursor-pointer" />
                            </g>
                        </svg>
                    </div>
                    
                    <div class="mt-8">
                        <h2 class="text-2xl font-bold mb-4">${getTranslation('aiTipTitle')}</h2>
                        <div class="flex items-start space-x-2">
                            <div id="aiTip" class="flex-grow p-4 bg-gray-100 rounded-lg whitespace-pre-wrap text-gray-800">
                                ${getTranslation('genericPainTip')}
                            </div>
                            <button id="speakTipBtn" class="text-xl text-gray-600 hover:text-green-500 transition-colors p-2">ЁЯФК</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        document.querySelectorAll('.pain-map-svg .body-part').forEach(path => {
            path.addEventListener('click', (event) => {
                const partId = event.target.id;
                const partName = painMapPartNames[partId][currentLang];
                
                // Toggle the 'pain' class to change color
                event.target.classList.toggle('pain');
                
                // Construct the AI prompt based on the selected body part
                const prompt = `Give me tips for pain relief in the ${partName} area.`;
                getAiTipFromPrompt(prompt, 'aiTip');
            });
        });
        document.getElementById('speakTipBtn').addEventListener('click', () => {
            const textToSpeak = document.getElementById('aiTip').textContent;
            toggleSpeak(textToSpeak);
        });
    };

    const renderFirstAidPage = () => {
        const emergencyContactList = emergencyContacts.map((contact, index) => `
            <li class="flex items-center justify-between p-4 bg-gray-100 rounded-lg shadow-inner">
                <span>${contact.name}: ${contact.number}</span>
                <button class="text-red-500 hover:text-red-700" data-index="${index}">
                    <i class="fa fa-trash"></i>
                </button>
            </li>
        `).join('');

        appContainer.innerHTML = `
            <div class="min-h-screen flex flex-col items-center p-8 bg-gray-100 text-gray-800">
                <div class="max-w-2xl w-full bg-white rounded-2xl shadow-2xl p-8 relative">
                    <h1 class="text-4xl font-extrabold mb-4 text-center"><span class="mr-2">тЫСя╕П</span>${getTranslation('firstAid')}</h1>
                    <p class="text-center mb-4">${getTranslation('firstAidPrompt')}</p>
                    <div class="flex flex-col space-y-4">
                        <div class="flex items-center space-x-2">
                            <input type="text" id="firstAidInput" placeholder="роХро╛ропроЩрпНроХро│рпН, родрпАроХрпНроХро╛ропроЩрпНроХро│рпН, рооро╛ро░роЯрпИрокрпНрокрпБ" class="flex-grow p-4 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                            <button id="firstAidMicBtn" class="text-xl text-gray-600 hover:text-blue-500 transition-colors p-2" data-input-id="firstAidInput">ЁЯОд</button>
                        </div>
                        <button id="getFirstAidTipBtn" class="w-full bg-green-500 text-white font-bold p-3 rounded-lg shadow-md hover:bg-green-600 transition-colors">${getTranslation('getTip')}</button>
                    </div>
                    <div class="mt-8">
                        <h2 class="text-2xl font-bold mb-4">${getTranslation('aiTipTitle')}</h2>
                        <div class="flex items-start space-x-2">
                            <div id="aiTip" class="flex-grow p-4 bg-gray-100 rounded-lg whitespace-pre-wrap text-gray-800">${getTranslation('yourTipHere')}</div>
                            <button id="speakTipBtn" class="text-xl text-gray-600 hover:text-green-500 transition-colors p-2">ЁЯФК</button>
                        </div>
                    </div>
                    <div class="mt-8">
                        <h2 class="text-2xl font-bold mb-4">${getTranslation('emergencyContacts')}</h2>
                        <div class="flex space-x-2 mb-4">
                            <input type="text" id="contactNameInput" placeholder="рокрпЖропро░рпН" class="flex-grow p-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <input type="tel" id="contactNumberInput" placeholder="родрпКро▓рпИрокрпЗроЪро┐ роОрогрпН" class="flex-grow p-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <button id="addContactBtn" class="bg-blue-500 text-white font-bold p-3 rounded-lg shadow-md hover:bg-blue-600 transition-colors">${getTranslation('addContact')}</button>
                        </div>
                        <ul id="contactList" class="space-y-2">
                            ${emergencyContacts.length > 0 ? emergencyContactList : `<li class="p-4 text-gray-500">${getTranslation('noContacts')}</li>`}
                        </ul>
                    </div>
                </div>
            </div>
        `;
        document.getElementById('getFirstAidTipBtn').addEventListener('click', () => {
            const input = document.getElementById('firstAidInput').value.trim();
            if (input) {
                const prompt = `Provide first aid tips for: ${input}.`;
                getAiTipFromPrompt(prompt, 'aiTip');
            } else {
                showMessageBox('родропро╡рпБроЪрпЖропрпНродрпБ роТро░рпБ роЕро╡роЪро░роиро┐ро▓рпИропрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН.');
            }
        });
        document.getElementById('addContactBtn').addEventListener('click', () => {
            const name = document.getElementById('contactNameInput').value.trim();
            const number = document.getElementById('contactNumberInput').value.trim();
            if (name && number) {
                emergencyContacts.push({ name, number });
                renderFirstAidPage(); // Re-render to update the list
            } else {
                showMessageBox('рокрпЖропро░рпН рооро▒рпНро▒рпБроорпН родрпКро▓рпИрокрпЗроЪро┐ роОрогрпНрогрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН.');
            }
        });
        document.getElementById('firstAidMicBtn').addEventListener('click', () => toggleSpeechRecognition('firstAidInput'));
        document.getElementById('speakTipBtn').addEventListener('click', () => {
            const textToSpeak = document.getElementById('aiTip').textContent;
            toggleSpeak(textToSpeak);
        });
        document.querySelectorAll('#contactList button').forEach(button => {
            button.addEventListener('click', (e) => {
                const index = parseInt(e.currentTarget.dataset.index);
                emergencyContacts.splice(index, 1);
                renderFirstAidPage(); // Re-render
            });
        });
    };

    // Initial render
    window.onload = () => {
        render();
    };

</script>
</body>
</html>
