<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ஆரோக்கிய நண்பன் - உங்கள் ஆரோக்கிய வழிகாட்டி</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Tone.js for sound generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #E6F7FF; /* Light Blue */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1.5rem;
            color: #333333;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            box-sizing: border-box;
            transition: all 0.5s ease-in-out;
            overflow-y: auto; /* Allow scrolling for features */
        }

        body.main-content-active {
            min-height: auto;
            align-items: flex-start;
            padding-top: 2rem;
            padding-bottom: 2rem;
            overflow-y: auto;
        }

        .container {
            max-width: 640px;
            width: 100%;
            background-color: #ffffff;
            border-radius: 1.75rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
            padding: 2.5rem;
            text-align: center;
            position: relative;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .language-selector-wrapper {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
        }
        .input-wrapper {
            position: relative;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }
        .input-field {
            flex-grow: 1;
            padding: 1rem 1.25rem;
            padding-right: 3.5rem; /* Space for mic icon */
            border: 1px solid #D1D5DB;
            border-radius: 0.875rem;
            font-size: 1.05rem;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .input-field:focus {
            border-color: #87CEEB;
            box-shadow: 0 0 0 3px rgba(135, 206, 235, 0.4);
        }
        .mic-button {
            position: absolute;
            right: 1rem;
            background: none;
            border: none;
            color: #0000FF;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: color 0.3s ease, background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .mic-button:hover {
            color: #DC2626; /* Red */
            background-color: rgba(220, 38, 38, 0.1);
        }
        .mic-button.recording {
            color: #DC2626; /* Red */
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.1); opacity: 0.7); }
        }

        .generate-button, .action-button, .open-tracker-button, .ai-voice-button {
            background-color: #6A0DAD; /* Dark Violet */
            color: #ffffff;
            padding: 1rem 2rem;
            border-radius: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 15px rgba(106, 13, 173, 0.4);
            letter-spacing: 0.025em;
            margin-top: 1rem;
            border: none;
            display: inline-flex; /* Ensure flex behavior for centering icon/text */
            align-items: center;
            justify-content: center;
            gap: 0.5rem; /* Space between icon and text */
        }
        .generate-button:hover, .action-button:hover, .open-tracker-button:hover, .ai-voice-button:hover {
            background-color: #4B0A7B; /* Darker Violet */
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(106, 13, 173, 0.5);
        }
        .generate-button:active, .action-button:active, .open-tracker-button:active, .ai-voice-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 10px rgba(106, 13, 173, 0.3);
        }
        .loading-indicator {
            display: none;
            margin-top: 2rem;
            font-size: 1.15rem;
            color: #6B7280;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #6A0DAD;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tip-box, .result-box { /* Unified style for all output boxes */
            background-color: #FFFFAA; /* Light Yellow */
            border: 1px solid #CCCC88; /* Darker Yellow */
            border-radius: 1.25rem;
            padding: 2rem;
            margin-top: 2rem;
            text-align: left;
            color: #333333;
            line-height: 1.7;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            font-size: 1.05rem;
            transition: all 0.5s ease-in-out;
            word-break: break-word; /* Ensure long words break */
        }
        .tip-box p, .result-box p {
            margin: 0;
        }
        .text-red-600 {
            color: #DC2626; /* Red */
        }
        /* Responsive adjustments */
        @media (max-width: 640px) {
            body {
                padding: 1rem;
            }
            .container {
                padding: 1.5rem;
                border-radius: 1.25rem;
            }
            .generate-button, .action-button, .open-tracker-button, .ai-voice-button {
                width: 100%;
                padding: 0.9rem 1.5rem;
            }
            .flex.flex-wrap.justify-center.gap-4 {
                flex-direction: column;
                gap: 0.75rem;
            }
            .language-selector-wrapper {
                top: 0.75rem;
                right: 0.75rem;
            }
            .input-wrapper {
                flex-direction: row;
                justify-content: center;
            }
            .mic-button {
                position: absolute;
                right: 0.5rem;
            }
        }
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #E6F7FF;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 1s ease-out;
            overflow: hidden;
        }
        .splash-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        .splash-screen img {
            max-width: 25%;
            max-height: 25%;
            object-fit: contain;
        }

        /* Feature Button for Main Page */
        .features-toggle-button {
            font-size: 4rem; /* Even larger emoji size for the main toggle */
            cursor: pointer;
            padding: 1rem;
            border-radius: 1rem;
            transition: transform 0.3s ease, background-color 0.3s ease;
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            line-height: 1;
            margin-top: 2rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            background-color: #e0f2fe; /* Light blue background */
        }
        .features-toggle-button:hover {
            transform: scale(1.05);
            background-color: #bee3f8; /* Slightly darker blue hover */
        }
        .features-toggle-button span.label {
            font-size: 1rem;
            margin-top: 0.75rem;
            color: #333;
            font-weight: 600;
        }

        /* Feature Icons and Sections */
        .feature-icon-container {
            display: flex;
            justify-content: center;
            gap: 1.5rem; /* Space between icons */
            margin-top: 2rem;
            flex-wrap: wrap; /* Allow icons to wrap on smaller screens */
        }
        .feature-icon {
            font-size: 3rem; /* Larger emoji size */
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.75rem;
            transition: transform 0.2s ease, background-color 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            line-height: 1;
        }
        .feature-icon:hover {
            transform: translateY(-5px);
            background-color: rgba(135, 206, 235, 0.1); /* Light blue hover */
        }
        .feature-icon span.label {
            font-size: 0.8rem; /* Smaller text label */
            margin-top: 0.5rem;
            color: #555;
            font-weight: 500;
        }

        /* Feature sections (initially hidden, shown by JS) */
        .feature-section {
            display: none;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb; /* Subtle separator */
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Specific feature section styles */
        .dropdown-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #D1D5DB;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
            padding: 0.5rem 0;
            top: calc(100% + 5px); /* Position below input */
            left: 0;
        }
        .dropdown-menu div {
            padding: 0.75rem 1.25rem;
            cursor: pointer;
        }
        .dropdown-menu div:hover {
            background-color: #F3F4F6;
        }
        .dropdown-menu div.selected {
            background-color: #e0f2fe; /* light blue */
            font-weight: 500;
        }
        
        .tts-voice-selector {
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.875rem;
            font-size: 0.95rem;
            background-color: white;
            margin-left: 1rem;
            flex-grow: 1;
        }
        .body-map-container {
            position: relative;
            width: 100%;
            max-width: 300px; /* Adjust as needed */
            margin: 0 auto;
            border: 1px solid #ccc;
            border-radius: 10px;
            overflow: hidden;
        }
        .body-map-image {
            width: 100%;
            height: auto;
            display: block;
        }
        .pain-dot {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: red;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            transform: translate(-50%, -50%); /* Center the dot on the click */
        }
        .pain-dot.selected {
            background-color: darkred;
            border: 2px solid yellow;
        }
        /* Hide all feature sections by default */
        .feature-section {
            display: none;
        }
        /* Show the main view or a specific section */
        #initialView, #allFeatureIconsContainer.active, .feature-section.active {
            display: block;
        }
        .back-button {
            background: none;
            border: none;
            color: #6A0DAD;
            font-weight: 600;
            cursor: pointer;
            padding: 0.5rem 0;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 1rem;
            transition: color 0.3s ease;
        }
        .back-button:hover {
            color: #4B0A7B;
        }

        /* Alarm Modal Styles */
        .alarm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .alarm-modal.show {
            opacity: 1;
            visibility: visible;
        }
        .alarm-modal-content {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 1.5rem;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            width: 90%;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }
        .alarm-modal.show .alarm-modal-content {
            transform: translateY(0);
        }
        .alarm-modal-content h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #6A0DAD;
            margin-bottom: 1rem;
        }
        .alarm-modal-content p {
            font-size: 1.1rem;
            color: #555;
            margin-bottom: 1.5rem;
        }
        .alarm-modal-content button {
            background-color: #6A0DAD;
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border: none;
        }
        .alarm-modal-content button:hover {
            background-color: #4B0A7B;
        }
    </style>
</head>
<body>
    <div id="splashScreen" class="splash-screen">
        <img src="https://placehold.co/150x150/E6F7FF/000000?text=Healthcare+Logo" alt="Healthcare related image">
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <div class="language-selector-wrapper">
            <select id="languageSelect" aria-label="Select Language" class="p-2 border border-gray-300 rounded-md text-sm bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300">
                <option value="ta">தமிழ்</option>
                <option value="en">English</option>
            </select>
        </div>

        <div id="initialView">
            <h1 id="mainTitle" class="text-3xl font-bold text-gray-800 mb-4 lg:text-4xl"></h1>
            <p id="descriptionText" class="text-gray-600 mb-8 text-lg"></p>

            <h2 id="tipSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <div class="input-wrapper">
                <input type="text" id="goalInput" class="input-field" aria-label="உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும்">
                <button id="micBtn" class="mic-button" title="உங்கள் இலக்கைப் பேசுங்கள்" aria-label="உங்கள் ஆரோக்கிய இலக்கைப் பதிவு செய்யவும்">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                </button>
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="generateBtn" class="generate-button">✨ <span data-label-key="generateBtn"></span></button>
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="aiVoiceBtn" class="ai-voice-button" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
                <select id="ttsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
            </div>
            <div id="loading" class="loading-indicator" aria-live="polite">
                <div class="loading-spinner"></div>
                <p id="loadingText"></p>
            </div>
            <div id="tipOutput" class="tip-box" aria-live="polite"></div>

            <hr class="border-t border-gray-300 my-8">

            <h2 id="featuresTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <button id="toggleFeaturesBtn" class="features-toggle-button" title="அனைத்து அம்சங்களையும் காண்க">
                ✨<span class="label" data-label-key="showFeaturesLabel"></span>
            </button>
        </div>

        <!-- This div will now contain both the list of icons and the individual feature sections -->
        <div id="featuresContainer" style="display: none;">
            <!-- This button takes you back to the initial view from the features section -->
            <button class="back-button" id="backToMainFromFeaturesContainer" style="display: none;">← <span data-label-key="backToMain"></span></button>
            <h1 id="featuresPageTitle" class="text-3xl font-bold text-gray-800 mb-6 mt-4 lg:text-4xl"></h1>

            <!-- All feature icons container -->
            <div id="allFeatureIconsContainer" class="feature-icon-container">
                <div id="iconStepTracker" class="feature-icon" data-section="stepTrackerSection" title="படி டிராக்கர்">👟<span class="label" data-label-key="stepTrackerLabel"></span></div>
                <div id="iconHeartRateTracker" class="feature-icon" data-section="heartRateTrackerSection" title="இதயத் துடிப்பு டிராக்கர்">💓<span class="label" data-label-key="heartRateTrackerLabel"></span></div>
                <div id="iconWaterTracker" class="feature-icon" data-section="waterTrackerSection" title="தண்ணீர் டிராக்கர்">💧<span class="label" data-label-key="waterTrackerLabel"></span></div>
                <div id="iconJournal" class="feature-icon" data-section="journalSection" title="மனநிலை & நன்றியுணர்வு ஜர்னல்">📝<span class="label" data-label-key="journalLabel"></span></div>
                <div id="iconLocalTips" class="feature-icon" data-section="localTipsSection" title="பாரம்பரிய உணவு & காய்கறி குறிப்புகள்">🌱<span class="label" data-label-key="localTipsLabel"></span></div>
                <div id="iconMealPlan" class="feature-icon" data-section="mealPlanSection" title="உணவுத் திட்டப் பரிந்துரைகள்">🍽️<span class="label" data-label-key="mealPlanLabel"></span></div>
                <div id="iconMoodAnalysis" class="feature-icon" data-section="moodAnalysisSection" title="உணர்வுப் பதிவேடு பகுப்பாய்வு">🧠<span class="label" data-label-key="moodAnalysisLabel"></span></div>
                <div id="iconExerciseYoga" class="feature-icon" data-section="exerciseRoutineSection" title="உடற்பயிற்சி & யோகா">🤸‍♀️<span class="label" data-label-key="exerciseYogaLabel"></span></div>
                <div id="iconDiseasePrevention" class="feature-icon" data-section="diseasePreventionSection" title="நோய் தடுப்பு">🛡️<span class="label" data-label-key="diseasePreventionLabel"></span></div>
                <div id="iconWellnessChallenge" class="feature-icon" data-section="wellnessChallengeSection" title="ஆரோக்கிய சவால்கள்">🏅<span class="label" data-label-key="wellnessChallengeLabel"></span></div>
                <div id="iconMedicationReminder" class="feature-icon" data-section="medicationReminderSection" title="மருந்து நினைவூட்டல்">⏰<span class="label" data-label-key="medicationReminderLabel"></span></div>
                <div id="iconBodyPainMapping" class="feature-icon" data-section="bodyPainMappingSection" title="உடல் வலி மேப்பிங்">📍<span class="label" data-label-key="bodyPainMappingLabel"></span></div>
                <div id="iconFirstAidEmergency" class="feature-icon" data-section="firstAidEmergencySection" title="முதலுதவி & அவசர உதவி">🆘<span class="label" data-label-key="firstAidEmergencyLabel"></span></div>
                <!-- New Symptom Checker Icon -->
                <div id="iconSymptomChecker" class="feature-icon" data-section="symptomCheckerSection" title="அறிகுறி சரிபார்ப்பு">🩺<span class="label" data-label-key="symptomCheckerLabel"></span></div>
            </div>

            <!-- All feature sections are now children of featuresContainer -->
            <div id="stepTrackerSection" class="feature-section">
                <!-- Data target for back button now points to the icons container -->
                <button class="back-button" data-target="allFeatureIconsContainer">← <span data-label-key="backToFeatures"></span></button>
                <h2 id="stepSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <div class="input-wrapper">
                    <label for="currentStepsDisplay" class="sr-only">தற்போதைய படிகள்</label>
                    <input type="text" id="currentStepsDisplay" class="input-field" value="0" readonly aria-atomic="true">
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="addOneStepBtn" class="action-button"></button>
                    <button id="addSingleStepBtn" class="action-button"></button> <!-- New button for single step -->
                    <button id="toggleTrackingBtn" class="action-button"></button>
                    <button id="resetStepsBtn" class="action-button"></button>
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="stepTipAiVoiceBtn" class="ai-voice-button" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>
                    </button>
                    <select id="stepTipTtsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
                </div>
                <div id="stepResultOutput" class="result-box" aria-live="polite"></div>
                <div id="stepTipOutput" class="tip-box" aria-live="polite"></div> <!-- Dedicated tip output -->
            </div>

            <div id="heartRateTrackerSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← <span data-label-key="backToFeatures"></span></button>
                <h2 id="heartRateSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <div class="input-wrapper">
                    <label for="currentHeartRateDisplay" class="sr-only">தற்போதைய இதயத் துடிப்பு</label>
                    <input type="text" id="currentHeartRateDisplay" class="input-field" value="0" readonly aria-atomic="true">
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="simulateHeartRateBtn" class="action-button"></button>
                    <button id="resetHeartRateBtn" class="action-button"></button>
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="heartRateTipAiVoiceBtn" class="ai-voice-button" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>
                    </button>
                    <select id="heartRateTipTtsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
                </div>
                <div id="heartRateResultOutput" class="result-box" aria-live="polite"></div>
                <div id="heartRateTipOutput" class="tip-box" aria-live="polite"></div> <!-- Dedicated tip output -->
            </div>

            <div id="waterTrackerSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← <span data-label-key="backToFeatures"></span></button>
                <h2 id="waterSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <div class="input-wrapper">
                    <label for="waterIntakeDisplay" class="sr-only">தற்போதைய தண்ணீர் உட்கொள்ளல்</label>
                    <input type="text" id="waterIntakeDisplay" class="input-field" value="0 ml" readonly aria-atomic="true">
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="addWaterBtn" class="action-button"></button>
                    <button id="resetWaterBtn" class="action-button"></button>
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="waterTipAiVoiceBtn" class="ai-voice-button" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>
                    </button>
                    <select id="waterTipTtsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
                </div>
                <div id="waterResultOutput" class="result-box" aria-live="polite"></div>
                <div id="waterTipOutput" class="tip-box" aria-live="polite"></div> <!-- Dedicated tip output -->
            </div>

            <div id="journalSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← <span data-label-key="backToFeatures"></span></button>
                <h2 id="journalSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="journalDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="moodSelect" class="sr-only">உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்</label>
                    <select id="moodSelect" class="input-field mb-4" aria-label="உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்">
                        <option value="">உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்</option>
                        <option value="happy">மகிழ்ச்சி 😄</option>
                        <option value="neutral">சாதாரணம் 😐</option>
                        <option value="sad">சோகம் 😔</option>
                        <option value="stressed">மன அழுத்தம் 😩</option>
                        <option value="energetic">ஆற்றல் 💪</option>
                    </select>
                    <label for="gratitudeInput" class="sr-only">நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்</label>
                    <textarea id="gratitudeInput" class="input-field min-h-[100px]" placeholder="நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்..." aria-label="நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்"></textarea>
                </div>
                <button id="saveJournalEntryBtn" class="action-button mt-4"></button>
                <div id="journalEntriesOutput" class="result-box mt-4 text-left"></div>
                <button id="analyzeMoodJournalBtn" class="action-button mt-4">✨ <span data-label-key="analyzeMoodJournalBtn"></span></button>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="moodAnalysisAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>
                    </button>
                    <select id="moodAnalysisTtsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
                </div>
                <div id="moodAnalysisOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
            </div>

            <div id="localTipsSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← <span data-label-key="backToFeatures"></span></button>
                <h2 id="localTipsSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="localTipsDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper mb-4"> <!-- Nested input-wrapper for mic -->
                    <input type="text" id="localTipCategory" class="input-field" aria-label="உதவிக்குறிப்பு வகையை உள்ளிடவும்" placeholder="எ.கா. மஞ்சள், முருங்கை, தியானம்...">
                    <button id="localTipMicBtn" class="mic-button" title="உதவிக்குறிப்பு வகையை பேசவும்" aria-label="உதவிக்குறிப்பு வகையைப் பதிவு செய்யவும்">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                </div>
                <button id="getLocalTipsBtn" class="action-button mt-4">✨ <span data-label-key="getLocalTipsBtn"></span></button>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="localTipsAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>
                    </button>
                    <select id="localTipsTtsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
                </div>
                <div id="localTipsOutput" class="result-box mt-4 text-left"></div>
            </div>

            <!-- Personalized Diet Plan Section -->
            <div id="mealPlanSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← <span data-label-key="backToFeatures"></span></button>
                <h2 id="mealPlanSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="mealPlanDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="dietaryPreferences" class="sr-only">உங்கள் உணவு விருப்பத்தேர்வுகள்</label>
                    <input type="text" id="dietaryPreferences" class="input-field mb-4" placeholder="உங்கள் உணவு விருப்பத்தேர்வுகள் (எ.கா: சைவம், அசைவம், வீகன்)" aria-label="உங்கள் உணவு விருப்பத்தேர்வுகள்">
                    <label for="allergies" class="sr-only">ஒவ்வாமைகள்</label>
                    <input type="text" id="allergies" class="input-field mb-4" placeholder="ஏதேனும் ஒவ்வாமைகள் (எ.கா: நட்ஸ், பால் பொருட்கள்)" aria-label="ஏதேனும் ஒவ்வாமைகள்">
                    <label for="healthGoals" class="sr-only">உங்கள் ஆரோக்கிய இலக்குகள்</label>
                    <textarea id="healthGoals" class="input-field min-h-[100px]" placeholder="உங்கள் ஆரோக்கிய இலக்குகள் (எ.கா: எடை குறைப்பு, தசை வளர்ச்சி, பொது ஆரோக்கியம்)" aria-label="உங்கள் ஆரோக்கிய இலக்குகள்"></textarea>
                </div>
                <button id="generateDietPlanBtn" class="action-button mt-4">✨ <span data-label-key="generateDietPlanBtn"></span></button>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="dietPlanAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>
                    </button>
                    <select id="dietPlanTtsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
                </div>
                <div id="dietPlanOutput" class="result-box mt-4 text-left"></div>
            </div>

            <!-- Exercise Routine Generator Section -->
            <div id="exerciseRoutineSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← <span data-label-key="backToFeatures"></span></button>
                <h2 id="exerciseRoutineSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="exerciseRoutineDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="fitnessLevel" class="sr-only">உங்கள் உடற்பயிற்சி நிலை</label>
                    <input type="text" id="fitnessLevel" class="input-field mb-4" placeholder="உங்கள் உடற்பயிற்சி நிலை (எ.கா: ஆரம்பநிலை, இடைநிலை, மேம்பட்ட)" aria-label="உங்கள் உடற்பயிற்சி நிலை">
                    <label for="equipmentAvailable" class="sr-only">கிடைக்கும் உபகரணங்கள்</label>
                    <input type="text" id="equipmentAvailable" class="input-field mb-4" placeholder="கிடைக்கும் உபகரணங்கள் (எ.கா: எதுவும் இல்லை, டம்பல்ஸ், ஜிம்)" aria-label="கிடைக்கும் உபகரணங்கள்">
                    <label for="timeAvailable" class="sr-only">கிடைக்கும் நேரம்</label>
                    <input type="text" id="timeAvailable" class="input-field mb-4" placeholder="கிடைக்கும் நேரம் (எ.கா: 30 நிமிடங்கள், 60 நிமிடங்கள்)" aria-label="கிடைக்கும் நேரம்">
                </div>
                <button id="generateExerciseRoutineBtn" class="action-button mt-4">✨ <span data-label-key="generateExerciseRoutineBtn"></span></button>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="exerciseRoutineAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>
                    </button>
                    <select id="exerciseRoutineTtsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
                </div>
                <div id="exerciseRoutineOutput" class="result-box mt-4 text-left"></div>
            </div>

            <!-- Symptom Checker Section -->
            <div id="symptomCheckerSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← <span data-label-key="backToFeatures"></span></button>
                <h2 id="symptomCheckerSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="symptomCheckerDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="symptomsInput" class="sr-only">உங்கள் அறிகுறிகளை உள்ளிடவும்</label>
                    <textarea id="symptomsInput" class="input-field min-h-[100px]" placeholder="உங்கள் அறிகுறிகளை விவரிக்கவும் (எ.கா: தலைவலி, காய்ச்சல், இருமல், உடல் வலி)" aria-label="உங்கள் அறிகுறிகளை உள்ளிடவும்"></textarea>
                </div>
                <button id="checkSymptomsBtn" class="action-button mt-4">✨ <span data-label-key="checkSymptomsBtn"></span></button>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="symptomCheckerAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>
                    </button>
                    <select id="symptomCheckerTtsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
                </div>
                <div id="symptomCheckerOutput" class="result-box mt-4 text-left"></div>
            </div>

            <!-- Existing sections (mood analysis, disease prevention, etc.) would go here -->
            <div id="moodAnalysisSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← <span data-label-key="backToFeatures"></span></button>
                <h2 id="moodAnalysisSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="moodAnalysisDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="moodAnalysisInput" class="sr-only">உங்கள் மனநிலை உள்ளீட்டை உள்ளிடவும்</label>
                    <textarea id="moodAnalysisInput" class="input-field min-h-[100px]" placeholder="உங்கள் மனநிலை உள்ளீட்டை உள்ளிடவும் (எ.கா: நான் இன்று மிகவும் மகிழ்ச்சியாக உணர்கிறேன், ஏனெனில் நான் ஒரு புதிய திட்டத்தை முடித்தேன்.)" aria-label="உங்கள் மனநிலை உள்ளீட்டை உள்ளிடவும்"></textarea>
                </div>
                <button id="analyzeMoodBtn" class="action-button mt-4">✨ <span data-label-key="analyzeMoodBtn"></span></button>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="moodAnalysisResultAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>
                    </button>
                    <select id="moodAnalysisResultTtsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
                </div>
                <div id="moodAnalysisOutput" class="result-box mt-4 text-left"></div>
            </div>

            <div id="diseasePreventionSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← <span data-label-key="backToFeatures"></span></button>
                <h2 id="diseasePreventionSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="diseasePreventionDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="diseasePreventionQuery" class="sr-only">நீங்கள் எந்த நோயைப் பற்றி அறிய விரும்புகிறீர்கள்?</label>
                    <input type="text" id="diseasePreventionQuery" class="input-field mb-4" placeholder="நீங்கள் எந்த நோயைப் பற்றி அறிய விரும்புகிறீர்கள்? (எ.கா: சர்க்கரை நோய், இதய நோய், புற்றுநோய்)" aria-label="நீங்கள் எந்த நோயைப் பற்றி அறிய விரும்புகிறீர்கள்?">
                </div>
                <button id="getPreventionTipsBtn" class="action-button mt-4">✨ <span data-label-key="getPreventionTipsBtn"></span></button>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="diseasePreventionAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>
                    </button>
                    <select id="diseasePreventionTtsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
                </div>
                <div id="diseasePreventionOutput" class="result-box mt-4 text-left"></div>
            </div>

            <div id="wellnessChallengeSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← <span data-label-key="backToFeatures"></span></button>
                <h2 id="wellnessChallengeSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="wellnessChallengeDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="challengeType" class="sr-only">சவால் வகை</label>
                    <input type="text" id="challengeType" class="input-field mb-4" placeholder="நீங்கள் எந்த வகையான சவாலை விரும்புகிறீர்கள்? (எ.கா: 30 நாள் உடற்பயிற்சி, நீர் அருந்துதல், தியானம்)" aria-label="நீங்கள் எந்த வகையான சவாலை விரும்புகிறீர்கள்?">
                </div>
                <button id="generateChallengeBtn" class="action-button mt-4">✨ <span data-label-key="generateChallengeBtn"></span></button>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="wellnessChallengeAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>
                    </button>
                    <select id="wellnessChallengeTtsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
                </div>
                <div id="wellnessChallengeOutput" class="result-box mt-4 text-left"></div>
            </div>

            <div id="medicationReminderSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← <span data-label-key="backToFeatures"></span></button>
                <h2 id="medicationReminderSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="medicationReminderDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="medicationName" class="sr-only">மருந்தின் பெயர்</label>
                    <input type="text" id="medicationName" class="input-field mb-4" placeholder="மருந்தின் பெயர் (எ.கா: பாராசிட்டமால்)" aria-label="மருந்தின் பெயர்">
                    <label for="medicationTime" class="sr-only">நேரம் (HH:MM)</label>
                    <input type="time" id="medicationTime" class="input-field mb-4" aria-label="நேரம் (HH:MM)">
                </div>
                <button id="setReminderBtn" class="action-button mt-4"></button>
                <div id="upcomingRemindersOutput" class="result-box mt-4 text-left"></div>
            </div>

            <div id="bodyPainMappingSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← <span data-label-key="backToFeatures"></span></button>
                <h2 id="bodyPainMappingSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="bodyPainMappingDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="body-map-container">
                    <img id="bodyMapImage" class="body-map-image" src="https://placehold.co/300x500/E6F7FF/000000?text=Body+Map" alt="Human Body Map for Pain">
                    <!-- Pain dots will be added here dynamically -->
                </div>
                <div class="input-wrapper flex-col items-stretch mt-4">
                    <label for="painDescription" class="sr-only">வலியை விவரிக்கவும்</label>
                    <textarea id="painDescription" class="input-field min-h-[80px]" placeholder="வலியை விவரிக்கவும் (எ.கா: கூர்மையான வலி, துடிக்கும் வலி)" aria-label="வலியை விவரிக்கவும்"></textarea>
                </div>
                <button id="savePainEntryBtn" class="action-button mt-4"></button>
                <div id="painEntriesOutput" class="result-box mt-4 text-left"></div>
                <button id="analyzePainBtn" class="action-button mt-4">✨ <span data-label-key="analyzePainBtn"></span></button>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="painAnalysisAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>
                    </button>
                    <select id="painAnalysisTtsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
                </div>
                <div id="painAnalysisOutput" class="result-box mt-4 text-left"></div>
            </div>

            <div id="firstAidEmergencySection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← <span data-label-key="backToFeatures"></span></button>
                <h2 id="firstAidEmergencySectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="firstAidEmergencyDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="emergencyQuery" class="sr-only">அவசர உதவி அல்லது முதலுதவி பற்றி நீங்கள் எதை அறிய விரும்புகிறீர்கள்?</label>
                    <textarea id="emergencyQuery" class="input-field min-h-[100px]" placeholder="அவசர உதவி அல்லது முதலுதவி பற்றி நீங்கள் எதை அறிய விரும்புகிறீர்கள்? (எ.கா: தீக்காயத்திற்கு முதலுதவி, மூச்சுத்திணறல் ஏற்பட்டால் என்ன செய்வது)" aria-label="நீங்கள் எதைப் பற்றி அறிய விரும்புகிறீர்கள்?"></textarea>
                </div>
                <button id="getEmergencyInfoBtn" class="action-button mt-4">✨ <span data-label-key="getEmergencyInfoBtn"></span></button>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="emergencyInfoAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>
                    </button>
                    <select id="emergencyInfoTtsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
                </div>
                <div id="emergencyInfoOutput" class="result-box mt-4 text-left"></div>
            </div>


        </div>
    </div>

    <!-- Alarm Modal -->
    <div id="alarmModal" class="alarm-modal">
        <div class="alarm-modal-content">
            <h3 id="alarmModalTitle"></h3>
            <p id="alarmModalMessage"></p>
            <button id="alarmModalCloseBtn"></button>
        </div>
    </div>

    <script type="module">
        // Global variables for speech recognition and synthesis
        let recognition;
        let synth = window.speechSynthesis;
        let currentLanguage = 'ta'; // Default language
        let selectedVoice = null;
        let speaking = false; // To track if TTS is currently speaking

        // Tone.js setup for alarm sound
        const alarmSynth = new Tone.Synth().toDestination();

        // Translations object
        const translations = {
            ta: {
                mainTitle: "ஆரோக்கிய நண்பன் - உங்கள் ஆரோக்கிய வழிகாட்டி",
                descriptionText: "உங்கள் ஆரோக்கிய இலக்குகளை அடையவும், ஆரோக்கியமான வாழ்க்கையை வாழவும் உதவும் ஒரு தனிப்பட்ட வழிகாட்டி.",
                tipSectionTitle: "உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும்:",
                generateBtn: "ஆரோக்கிய குறிப்பைப் பெறுங்கள்",
                loadingText: "ஆரோக்கிய குறிப்பை உருவாக்குகிறேன்...",
                tipOutputPlaceholder: "உங்கள் ஆரோக்கிய இலக்கை உள்ளிட்டு, ஒரு தனிப்பயனாக்கப்பட்ட குறிப்பைப் பெறுங்கள்.",
                showFeaturesLabel: "அனைத்து அம்சங்களையும் காண்க",
                featuresPageTitle: "ஆரோக்கிய நண்பன் அம்சங்கள்",
                backToMain: "முக்கிய பக்கத்திற்குத் திரும்பு",
                backToFeatures: "அம்சங்களுக்குத் திரும்பு",
                // Feature specific translations
                stepTrackerLabel: "படி டிராக்கர்",
                stepSectionTitle: "படி டிராக்கர்",
                addOneStepBtn: "ஒரு படி சேர்",
                addSingleStepBtn: "படி சேர்",
                toggleTrackingBtn: "டிராக்கிங்கைத் தொடங்கு/நிறுத்து",
                resetStepsBtn: "படிகளை மீட்டமை",
                stepResultOutputPlaceholder: "உங்கள் படிகளின் எண்ணிக்கை இங்கே தோன்றும்.",
                stepTipOutputPlaceholder: "படி டிராக்கர் பற்றிய குறிப்புகள் இங்கே தோன்றும்.",
                heartRateTrackerLabel: "இதயத் துடிப்பு டிராக்கர்",
                heartRateSectionTitle: "இதயத் துடிப்பு டிராக்கர்",
                simulateHeartRateBtn: "இதயத் துடிப்பை உருவகப்படுத்து",
                resetHeartRateBtn: "இதயத் துடிப்பை மீட்டமை",
                heartRateResultOutputPlaceholder: "உங்கள் இதயத் துடிப்பு இங்கே தோன்றும்.",
                heartRateTipOutputPlaceholder: "இதயத் துடிப்பு பற்றிய குறிப்புகள் இங்கே தோன்றும்.",
                waterTrackerLabel: "தண்ணீர் டிராக்கர்",
                waterSectionTitle: "தண்ணீர் டிராக்கர்",
                addWaterBtn: "தண்ணீர் சேர் (250ml)",
                resetWaterBtn: "தண்ணீரை மீட்டமை",
                waterResultOutputPlaceholder: "உங்கள் தண்ணீர் உட்கொள்ளல் இங்கே தோன்றும்.",
                waterTipOutputPlaceholder: "தண்ணீர் உட்கொள்ளல் பற்றிய குறிப்புகள் இங்கே தோன்றும்.",
                journalLabel: "மனநிலை & நன்றியுணர்வு ஜர்னல்",
                journalSectionTitle: "மனநிலை & நன்றியுணர்வு ஜர்னல்",
                journalDescription: "உங்கள் மனநிலையைப் பதிவுசெய்து, நீங்கள் நன்றியுள்ள விஷயங்களை எழுதுங்கள். இது உங்கள் உணர்வுகளைப் புரிந்துகொள்ள உதவும்.",
                saveJournalEntryBtn: "பதிவைச் சேமி",
                analyzeMoodJournalBtn: "மனநிலையை பகுப்பாய்வு செய்",
                moodAnalysisLabel: "உணர்வுப் பதிவேடு பகுப்பாய்வு",
                moodAnalysisSectionTitle: "உணர்வுப் பதிவேடு பகுப்பாய்வு",
                moodAnalysisDescription: "உங்கள் ஜர்னல் உள்ளீடுகளை பகுப்பாய்வு செய்து, உங்கள் மனநிலை போக்குகளைப் புரிந்து கொள்ளுங்கள்.",
                analyzeMoodBtn: "மனநிலையை பகுப்பாய்வு செய்",
                localTipsLabel: "பாரம்பரிய உணவு & காய்கறி குறிப்புகள்", // Updated
                localTipsSectionTitle: "பாரம்பரிய உணவு & காய்கறி குறிப்புகள்", // Updated
                localTipsDescription: "உங்கள் விருப்பங்களின் அடிப்படையில் பாரம்பரிய உணவு மற்றும் காய்கறி குறிப்புகளைப் பெறுங்கள்.", // Updated
                getLocalTipsBtn: "குறிப்புகளைப் பெறுங்கள்",
                mealPlanLabel: "உணவுத் திட்டப் பரிந்துரைகள்",
                mealPlanSectionTitle: "தனிப்பயனாக்கப்பட்ட உணவுத் திட்டம்",
                mealPlanDescription: "உங்கள் விருப்பத்தேர்வுகள், ஒவ்வாமைகள் மற்றும் ஆரோக்கிய இலக்குகளின் அடிப்படையில் தனிப்பயனாக்கப்பட்ட உணவுத் திட்டத்தைப் பெறுங்கள்.",
                generateDietPlanBtn: "உணவுத் திட்டத்தை உருவாக்கு",
                exerciseYogaLabel: "உடற்பயிற்சி & யோகா",
                exerciseRoutineSectionTitle: "உடற்பயிற்சி வழக்கத்தை உருவாக்குபவர்",
                exerciseRoutineDescription: "உங்கள் உடற்பயிற்சி நிலை, கிடைக்கும் உபகரணங்கள் மற்றும் நேரத்தின் அடிப்படையில் தனிப்பயனாக்கப்பட்ட உடற்பயிற்சி வழக்கத்தைப் பெறுங்கள்.",
                generateExerciseRoutineBtn: "உடற்பயிற்சி வழக்கத்தை உருவாக்கு",
                diseasePreventionLabel: "நோய் தடுப்பு",
                diseasePreventionSectionTitle: "நோய் தடுப்பு",
                diseasePreventionDescription: "பொதுவான நோய்களைத் தடுப்பதற்கான தகவல்கள் மற்றும் குறிப்புகளைப் பெறுங்கள்.",
                getPreventionTipsBtn: "தடுப்பு குறிப்புகளைப் பெறு",
                wellnessChallengeLabel: "ஆரோக்கிய சவால்கள்",
                wellnessChallengeSectionTitle: "ஆரோக்கிய சவால்கள்",
                wellnessChallengeDescription: "உங்கள் ஆரோக்கியத்தை மேம்படுத்த வேடிக்கையான மற்றும் ஊக்கமளிக்கும் சவால்களில் பங்கேற்கவும்.",
                generateChallengeBtn: "சவாலை உருவாக்கு",
                medicationReminderLabel: "மருந்து நினைவூட்டல்",
                medicationReminderSectionTitle: "மருந்து நினைவூட்டல்",
                medicationReminderDescription: "உங்கள் மருந்துகளை சரியான நேரத்தில் எடுத்துக்கொள்ள நினைவூட்டல்களை அமைக்கவும்.",
                setReminderBtn: "நினைவூட்டலை அமை",
                bodyPainMappingLabel: "உடல் வலி மேப்பிங்",
                bodyPainMappingSectionTitle: "உடல் வலி மேப்பிங்",
                bodyPainMappingDescription: "உங்கள் உடலில் வலி உள்ள இடங்களைக் குறிக்கவும், அதன் பகுப்பாய்வைப் பெறவும்.",
                savePainEntryBtn: "வலி பதிவை சேமி",
                analyzePainBtn: "வலியை பகுப்பாய்வு செய்",
                firstAidEmergencyLabel: "முதலுதவி & அவசர உதவி",
                firstAidEmergencySectionTitle: "முதலுதவி & அவசர உதவி",
                firstAidEmergencyDescription: "அவசர காலங்களில் முதலுதவி மற்றும் அவசர உதவி தகவல்களைப் பெறுங்கள்.",
                getEmergencyInfoBtn: "தகவலைப் பெறு",
                symptomCheckerLabel: "அறிகுறி சரிபார்ப்பு",
                symptomCheckerSectionTitle: "அறிகுறி சரிபார்ப்பு",
                symptomCheckerDescription: "உங்கள் அறிகுறிகளை உள்ளிட்டு, சாத்தியமான நிலைமைகள் மற்றும் பொதுவான ஆலோசனைகளைப் பெறுங்கள் (மருத்துவரை அணுகவும்).",
                checkSymptomsBtn: "அறிகுறிகளை சரிபார்க்கவும்",
                alarmModalTitle: "மருந்து நினைவூட்டல்!",
                alarmModalMessage: "உங்கள் மருந்தை எடுத்துக்கொள்ளும் நேரம்!",
                alarmModalCloseBtn: "நிறுத்து",
            },
            en: {
                mainTitle: "Aarogya Nanban - Your Health Guide",
                descriptionText: "A personalized guide to help you achieve your health goals and live a healthier life.",
                tipSectionTitle: "Enter your health goal:",
                generateBtn: "Get Health Tip",
                loadingText: "Generating health tip...",
                tipOutputPlaceholder: "Enter your health goal to get a personalized tip.",
                showFeaturesLabel: "See All Features",
                featuresPageTitle: "Aarogya Nanban Features",
                backToMain: "Back to Main",
                backToFeatures: "Back to Features",
                // Feature specific translations
                stepTrackerLabel: "Step Tracker",
                stepSectionTitle: "Step Tracker",
                addOneStepBtn: "Add One Step",
                addSingleStepBtn: "Add Step",
                toggleTrackingBtn: "Start/Stop Tracking",
                resetStepsBtn: "Reset Steps",
                stepResultOutputPlaceholder: "Your step count will appear here.",
                stepTipOutputPlaceholder: "Tips about step tracking will appear here.",
                heartRateTrackerLabel: "Heart Rate Tracker",
                heartRateSectionTitle: "Heart Rate Tracker",
                simulateHeartRateBtn: "Simulate Heart Rate",
                resetHeartRateBtn: "Reset Heart Rate",
                heartRateResultOutputPlaceholder: "Your heart rate will appear here.",
                heartRateTipOutputPlaceholder: "Tips about heart rate will appear here.",
                waterTrackerLabel: "Water Tracker",
                waterSectionTitle: "Water Tracker",
                addWaterBtn: "Add Water (250ml)",
                resetWaterBtn: "Reset Water",
                waterResultOutputPlaceholder: "Your water intake will appear here.",
                waterTipOutputPlaceholder: "Tips about water intake will appear here.",
                journalLabel: "Mood & Gratitude Journal",
                journalSectionTitle: "Mood & Gratitude Journal",
                journalDescription: "Log your mood and things you're grateful for. This helps understand your emotional patterns.",
                saveJournalEntryBtn: "Save Entry",
                analyzeMoodJournalBtn: "Analyze Mood",
                moodAnalysisLabel: "Mood Entry Analysis",
                moodAnalysisSectionTitle: "Mood Entry Analysis",
                moodAnalysisDescription: "Analyze your journal entries to understand your mood trends.",
                analyzeMoodBtn: "Analyze Mood",
                localTipsLabel: "Traditional Food & Vegetable Tips", // Updated
                localTipsSectionTitle: "Traditional Food & Vegetable Tips", // Updated
                localTipsDescription: "Get traditional food and vegetable tips based on your preferences.", // Updated
                getLocalTipsBtn: "Get Tips",
                mealPlanLabel: "Meal Plan Suggestions",
                mealPlanSectionTitle: "Personalized Diet Plan",
                mealPlanDescription: "Get a personalized diet plan based on your preferences, allergies, and health goals.",
                generateDietPlanBtn: "Generate Diet Plan",
                exerciseYogaLabel: "Exercise & Yoga",
                exerciseRoutineSectionTitle: "Exercise Routine Generator",
                exerciseRoutineDescription: "Get a personalized exercise routine based on your fitness level, available equipment, and time.",
                generateExerciseRoutineBtn: "Generate Exercise Routine",
                diseasePreventionLabel: "Disease Prevention",
                diseasePreventionSectionTitle: "Disease Prevention",
                diseasePreventionDescription: "Get information and tips for preventing common diseases.",
                getPreventionTipsBtn: "Get Prevention Tips",
                wellnessChallengeLabel: "Wellness Challenges",
                wellnessChallengeSectionTitle: "Wellness Challenges",
                wellnessChallengeDescription: "Participate in fun and motivating challenges to boost your well-being.",
                generateChallengeBtn: "Generate Challenge",
                medicationReminderLabel: "Medication Reminder",
                medicationReminderSectionTitle: "Medication Reminder",
                medicationReminderDescription: "Set reminders to take your medications on time.",
                setReminderBtn: "Set Reminder",
                bodyPainMappingLabel: "Body Pain Mapping",
                bodyPainMappingSectionTitle: "Body Pain Mapping",
                bodyPainMappingDescription: "Mark areas of pain on your body and get an analysis.",
                savePainEntryBtn: "Save Pain Entry",
                analyzePainBtn: "Analyze Pain",
                firstAidEmergencyLabel: "First Aid & Emergency",
                firstAidEmergencySectionTitle: "First Aid & Emergency",
                firstAidEmergencyDescription: "Get first aid and emergency information for critical situations.",
                getEmergencyInfoBtn: "Get Info",
                symptomCheckerLabel: "Symptom Checker",
                symptomCheckerSectionTitle: "Symptom Checker",
                symptomCheckerDescription: "Enter your symptoms and get possible conditions and general advice (always consult a doctor).",
                checkSymptomsBtn: "Check Symptoms",
                alarmModalTitle: "Medication Reminder!",
                alarmModalMessage: "Time to take your medication!",
                alarmModalCloseBtn: "Stop",
            }
        };

        // Function to update text content based on current language
        function updateContent() {
            document.getElementById('mainTitle').textContent = translations[currentLanguage].mainTitle;
            document.getElementById('descriptionText').textContent = translations[currentLanguage].descriptionText;
            document.getElementById('tipSectionTitle').textContent = translations[currentLanguage].tipSectionTitle;
            document.querySelector('#generateBtn span').textContent = translations[currentLanguage].generateBtn;
            document.getElementById('loadingText').textContent = translations[currentLanguage].loadingText;
            document.getElementById('tipOutput').innerHTML = `<p>${translations[currentLanguage].tipOutputPlaceholder}</p>`;
            document.getElementById('featuresTitle').textContent = translations[currentLanguage].featuresTitle;
            document.querySelector('#toggleFeaturesBtn span').textContent = translations[currentLanguage].showFeaturesLabel;
            document.querySelector('#backToMainFromFeaturesContainer span').textContent = translations[currentLanguage].backToMain;
            document.getElementById('featuresPageTitle').textContent = translations[currentLanguage].featuresPageTitle;

            // Update feature labels
            document.querySelectorAll('[data-label-key]').forEach(element => {
                const key = element.dataset.labelKey;
                if (translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });

            // Update specific section titles and descriptions
            document.getElementById('stepSectionTitle').textContent = translations[currentLanguage].stepSectionTitle;
            document.getElementById('stepResultOutput').innerHTML = `<p>${translations[currentLanguage].stepResultOutputPlaceholder}</p>`;
            document.getElementById('stepTipOutput').innerHTML = `<p>${translations[currentLanguage].stepTipOutputPlaceholder}</p>`;

            document.getElementById('heartRateSectionTitle').textContent = translations[currentLanguage].heartRateSectionTitle;
            document.getElementById('heartRateResultOutput').innerHTML = `<p>${translations[currentLanguage].heartRateResultOutputPlaceholder}</p>`;
            document.getElementById('heartRateTipOutput').innerHTML = `<p>${translations[currentLanguage].heartRateTipOutputPlaceholder}</p>`;

            document.getElementById('waterSectionTitle').textContent = translations[currentLanguage].waterSectionTitle;
            document.getElementById('waterResultOutput').innerHTML = `<p>${translations[currentLanguage].waterResultOutputPlaceholder}</p>`;
            document.getElementById('waterTipOutput').innerHTML = `<p>${translations[currentLanguage].waterTipOutputPlaceholder}</p>`;

            document.getElementById('journalSectionTitle').textContent = translations[currentLanguage].journalSectionTitle;
            document.getElementById('journalDescription').textContent = translations[currentLanguage].journalDescription;

            document.getElementById('moodAnalysisSectionTitle').textContent = translations[currentLanguage].moodAnalysisSectionTitle;
            document.getElementById('moodAnalysisDescription').textContent = translations[currentLanguage].moodAnalysisDescription;

            document.getElementById('localTipsSectionTitle').textContent = translations[currentLanguage].localTipsSectionTitle;
            document.getElementById('localTipsDescription').textContent = translations[currentLanguage].localTipsDescription;

            document.getElementById('mealPlanSectionTitle').textContent = translations[currentLanguage].mealPlanSectionTitle;
            document.getElementById('mealPlanDescription').textContent = translations[currentLanguage].mealPlanDescription;

            document.getElementById('exerciseRoutineSectionTitle').textContent = translations[currentLanguage].exerciseRoutineSectionTitle;
            document.getElementById('exerciseRoutineDescription').textContent = translations[currentLanguage].exerciseRoutineDescription;

            document.getElementById('diseasePreventionSectionTitle').textContent = translations[currentLanguage].diseasePreventionSectionTitle;
            document.getElementById('diseasePreventionDescription').textContent = translations[currentLanguage].diseasePreventionDescription;

            document.getElementById('wellnessChallengeSectionTitle').textContent = translations[currentLanguage].wellnessChallengeSectionTitle;
            document.getElementById('wellnessChallengeDescription').textContent = translations[currentLanguage].wellnessChallengeDescription;

            document.getElementById('medicationReminderSectionTitle').textContent = translations[currentLanguage].medicationReminderSectionTitle;
            document.getElementById('medicationReminderDescription').textContent = translations[currentLanguage].medicationReminderDescription;

            document.getElementById('bodyPainMappingSectionTitle').textContent = translations[currentLanguage].bodyPainMappingSectionTitle;
            document.getElementById('bodyPainMappingDescription').textContent = translations[currentLanguage].bodyPainMappingDescription;

            document.getElementById('firstAidEmergencySectionTitle').textContent = translations[currentLanguage].firstAidEmergencySectionTitle;
            document.getElementById('firstAidEmergencyDescription').textContent = translations[currentLanguage].firstAidEmergencyDescription;

            document.getElementById('symptomCheckerSectionTitle').textContent = translations[currentLanguage].symptomCheckerSectionTitle;
            document.getElementById('symptomCheckerDescription').textContent = translations[currentLanguage].symptomCheckerDescription;

            // Update placeholder texts
            document.getElementById('goalInput').placeholder = translations[currentLanguage].tipSectionTitle.replace(':', '');
            document.getElementById('gratitudeInput').placeholder = translations[currentLanguage].journalDescription.split('.')[0] + '...';
            document.getElementById('localTipCategory').placeholder = translations[currentLanguage].localTipsDescription.split('.')[1] ? translations[currentLanguage].localTipsDescription.split('.')[1].trim() + '...' : translations[currentLanguage].localTipsDescription + '...'; // Updated
            document.getElementById('dietaryPreferences').placeholder = translations[currentLanguage].mealPlanDescription.split('.')[0] + '...';
            document.getElementById('allergies').placeholder = translations[currentLanguage].mealPlanDescription.split('.')[1] ? translations[currentLanguage].mealPlanDescription.split('.')[1].trim() + '...' : '';
            document.getElementById('healthGoals').placeholder = translations[currentLanguage].mealPlanDescription.split('.')[2] ? translations[currentLanguage].mealPlanDescription.split('.')[2].trim() + '...' : '';
            document.getElementById('fitnessLevel').placeholder = translations[currentLanguage].exerciseRoutineDescription.split('.')[0] + '...';
            document.getElementById('equipmentAvailable').placeholder = translations[currentLanguage].exerciseRoutineDescription.split('.')[1] ? translations[currentLanguage].exerciseRoutineDescription.split('.')[1].trim() + '...' : '';
            document.getElementById('timeAvailable').placeholder = translations[currentLanguage].exerciseRoutineDescription.split('.')[2] ? translations[currentLanguage].exerciseRoutineDescription.split('.')[2].trim() + '...' : '';
            document.getElementById('diseasePreventionQuery').placeholder = translations[currentLanguage].diseasePreventionDescription.split('.')[0] + '...';
            document.getElementById('challengeType').placeholder = translations[currentLanguage].wellnessChallengeDescription.split('.')[0] + '...';
            document.getElementById('medicationName').placeholder = translations[currentLanguage].medicationReminderDescription.split('.')[0] + '...';
            document.getElementById('painDescription').placeholder = translations[currentLanguage].bodyPainMappingDescription.split('.')[0] + '...';
            document.getElementById('emergencyQuery').placeholder = translations[currentLanguage].firstAidEmergencyDescription.split('.')[0] + '...';
            document.getElementById('symptomsInput').placeholder = translations[currentLanguage].symptomCheckerDescription.split('.')[0] + '...';

            // Update alarm modal content
            document.getElementById('alarmModalTitle').textContent = translations[currentLanguage].alarmModalTitle;
            document.getElementById('alarmModalMessage').textContent = translations[currentLanguage].alarmModalMessage;
            document.getElementById('alarmModalCloseBtn').textContent = translations[currentLanguage].alarmModalCloseBtn;
        }

        // Language selection
        const languageSelect = document.getElementById('languageSelect');
        languageSelect.addEventListener('change', (event) => {
            currentLanguage = event.target.value;
            updateContent();
            populateVoiceList(); // Repopulate voices for the new language
        });

        // Speech Recognition (Web Speech API) for main goal input
        const micBtn = document.getElementById('micBtn');
        const goalInput = document.getElementById('goalInput');
        let isRecording = false;

        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US'; // Set recognition language

            recognition.onstart = () => {
                isRecording = true;
                micBtn.classList.add('recording');
                goalInput.placeholder = currentLanguage === 'ta' ? 'பேசவும்...' : 'Speaking...';
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                goalInput.value = transcript;
                isRecording = false;
                micBtn.classList.remove('recording');
                updateContent(); // Reset placeholder
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                isRecording = false;
                micBtn.classList.remove('recording');
                goalInput.placeholder = currentLanguage === 'ta' ? 'பேசத் தவறிவிட்டது. மீண்டும் முயற்சிக்கவும்.' : 'Speech failed. Try again.';
                updateContent(); // Reset placeholder
            };

            recognition.onend = () => {
                isRecording = false;
                micBtn.classList.remove('recording');
                updateContent(); // Reset placeholder
            };

            micBtn.addEventListener('click', () => {
                if (isRecording) {
                    recognition.stop();
                } else {
                    recognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';
                    recognition.start();
                }
            });
        } else {
            micBtn.style.display = 'none'; // Hide mic button if not supported
            console.warn('Web Speech API (webkitSpeechRecognition) not supported in this browser for main input.');
        }

        // Text-to-Speech (TTS) (Web Speech API)
        const aiVoiceBtn = document.getElementById('aiVoiceBtn');
        const ttsVoiceSelect = document.getElementById('ttsVoiceSelect');
        let voices = [];

        function populateVoiceList() {
            voices = synth.getVoices().sort((a, b) => {
                const aname = a.name.toUpperCase();
                const bname = b.name.toUpperCase();
                if (aname < bname) return -1;
                if (aname == bname) return 0;
                return +1;
            });

            // Clear existing options
            ttsVoiceSelect.innerHTML = '';

            // Filter voices by current language
            const filteredVoices = voices.filter(voice => voice.lang.startsWith(currentLanguage));

            // Add a default "Auto" option
            const autoOption = document.createElement('option');
            autoOption.textContent = currentLanguage === 'ta' ? 'தானியங்கு' : 'Auto';
            autoOption.value = 'auto';
            ttsVoiceSelect.appendChild(autoOption);

            filteredVoices.forEach((voice) => {
                const option = document.createElement('option');
                option.textContent = `${voice.name} (${voice.lang})`;
                option.value = voice.name;
                ttsVoiceSelect.appendChild(option);
            });

            // Set the selected voice if one was previously chosen
            if (selectedVoice) {
                ttsVoiceSelect.value = selectedVoice.name;
            } else if (filteredVoices.length > 0) {
                // Otherwise, select the first available voice for the language
                selectedVoice = filteredVoices[0];
                ttsVoiceSelect.value = filteredVoices[0].name;
            }
        }

        // Populate voices when they are loaded
        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = populateVoiceList;
        }

        // Handle voice selection change
        ttsVoiceSelect.addEventListener('change', (event) => {
            if (event.target.value === 'auto') {
                selectedVoice = null; // Let the browser choose
            } else {
                selectedVoice = voices.find(voice => voice.name === event.target.value);
            }
        });

        // Function to speak text
        function speakText(text, voiceSelectElement, aiVoiceButtonElement) {
            if (!synth) {
                console.error('SpeechSynthesis not available.');
                return;
            }
            if (synth.speaking) {
                synth.cancel(); // Stop current speech if any
                speaking = false;
                if (aiVoiceButtonElement) aiVoiceButtonElement.classList.remove('recording');
                return;
            }

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = currentLanguage; // Set utterance language

            // If "Auto" is selected, or no specific voice is chosen, let browser pick
            if (voiceSelectElement.value === 'auto' || !selectedVoice) {
                utterance.voice = voices.find(voice => voice.lang.startsWith(currentLanguage));
            } else {
                utterance.voice = selectedVoice;
            }

            utterance.onstart = () => {
                speaking = true;
                if (aiVoiceButtonElement) aiVoiceButtonElement.classList.add('recording');
            };
            utterance.onend = () => {
                speaking = false;
                if (aiVoiceButtonElement) aiVoiceButtonElement.classList.remove('recording');
            };
            utterance.onerror = (event) => {
                console.error('Speech synthesis error:', event);
                speaking = false;
                if (aiVoiceButtonElement) aiVoiceButtonElement.classList.remove('recording');
            };
            synth.speak(utterance);
        }

        // Event listener for main AI voice button
        aiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = document.getElementById('tipOutput').textContent;
            if (textToSpeak && textToSpeak !== translations[currentLanguage].tipOutputPlaceholder) {
                speakText(textToSpeak, ttsVoiceSelect, aiVoiceBtn);
            }
        });

        // Show/hide AI voice button and selector based on browser support
        if ('speechSynthesis' in window) {
            aiVoiceBtn.style.display = 'inline-flex';
            ttsVoiceSelect.style.display = 'inline-block';
            populateVoiceList(); // Initial population
        } else {
            aiVoiceBtn.style.display = 'none';
            ttsVoiceSelect.style.display = 'none';
            console.warn('Web Speech Synthesis API not supported in this browser.');
        }

        // --- Core LLM Functionality ---
        const generateBtn = document.getElementById('generateBtn');
        const loadingDiv = document.getElementById('loading');
        const tipOutput = document.getElementById('tipOutput');

        generateBtn.addEventListener('click', async () => {
            const goal = goalInput.value.trim();
            if (!goal) {
                tipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும்!' : 'Please enter your health goal!'}</p>`;
                return;
            }

            loadingDiv.style.display = 'flex';
            tipOutput.innerHTML = ''; // Clear previous output
            aiVoiceBtn.style.display = 'none'; // Hide voice button during generation

            try {
                const prompt = `Provide a concise, actionable health tip for the following goal: "${goal}". The tip should be relevant to ${currentLanguage === 'ta' ? 'தமிழ் கலாச்சாரம் மற்றும் உணவுப் பழக்கவழக்கங்கள்' : 'general health and wellness'}.`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = { contents: chatHistory };
                // IMPORTANT: Replace "YOUR_GEMINI_API_KEY" with your actual Gemini API Key.
                // You can obtain one from Google AI Studio: https://aistudio.google.com/
                const apiKey = ""; // <--- INSERT YOUR GEMINI API KEY HERE
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    tipOutput.innerHTML = `<p>${text}</p>`;
                    if ('speechSynthesis' in window) {
                        aiVoiceBtn.style.display = 'inline-flex'; // Show voice button after generation
                    }
                } else {
                    tipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'குறிப்பை உருவாக்க முடியவில்லை. எதிர்பாராத API பதில் அமைப்பு.' : 'Failed to generate tip. Unexpected API response structure.'}</p>`;
                    console.error('Unexpected API response structure:', result);
                }
            } catch (error) {
                console.error('Error generating health tip:', error);
                tipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'குறிப்பை உருவாக்கும்போது பிழை ஏற்பட்டது: ' : 'An error occurred while generating the tip: '}${error.message || 'உங்கள் இணைய இணைப்பைச் சரிபார்த்து மீண்டும் முயற்சிக்கவும்.'}</p>`;
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        // --- Feature Section Management ---
        const initialView = document.getElementById('initialView');
        const featuresContainer = document.getElementById('featuresContainer');
        const toggleFeaturesBtn = document.getElementById('toggleFeaturesBtn');
        const backToMainFromFeaturesContainer = document.getElementById('backToMainFromFeaturesContainer');
        const allFeatureIconsContainer = document.getElementById('allFeatureIconsContainer');

        // Get all feature icon elements
        const featureIcons = document.querySelectorAll('.feature-icon');
        // Get all feature section elements
        const featureSections = document.querySelectorAll('.feature-section');

        // Function to show a specific section and hide others
        function showSection(sectionToShowId) {
            // Hide all primary containers first
            initialView.style.display = 'none';
            featuresContainer.style.display = 'none'; // This will contain either icons or a single feature section

            // Hide all individual feature sections
            featureSections.forEach(section => {
                section.style.display = 'none';
                section.classList.remove('active');
                // Also hide their back buttons by default
                const backButton = section.querySelector('.back-button');
                if (backButton) backButton.style.display = 'none';
            });

            // Hide the main "back to features" button initially
            backToMainFromFeaturesContainer.style.display = 'none';

            // Adjust body styling
            document.body.classList.remove('main-content-active'); // Reset default
            if (sectionToShowId !== 'initialView') {
                document.body.classList.add('main-content-active'); // Apply for any feature view
            }

            if (sectionToShowId === 'initialView') {
                initialView.style.display = 'block';
            } else if (sectionToShowId === 'allFeatureIconsContainer') {
                featuresContainer.style.display = 'block';
                allFeatureIconsContainer.style.display = 'flex'; // Ensure icons container is flex
                backToMainFromFeaturesContainer.style.display = 'inline-flex'; // Show back to main menu
            } else {
                // Showing an individual feature section
                const section = document.getElementById(sectionToShowId);
                if (section) {
                    featuresContainer.style.display = 'block'; // Keep featuresContainer visible
                    allFeatureIconsContainer.style.display = 'none'; // Hide the icons list
                    section.style.display = 'block';
                    section.classList.add('active');
                    // Show the specific back button for this section (back to icons)
                    const backButton = section.querySelector('.back-button');
                    if (backButton) backButton.style.display = 'inline-flex';
                }
            }
        }

        // Event listener for "See All Features" button
        toggleFeaturesBtn.addEventListener('click', () => {
            showSection('allFeatureIconsContainer');
        });

        // Event listener for "Back to Main" button from features container
        backToMainFromFeaturesContainer.addEventListener('click', () => {
            showSection('initialView');
            backToMainFromFeaturesContainer.style.display = 'none'; // Hide itself
        });

        // Event listeners for individual feature icons
        featureIcons.forEach(icon => {
            icon.addEventListener('click', () => {
                const targetSectionId = icon.dataset.section;
                showSection(targetSectionId);
            });
        });

        // Event listeners for "Back to Features" buttons within each feature section
        featureSections.forEach(section => {
            const backButton = section.querySelector('.back-button');
            if (backButton) {
                backButton.addEventListener('click', () => {
                    showSection('allFeatureIconsContainer'); // Go back to the icons list
                    backButton.style.display = 'none'; // Hide itself
                });
            }
        });


        // --- Step Tracker (Existing Feature) ---
        let currentSteps = 0;
        const currentStepsDisplay = document.getElementById('currentStepsDisplay');
        const addOneStepBtn = document.getElementById('addOneStepBtn');
        const addSingleStepBtn = document.getElementById('addSingleStepBtn');
        const toggleTrackingBtn = document.getElementById('toggleTrackingBtn');
        const resetStepsBtn = document.getElementById('resetStepsBtn');
        let isTrackingSteps = false;
        let stepInterval;

        addOneStepBtn.addEventListener('click', () => {
            currentSteps += 1; // Increment by one for simple click
            currentStepsDisplay.value = currentSteps;
            document.getElementById('stepResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? 'ஒரு படி சேர்க்கப்பட்டது!' : 'One step added!'}</p>`;
        });

        addSingleStepBtn.addEventListener('click', () => {
            currentSteps += 1;
            currentStepsDisplay.value = currentSteps;
            document.getElementById('stepResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? 'ஒரு படி சேர்க்கப்பட்டது!' : 'One step added!'}</p>`;
        });

        toggleTrackingBtn.addEventListener('click', () => {
            if (isTrackingSteps) {
                clearInterval(stepInterval);
                isTrackingSteps = false;
                toggleTrackingBtn.textContent = translations[currentLanguage].toggleTrackingBtn;
                document.getElementById('stepResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? 'படி டிராக்கிங் நிறுத்தப்பட்டது.' : 'Step tracking stopped.'}</p>`;
            } else {
                // Simulate step tracking by adding a step every 2 seconds
                stepInterval = setInterval(() => {
                    currentSteps += 1;
                    currentStepsDisplay.value = currentSteps;
                }, 2000); // Add a step every 2 seconds
                isTrackingSteps = true;
                toggleTrackingBtn.textContent = translations[currentLanguage].toggleTrackingBtn;
                document.getElementById('stepResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? 'படி டிராக்கிங் தொடங்கப்பட்டது.' : 'Step tracking started.'}</p>`;
            }
        });

        resetStepsBtn.addEventListener('click', () => {
            currentSteps = 0;
            currentStepsDisplay.value = currentSteps;
            clearInterval(stepInterval);
            isTrackingSteps = false;
            toggleTrackingBtn.textContent = translations[currentLanguage].toggleTrackingBtn;
            document.getElementById('stepResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? 'படிகள் மீட்டமைக்கப்பட்டன.' : 'Steps reset.'}</p>`;
        });

        // Step Tracker AI Voice
        const stepTipAiVoiceBtn = document.getElementById('stepTipAiVoiceBtn');
        const stepTipTtsVoiceSelect = document.getElementById('stepTipTtsVoiceSelect');
        if ('speechSynthesis' in window) {
            stepTipAiVoiceBtn.style.display = 'inline-flex';
            stepTipTtsVoiceSelect.style.display = 'inline-block';
        }
        stepTipAiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = document.getElementById('stepTipOutput').textContent;
            if (textToSpeak && textToSpeak !== translations[currentLanguage].stepTipOutputPlaceholder) {
                speakText(textToSpeak, stepTipTtsVoiceSelect, stepTipAiVoiceBtn);
            }
        });


        // --- Heart Rate Tracker (Existing Feature) ---
        let currentHeartRate = 0;
        const currentHeartRateDisplay = document.getElementById('currentHeartRateDisplay');
        const simulateHeartRateBtn = document.getElementById('simulateHeartRateBtn');
        const resetHeartRateBtn = document.getElementById('resetHeartRateBtn');
        let heartRateInterval;

        simulateHeartRateBtn.addEventListener('click', () => {
            if (heartRateInterval) {
                clearInterval(heartRateInterval);
                heartRateInterval = null;
                simulateHeartRateBtn.textContent = translations[currentLanguage].simulateHeartRateBtn;
                document.getElementById('heartRateResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? 'இதயத் துடிப்பு உருவகப்படுத்துதல் நிறுத்தப்பட்டது.' : 'Heart rate simulation stopped.'}</p>`;
            } else {
                heartRateInterval = setInterval(() => {
                    currentHeartRate = Math.floor(Math.random() * (120 - 60 + 1)) + 60; // Simulate 60-120 bpm
                    currentHeartRateDisplay.value = `${currentHeartRate} bpm`;
                    document.getElementById('heartRateResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? 'தற்போதைய இதயத் துடிப்பு: ' : 'Current Heart Rate: '}${currentHeartRate} bpm</p>`;
                }, 1500);
                simulateHeartRateBtn.textContent = translations[currentLanguage].simulateHeartRateBtn;
                document.getElementById('heartRateResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? 'இதயத் துடிப்பு உருவகப்படுத்துதல் தொடங்கப்பட்டது...' : 'Heart rate simulation started...'}</p>`;
            }
        });

        resetHeartRateBtn.addEventListener('click', () => {
            clearInterval(heartRateInterval);
            heartRateInterval = null;
            currentHeartRate = 0;
            currentHeartRateDisplay.value = currentHeartRate;
            simulateHeartRateBtn.textContent = translations[currentLanguage].simulateHeartRateBtn;
            document.getElementById('heartRateResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? 'இதயத் துடிப்பு மீட்டமைக்கப்பட்டது.' : 'Heart rate reset.'}</p>`;
        });

        // Heart Rate Tracker AI Voice
        const heartRateTipAiVoiceBtn = document.getElementById('heartRateTipAiVoiceBtn');
        const heartRateTipTtsVoiceSelect = document.getElementById('heartRateTipTtsVoiceSelect');
        if ('speechSynthesis' in window) {
            heartRateTipAiVoiceBtn.style.display = 'inline-flex';
            heartRateTipTtsVoiceSelect.style.display = 'inline-block';
        }
        heartRateTipAiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = document.getElementById('heartRateTipOutput').textContent;
            if (textToSpeak && textToSpeak !== translations[currentLanguage].heartRateTipOutputPlaceholder) {
                speakText(textToSpeak, heartRateTipTtsVoiceSelect, heartRateTipAiVoiceBtn);
            }
        });

        // --- Water Tracker (Existing Feature) ---
        let waterIntake = 0;
        const waterIntakeDisplay = document.getElementById('waterIntakeDisplay');
        const addWaterBtn = document.getElementById('addWaterBtn');
        const resetWaterBtn = document.getElementById('resetWaterBtn');

        addWaterBtn.addEventListener('click', () => {
            waterIntake += 250; // Add 250ml
            waterIntakeDisplay.value = `${waterIntake} ml`;
            document.getElementById('waterResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? '250 மிலி தண்ணீர் சேர்க்கப்பட்டது!' : '250ml water added!'}</p>`;
        });

        resetWaterBtn.addEventListener('click', () => {
            waterIntake = 0;
            waterIntakeDisplay.value = `${waterIntake} ml`;
            document.getElementById('waterResultOutput').innerHTML = `<p>${currentLanguage === 'ta' ? 'தண்ணீர் உட்கொள்ளல் மீட்டமைக்கப்பட்டது.' : 'Water intake reset.'}</p>`;
        });

        // Water Tracker AI Voice
        const waterTipAiVoiceBtn = document.getElementById('waterTipAiVoiceBtn');
        const waterTipTtsVoiceSelect = document.getElementById('waterTipTtsVoiceSelect');
        if ('speechSynthesis' in window) {
            waterTipAiVoiceBtn.style.display = 'inline-flex';
            waterTipTtsVoiceSelect.style.display = 'inline-block';
        }
        waterTipAiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = document.getElementById('waterTipOutput').textContent;
            if (textToSpeak && textToSpeak !== translations[currentLanguage].waterTipOutputPlaceholder) {
                speakText(textToSpeak, waterTipTtsVoiceSelect, waterTipAiVoiceBtn);
            }
        });

        // --- Journal (Existing Feature) ---
        const moodSelect = document.getElementById('moodSelect');
        const gratitudeInput = document.getElementById('gratitudeInput');
        const saveJournalEntryBtn = document.getElementById('saveJournalEntryBtn');
        const journalEntriesOutput = document.getElementById('journalEntriesOutput');
        const analyzeMoodJournalBtn = document.getElementById('analyzeMoodJournalBtn');

        let journalEntries = [];

        saveJournalEntryBtn.addEventListener('click', () => {
            const mood = moodSelect.value;
            const gratitude = gratitudeInput.value.trim();

            if (!mood && !gratitude) {
                journalEntriesOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'மனநிலை அல்லது நன்றியுணர்வு உள்ளீட்டைச் சேர்க்கவும்.' : 'Please add a mood or gratitude entry.'}</p>`;
                return;
            }

            const entry = {
                date: new Date().toLocaleString(),
                mood: mood,
                gratitude: gratitude
            };
            journalEntries.push(entry);
            displayJournalEntries();
            moodSelect.value = '';
            gratitudeInput.value = '';
            journalEntriesOutput.innerHTML = `<p>${currentLanguage === 'ta' ? 'பதிவு சேமிக்கப்பட்டது!' : 'Entry saved!'}</p>`;
        });

        function displayJournalEntries() {
            if (journalEntries.length === 0) {
                journalEntriesOutput.innerHTML = `<p>${currentLanguage === 'ta' ? 'இதுவரை எந்தப் பதிவுகளும் இல்லை.' : 'No entries yet.'}</p>`;
                return;
            }
            let html = `<h4>${currentLanguage === 'ta' ? 'உங்கள் பதிவுகள்:' : 'Your Entries:'}</h4><ul>`;
            journalEntries.forEach(entry => {
                html += `<li><strong>${entry.date}</strong> - `;
                if (entry.mood) {
                    html += `${currentLanguage === 'ta' ? 'மனநிலை: ' : 'Mood: '}${entry.mood} `;
                }
                if (entry.gratitude) {
                    html += `${currentLanguage === 'ta' ? 'நன்றியுணர்வு: ' : 'Gratitude: '}${entry.gratitude}`;
                }
                html += `</li>`;
            });
            html += `</ul>`;
            journalEntriesOutput.innerHTML = html;
        }

        // Mood Analysis AI Voice
        const moodAnalysisAiVoiceBtn = document.getElementById('moodAnalysisAiVoiceBtn');
        const moodAnalysisTtsVoiceSelect = document.getElementById('moodAnalysisTtsVoiceSelect');
        if ('speechSynthesis' in window) {
            moodAnalysisAiVoiceBtn.style.display = 'inline-flex';
            moodAnalysisTtsVoiceSelect.style.display = 'inline-block';
        }
        moodAnalysisAiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = document.getElementById('journalEntriesOutput').textContent;
            if (textToSpeak && textToSpeak !== translations[currentLanguage].journalEntriesOutputPlaceholder) {
                speakText(textToSpeak, moodAnalysisTtsVoiceSelect, moodAnalysisAiVoiceBtn);
            }
        });

        // --- Mood Analysis (Existing Feature - now integrated with Journal) ---
        const moodAnalysisInput = document.getElementById('moodAnalysisInput');
        const analyzeMoodBtn = document.getElementById('analyzeMoodBtn');
        const moodAnalysisOutput = document.getElementById('moodAnalysisOutput');

        analyzeMoodBtn.addEventListener('click', async () => {
            const journalText = journalEntries.map(entry => `Date: ${entry.date}, Mood: ${entry.mood || 'N/A'}, Gratitude: ${entry.gratitude || 'N/A'}`).join('\n');
            const analysisInput = moodAnalysisInput.value.trim();

            let prompt;
            if (analysisInput) {
                prompt = `Analyze the following mood/gratitude journal entries and the user's specific input: "${analysisInput}". Provide insights into their emotional patterns, suggest ways to improve mood based on gratitude, and offer general well-being advice. Ensure the response is in ${currentLanguage === 'ta' ? 'தமிழ்' : 'English'}. Journal entries: \n${journalText}`;
            } else if (journalText) {
                prompt = `Analyze the following mood/gratitude journal entries. Provide insights into their emotional patterns, suggest ways to improve mood based on gratitude, and offer general well-being advice. Ensure the response is in ${currentLanguage === 'ta' ? 'தமிழ்' : 'English'}. Journal entries: \n${journalText}`;
            } else {
                moodAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'பகுப்பாய்வு செய்ய ஜர்னல் உள்ளீடுகள் அல்லது உரை இல்லை.' : 'No journal entries or text to analyze.'}</p>`;
                return;
            }

            loadingDiv.style.display = 'flex'; // Use main loading indicator
            moodAnalysisOutput.innerHTML = '';
            moodAnalysisResultAiVoiceBtn.style.display = 'none';

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = { contents: chatHistory };
                // IMPORTANT: Replace "YOUR_GEMINI_API_KEY" with your actual Gemini API Key.
                // You can obtain one from Google AI Studio: https://aistudio.google.com/
                const apiKey = ""; // <--- INSERT YOUR GEMINI API KEY HERE
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    moodAnalysisOutput.innerHTML = `<p>${text}</p>`;
                    if ('speechSynthesis' in window) {
                        moodAnalysisResultAiVoiceBtn.style.display = 'inline-flex';
                    }
                } else {
                    moodAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'மனநிலையை பகுப்பாய்வு செய்ய முடியவில்லை. எதிர்பாராத API பதில் அமைப்பு.' : 'Failed to analyze mood. Unexpected API response structure.'}</p>`;
                    console.error('Unexpected API response structure:', result);
                }
            } catch (error) {
                console.error('Error analyzing mood:', error);
                moodAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'மனநிலையை பகுப்பாய்வு செய்யும்போது பிழை ஏற்பட்டது: ' : 'An error occurred while analyzing mood: '}${error.message || 'உங்கள் இணைய இணைப்பைச் சரிபார்த்து மீண்டும் முயற்சிக்கவும்.'}</p>`;
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        // Mood Analysis Result AI Voice
        const moodAnalysisResultAiVoiceBtn = document.getElementById('moodAnalysisResultAiVoiceBtn');
        const moodAnalysisResultTtsVoiceSelect = document.getElementById('moodAnalysisResultTtsVoiceSelect');
        if ('speechSynthesis' in window) {
            moodAnalysisResultAiVoiceBtn.style.display = 'inline-flex';
            moodAnalysisResultTtsVoiceSelect.style.display = 'inline-block';
        }
        moodAnalysisResultAiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = document.getElementById('moodAnalysisOutput').textContent;
            if (textToSpeak && textToSpeak !== translations[currentLanguage].moodAnalysisOutputPlaceholder) {
                speakText(textToSpeak, moodAnalysisResultTtsVoiceSelect, moodAnalysisResultAiVoiceBtn);
            }
        });

        // --- Local Health Tips (MODIFIED FEATURE) ---
        const localTipCategoryInput = document.getElementById('localTipCategory'); // Renamed from localTipsQueryInput
        const localTipMicBtn = document.getElementById('localTipMicBtn'); // New mic button for this section
        const getLocalTipsBtn = document.getElementById('getLocalTipsBtn');
        const localTipsOutput = document.getElementById('localTipsOutput');

        let isLocalTipRecording = false;

        if ('webkitSpeechRecognition' in window) {
            const localTipRecognition = new webkitSpeechRecognition();
            localTipRecognition.continuous = false;
            localTipRecognition.interimResults = false;
            localTipRecognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';

            localTipRecognition.onstart = () => {
                isLocalTipRecording = true;
                localTipMicBtn.classList.add('recording');
                localTipCategoryInput.placeholder = currentLanguage === 'ta' ? 'பேசவும்...' : 'Speaking...';
            };

            localTipRecognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                localTipCategoryInput.value = transcript;
                isLocalTipRecording = false;
                localTipMicBtn.classList.remove('recording');
                updateContent(); // Reset placeholder
            };

            localTipRecognition.onerror = (event) => {
                console.error('Speech recognition error for local tips:', event.error);
                isLocalTipRecording = false;
                localTipMicBtn.classList.remove('recording');
                localTipCategoryInput.placeholder = currentLanguage === 'ta' ? 'பேசத் தவறிவிட்டது. மீண்டும் முயற்சிக்கவும்.' : 'Speech failed. Try again.';
                updateContent(); // Reset placeholder
            };

            localTipRecognition.onend = () => {
                isLocalTipRecording = false;
                localTipMicBtn.classList.remove('recording');
                updateContent(); // Reset placeholder
            };

            localTipMicBtn.addEventListener('click', () => {
                if (isLocalTipRecording) {
                    localTipRecognition.stop();
                } else {
                    localTipRecognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';
                    localTipRecognition.start();
                }
            });
        } else {
            localTipMicBtn.style.display = 'none';
            console.warn('Web Speech API (webkitSpeechRecognition) not supported for local tips in this browser.');
        }

        getLocalTipsBtn.addEventListener('click', async () => {
            const category = localTipCategoryInput.value.trim();

            if (!category) {
                localTipsOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'நீங்கள் எந்த வகையான பாரம்பரிய உணவு அல்லது காய்கறி குறிப்புகளை விரும்புகிறீர்கள் என்பதை உள்ளிடவும்!' : 'Please enter what kind of traditional food or vegetable tips you would like!'}</p>`;
                return;
            }

            loadingDiv.style.display = 'flex';
            localTipsOutput.innerHTML = '';
            localTipsAiVoiceBtn.style.display = 'none';

            try {
                // Updated prompt for traditional food and vegetable tips based on category
                const prompt = `Provide traditional food and vegetable tips for the category: "${category}". Be specific and provide actionable advice. Ensure the response is in ${currentLanguage === 'ta' ? 'தமிழ்' : 'English'}.`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = { contents: chatHistory };
                // IMPORTANT: Replace "YOUR_GEMINI_API_KEY" with your actual Gemini API Key.
                // You can obtain one from Google AI Studio: https://aistudio.google.com/
                const apiKey = ""; // <--- INSERT YOUR GEMINI API KEY HERE
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    localTipsOutput.innerHTML = `<p>${text}</p>`;
                    if ('speechSynthesis' in window) {
                        localTipsAiVoiceBtn.style.display = 'inline-flex';
                    }
                } else {
                    localTipsOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'குறிப்புகளைப் பெற முடியவில்லை. எதிர்பாராத API பதில் அமைப்பு.' : 'Failed to get tips. Unexpected API response structure.'}</p>`;
                    console.error('Unexpected API response structure:', result);
                }
            } catch (error) {
                console.error('Error getting tips:', error);
                localTipsOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'குறிப்புகளைப் பெறும்போது பிழை ஏற்பட்டது: ' : 'An error occurred while getting tips: '}${error.message || 'உங்கள் இணைய இணைப்பைச் சரிபார்த்து மீண்டும் முயற்சிக்கவும்.'}</p>`;
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        // Local Tips AI Voice
        const localTipsAiVoiceBtn = document.getElementById('localTipsAiVoiceBtn');
        const localTipsTtsVoiceSelect = document.getElementById('localTipsTtsVoiceSelect');
        if ('speechSynthesis' in window) {
            localTipsAiVoiceBtn.style.display = 'inline-flex';
            localTipsTtsVoiceSelect.style.display = 'inline-block';
        }
        localTipsAiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = document.getElementById('localTipsOutput').textContent;
            if (textToSpeak && textToSpeak !== translations[currentLanguage].localTipsOutputPlaceholder) {
                speakText(textToSpeak, localTipsTtsVoiceSelect, localTipsAiVoiceBtn);
            }
        });

        // --- Personalized Diet Plan (NEW FEATURE) ---
        const dietaryPreferencesInput = document.getElementById('dietaryPreferences');
        const allergiesInput = document.getElementById('allergies');
        const healthGoalsInput = document.getElementById('healthGoals');
        const generateDietPlanBtn = document.getElementById('generateDietPlanBtn');
        const dietPlanOutput = document.getElementById('dietPlanOutput');

        generateDietPlanBtn.addEventListener('click', async () => {
            const preferences = dietaryPreferencesInput.value.trim();
            const allergies = allergiesInput.value.trim();
            const goals = healthGoalsInput.value.trim();

            if (!preferences && !allergies && !goals) {
                dietPlanOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உணவு விருப்பத்தேர்வுகள், ஒவ்வாமைகள் அல்லது ஆரோக்கிய இலக்குகளை உள்ளிடவும்!' : 'Please enter dietary preferences, allergies, or health goals!'}</p>`;
                return;
            }

            loadingDiv.style.display = 'flex';
            dietPlanOutput.innerHTML = '';
            dietPlanAiVoiceBtn.style.display = 'none';

            try {
                const prompt = `Generate a personalized 3-day diet plan based on the following:
                Dietary Preferences: ${preferences || 'Not specified'}
                Allergies: ${allergies || 'None'}
                Health Goals: ${goals || 'General health'}
                
                Provide the response in JSON format with the following structure:
                {
                    "planName": "string",
                    "days": [
                        {
                            "day": "string (e.g., Day 1)",
                            "meals": [
                                {
                                    "mealName": "string (e.g., Breakfast, Lunch, Dinner, Snack)",
                                    "dishes": ["string (e.g., Oatmeal with berries, Grilled chicken salad)"]
                                }
                            ]
                        }
                    ]
                }
                Focus on healthy, balanced meals. Include a disclaimer to consult a nutritionist or healthcare professional before making significant dietary changes. Ensure the content of the strings is in ${currentLanguage === 'ta' ? 'தமிழ்' : 'English'}.`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "planName": { "type": "STRING" },
                                "days": {
                                    "type": "ARRAY",
                                    "items": {
                                        "type": "OBJECT",
                                        "properties": {
                                            "day": { "type": "STRING" },
                                            "meals": {
                                                "type": "ARRAY",
                                                "items": {
                                                    "type": "OBJECT",
                                                    "properties": {
                                                        "mealName": { "type": "STRING" },
                                                        "dishes": { "type": "ARRAY", "items": { "type": "STRING" } }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                };

                // IMPORTANT: Replace "YOUR_GEMINI_API_KEY" with your actual Gemini API Key.
                // You can obtain one from Google AI Studio: https://aistudio.google.com/
                const apiKey = ""; // <--- INSERT YOUR GEMINI API KEY HERE
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {

                    const jsonText = result.candidates[0].content.parts[0].text;
                    const dietPlan = JSON.parse(jsonText);

                    let html = `<h3>${dietPlan.planName}</h3>`;
                    dietPlan.days.forEach(dayEntry => {
                        html += `<h4>${dayEntry.day}:</h4><ul>`;
                        dayEntry.meals.forEach(meal => {
                            html += `<li><strong>${meal.mealName}:</strong> ${meal.dishes.join(', ')}</li>`;
                        });
                        html += `</ul>`;
                    });
                    html += `<p class="text-sm text-gray-500 mt-4">${currentLanguage === 'ta' ? 'குறிப்பு: எந்தவொரு குறிப்பிடத்தக்க உணவு மாற்றங்களையும் செய்வதற்கு முன் ஊட்டச்சத்து நிபுணர் அல்லது சுகாதார நிபுணரை அணுகவும்.' : 'Disclaimer: Consult a nutritionist or healthcare professional before making significant dietary changes.'}</p>`;
                    dietPlanOutput.innerHTML = html;

                    if ('speechSynthesis' in window) {
                        dietPlanAiVoiceBtn.style.display = 'inline-flex';
                    }
                } else {
                    dietPlanOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உணவுத் திட்டத்தை உருவாக்க முடியவில்லை. எதிர்பாராத API பதில் அமைப்பு.' : 'Failed to generate diet plan. Unexpected API response structure.'}</p>`;
                    console.error('Unexpected API response structure:', result);
                }
            } catch (error) {
                console.error('Error generating diet plan:', error);
                dietPlanOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உணவுத் திட்டத்தை உருவாக்கும்போது பிழை ஏற்பட்டது: ' : 'An error occurred while generating the diet plan: '}${error.message || 'உங்கள் இணைய இணைப்பைச் சரிபார்த்து மீண்டும் முயற்சிக்கவும்.'}</p>`;
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        // Diet Plan AI Voice
        const dietPlanAiVoiceBtn = document.getElementById('dietPlanAiVoiceBtn');
        const dietPlanTtsVoiceSelect = document.getElementById('dietPlanTtsVoiceSelect');
        if ('speechSynthesis' in window) {
            dietPlanAiVoiceBtn.style.display = 'inline-flex';
            dietPlanTtsVoiceSelect.style.display = 'inline-block';
        }
        dietPlanAiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = document.getElementById('dietPlanOutput').textContent;
            if (textToSpeak) { // No specific placeholder to check against
                speakText(textToSpeak, dietPlanTtsVoiceSelect, dietPlanAiVoiceBtn);
            }
        });

        // --- Exercise Routine Generator (NEW FEATURE) ---
        const fitnessLevelInput = document.getElementById('fitnessLevel');
        const equipmentAvailableInput = document.getElementById('equipmentAvailable');
        const timeAvailableInput = document.getElementById('timeAvailable');
        const generateExerciseRoutineBtn = document.getElementById('generateExerciseRoutineBtn');
        const exerciseRoutineOutput = document.getElementById('exerciseRoutineOutput');

        generateExerciseRoutineBtn.addEventListener('click', async () => {
            const fitnessLevel = fitnessLevelInput.value.trim();
            const equipment = equipmentAvailableInput.value.trim();
            const time = timeAvailableInput.value.trim();

            if (!fitnessLevel && !equipment && !time) {
                exerciseRoutineOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உடற்பயிற்சி நிலை, உபகரணங்கள் அல்லது நேரத்தை உள்ளிடவும்!' : 'Please enter fitness level, equipment, or time!'}</p>`;
                return;
            }

            loadingDiv.style.display = 'flex';
            exerciseRoutineOutput.innerHTML = '';
            exerciseRoutineAiVoiceBtn.style.display = 'none';

            try {
                const prompt = `Generate a personalized 3-day exercise routine based on the following:
                Fitness Level: ${fitnessLevel || 'Beginner'}
                Available Equipment: ${equipment || 'None'}
                Time Available: ${time || '30 minutes'}
                
                Provide the response in JSON format with the following structure:
                {
                    "routineName": "string",
                    "days": [
                        {
                            "day": "string (e.g., Day 1)",
                            "exercises": [
                                {
                                    "name": "string (e.g., Push-ups)",
                                    "sets": "string (e.g., 3 sets)",
                                    "reps": "string (e.g., 10-12 reps)",
                                    "instructions": "string (e.g., Keep your body straight...)"
                                }
                            ]
                        }
                    ]
                }
                Focus on a balanced workout. Include a disclaimer to consult a fitness professional before starting any new exercise routine. Ensure the content of the strings is in ${currentLanguage === 'ta' ? 'தமிழ்' : 'English'}.`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "routineName": { "type": "STRING" },
                                "days": {
                                    "type": "ARRAY",
                                    "items": {
                                        "type": "OBJECT",
                                        "properties": {
                                            "day": { "type": "STRING" },
                                            "exercises": {
                                                "type": "ARRAY",
                                                "items": {
                                                    "type": "OBJECT",
                                                    "properties": {
                                                        "name": { "type": "STRING" },
                                                        "sets": { "type": "STRING" },
                                                        "reps": { "type": "STRING" },
                                                        "instructions": { "type": "STRING" }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                };

                // IMPORTANT: Replace "YOUR_GEMINI_API_KEY" with your actual Gemini API Key.
                // You can obtain one from Google AI Studio: https://aistudio.google.com/
                const apiKey = ""; // <--- INSERT YOUR GEMINI API KEY HERE
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {

                    const jsonText = result.candidates[0].content.parts[0].text;
                    const exerciseRoutine = JSON.parse(jsonText);

                    let html = `<h3>${exerciseRoutine.routineName}</h3>`;
                    exerciseRoutine.days.forEach(dayEntry => {
                        html += `<h4>${dayEntry.day}:</h4><ul>`;
                        dayEntry.exercises.forEach(exercise => {
                            html += `<li><strong>${exercise.name}</strong>: ${exercise.sets}, ${exercise.reps}<br><em>${exercise.instructions}</em></li>`;
                        });
                        html += `</ul>`;
                    });
                    html += `<p class="text-sm text-gray-500 mt-4">${currentLanguage === 'ta' ? 'குறிப்பு: எந்தவொரு புதிய உடற்பயிற்சி வழக்கத்தையும் தொடங்குவதற்கு முன் உடற்பயிற்சி நிபுணரை அணுகவும்.' : 'Disclaimer: Consult a fitness professional before starting any new exercise routine.'}</p>`;
                    exerciseRoutineOutput.innerHTML = html;

                    if ('speechSynthesis' in window) {
                        exerciseRoutineAiVoiceBtn.style.display = 'inline-flex';
                    }
                } else {
                    exerciseRoutineOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உடற்பயிற்சி வழக்கத்தை உருவாக்க முடியவில்லை. எதிர்பாராத API பதில் அமைப்பு.' : 'Failed to generate exercise routine. Unexpected API response structure.'}</p>`;
                    console.error('Unexpected API response structure:', result);
                }
            } catch (error) {
                console.error('Error generating exercise routine:', error);
                exerciseRoutineOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உடற்பயிற்சி வழக்கத்தை உருவாக்கும்போது பிழை ஏற்பட்டது: ' : 'An error occurred while generating the exercise routine: '}${error.message || 'உங்கள் இணைய இணைப்பைச் சரிபார்த்து மீண்டும் முயற்சிக்கவும்.'}</p>`;
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        // Exercise Routine AI Voice
        const exerciseRoutineAiVoiceBtn = document.getElementById('exerciseRoutineAiVoiceBtn');
        const exerciseRoutineTtsVoiceSelect = document.getElementById('exerciseRoutineTtsVoiceSelect');
        if ('speechSynthesis' in window) {
            exerciseRoutineAiVoiceBtn.style.display = 'inline-flex';
            exerciseRoutineTtsVoiceSelect.style.display = 'inline-block';
        }
        exerciseRoutineAiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = document.getElementById('exerciseRoutineOutput').textContent;
            if (textToSpeak) { // No specific placeholder to check against
                speakText(textToSpeak, exerciseRoutineTtsVoiceSelect, exerciseRoutineAiVoiceBtn);
            }
        });

        // --- Symptom Checker (NEW FEATURE) ---
        const symptomsInput = document.getElementById('symptomsInput');
        const checkSymptomsBtn = document.getElementById('checkSymptomsBtn');
        const symptomCheckerOutput = document.getElementById('symptomCheckerOutput');

        checkSymptomsBtn.addEventListener('click', async () => {
            const symptoms = symptomsInput.value.trim();

            if (!symptoms) {
                symptomCheckerOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உங்கள் அறிகுறிகளை உள்ளிடவும்!' : 'Please enter your symptoms!'}</p>`;
                return;
            }

            loadingDiv.style.display = 'flex';
            symptomCheckerOutput.innerHTML = '';
            symptomCheckerAiVoiceBtn.style.display = 'none';

            try {
                const prompt = `I am experiencing the following symptoms: "${symptoms}". What could be the possible conditions and what general advice can you give? Provide a concise, easy-to-understand response. Always include a disclaimer at the end to consult a healthcare professional for diagnosis and treatment. Ensure the response is in ${currentLanguage === 'ta' ? 'தமிழ்' : 'English'}.`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = { contents: chatHistory };
                // IMPORTANT: Replace "YOUR_GEMINI_API_KEY" with your actual Gemini API Key.
                // You can obtain one from Google AI Studio: https://aistudio.google.com/
                const apiKey = ""; // <--- INSERT YOUR GEMINI API KEY HERE
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    symptomCheckerOutput.innerHTML = `<p>${text}</p>`;
                    if ('speechSynthesis' in window) {
                        symptomCheckerAiVoiceBtn.style.display = 'inline-flex';
                    }
                } else {
                    symptomCheckerOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'அறிகுறிகளை சரிபார்க்க முடியவில்லை. எதிர்பாராத API பதில் அமைப்பு.' : 'Failed to check symptoms. Unexpected API response structure.'}</p>`;
                    console.error('Unexpected API response structure:', result);
                }
            } catch (error) {
                console.error('Error checking symptoms:', error);
                symptomCheckerOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'அறிகுறிகளை சரிபார்க்கும்போது பிழை ஏற்பட்டது: ' : 'An error occurred while checking symptoms: '}${error.message || 'உங்கள் இணைய இணைப்பைச் சரிபார்த்து மீண்டும் முயற்சிக்கவும்.'}</p>`;
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        // Symptom Checker AI Voice
        const symptomCheckerAiVoiceBtn = document.getElementById('symptomCheckerAiVoiceBtn');
        const symptomCheckerTtsVoiceSelect = document.getElementById('symptomCheckerTtsVoiceSelect');
        if ('speechSynthesis' in window) {
            symptomCheckerAiVoiceBtn.style.display = 'inline-flex';
            symptomCheckerTtsVoiceSelect.style.display = 'inline-block';
        }
        symptomCheckerAiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = document.getElementById('symptomCheckerOutput').textContent;
            if (textToSpeak) { // No specific placeholder to check against
                speakText(textToSpeak, symptomCheckerTtsVoiceSelect, symptomCheckerAiVoiceBtn);
            }
        });


        // --- Disease Prevention (Existing Feature) ---
        const diseasePreventionQueryInput = document.getElementById('diseasePreventionQuery');
        const getPreventionTipsBtn = document.getElementById('getPreventionTipsBtn');
        const diseasePreventionOutput = document.getElementById('diseasePreventionOutput');

        getPreventionTipsBtn.addEventListener('click', async () => {
            const query = diseasePreventionQueryInput.value.trim();

            if (!query) {
                diseasePreventionOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'நோயின் பெயரை உள்ளிடவும்!' : 'Please enter the name of a disease!'}</p>`;
                return;
            }

            loadingDiv.style.display = 'flex';
            diseasePreventionOutput.innerHTML = '';
            diseasePreventionAiVoiceBtn.style.display = 'none';

            try {
                const prompt = `Provide detailed prevention tips for "${query}". Include lifestyle changes, dietary recommendations, and any other relevant advice. Ensure the response is in ${currentLanguage === 'ta' ? 'தமிழ்' : 'English'}.`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = { contents: chatHistory };
                // IMPORTANT: Replace "YOUR_GEMINI_API_KEY" with your actual Gemini API Key.
                // You can obtain one from Google AI Studio: https://aistudio.google.com/
                const apiKey = ""; // <--- INSERT YOUR GEMINI API KEY HERE
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    diseasePreventionOutput.innerHTML = `<p>${text}</p>`;
                    if ('speechSynthesis' in window) {
                        diseasePreventionAiVoiceBtn.style.display = 'inline-flex';
                    }
                } else {
                    diseasePreventionOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'தடுப்பு குறிப்புகளைப் பெற முடியவில்லை. எதிர்பாராத API பதில் அமைப்பு.' : 'Failed to get prevention tips. Unexpected API response structure.'}</p>`;
                    console.error('Unexpected API response structure:', result);
                }
            } catch (error) {
                console.error('Error getting prevention tips:', error);
                diseasePreventionOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'தடுப்பு குறிப்புகளைப் பெறும்போது பிழை ஏற்பட்டது: ' : 'An error occurred while getting prevention tips: '}${error.message || 'உங்கள் இணைய இணைப்பைச் சரிபார்த்து மீண்டும் முயற்சிக்கவும்.'}</p>`;
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        // Disease Prevention AI Voice
        const diseasePreventionAiVoiceBtn = document.getElementById('diseasePreventionAiVoiceBtn');
        const diseasePreventionTtsVoiceSelect = document.getElementById('diseasePreventionTtsVoiceSelect');
        if ('speechSynthesis' in window) {
            diseasePreventionAiVoiceBtn.style.display = 'inline-flex';
            diseasePreventionTtsVoiceSelect.style.display = 'inline-block';
        }
        diseasePreventionAiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = document.getElementById('diseasePreventionOutput').textContent;
            if (textToSpeak) {
                speakText(textToSpeak, diseasePreventionTtsVoiceSelect, diseasePreventionAiVoiceBtn);
            }
        });

        // --- Wellness Challenge (Existing Feature) ---
        const challengeTypeInput = document.getElementById('challengeType');
        const generateChallengeBtn = document.getElementById('generateChallengeBtn');
        const wellnessChallengeOutput = document.getElementById('wellnessChallengeOutput');

        generateChallengeBtn.addEventListener('click', async () => {
            const challengeType = challengeTypeInput.value.trim();

            if (!challengeType) {
                wellnessChallengeOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'சவால் வகையை உள்ளிடவும்!' : 'Please enter a challenge type!'}</p>`;
                return;
            }

            loadingDiv.style.display = 'flex';
            wellnessChallengeOutput.innerHTML = '';
            wellnessChallengeAiVoiceBtn.style.display = 'none';

            try {
                const prompt = `Generate a simple and actionable wellness challenge for "${challengeType}". Provide clear steps and a suggested duration (e.g., 7-day, 30-day). Ensure the response is in ${currentLanguage === 'ta' ? 'தமிழ்' : 'English'}.`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = { contents: chatHistory };
                // IMPORTANT: Replace "YOUR_GEMINI_API_KEY" with your actual Gemini API Key.
                // You can obtain one from Google AI Studio: https://aistudio.google.com/
                const apiKey = ""; // <--- INSERT YOUR GEMINI API KEY HERE
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    wellnessChallengeOutput.innerHTML = `<p>${text}</p>`;
                    if ('speechSynthesis' in window) {
                        wellnessChallengeAiVoiceBtn.style.display = 'inline-flex';
                    }
                } else {
                    wellnessChallengeOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'சவாலை உருவாக்க முடியவில்லை. எதிர்பாராத API பதில் அமைப்பு.' : 'Failed to generate challenge. Unexpected API response structure.'}</p>`;
                    console.error('Unexpected API response structure:', result);
                }
            } catch (error) {
                console.error('Error generating challenge:', error);
                wellnessChallengeOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'சவாலை உருவாக்கும்போது பிழை ஏற்பட்டது: ' : 'An error occurred while generating the challenge: '}${error.message || 'உங்கள் இணைய இணைப்பைச் சரிபார்த்து மீண்டும் முயற்சிக்கவும்.'}</p>`;
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        // Wellness Challenge AI Voice
        const wellnessChallengeAiVoiceBtn = document.getElementById('wellnessChallengeAiVoiceBtn');
        const wellnessChallengeTtsVoiceSelect = document.getElementById('wellnessChallengeTtsVoiceSelect');
        if ('speechSynthesis' in window) {
            wellnessChallengeAiVoiceBtn.style.display = 'inline-flex';
            wellnessChallengeTtsVoiceSelect.style.display = 'inline-block';
        }
        wellnessChallengeAiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = document.getElementById('wellnessChallengeOutput').textContent;
            if (textToSpeak) {
                speakText(textToSpeak, wellnessChallengeTtsVoiceSelect, wellnessChallengeAiVoiceBtn);
            }
        });

        // --- Medication Reminder (Existing Feature) ---
        const medicationNameInput = document.getElementById('medicationName');
        const medicationTimeInput = document.getElementById('medicationTime');
        const setReminderBtn = document.getElementById('setReminderBtn');
        const upcomingRemindersOutput = document.getElementById('upcomingRemindersOutput');

        let reminders = [];
        let reminderIntervals = {}; // Store intervals by reminder ID

        function showAlarmModal(medication) {
            const alarmModal = document.getElementById('alarmModal');
            const alarmModalTitle = document.getElementById('alarmModalTitle');
            const alarmModalMessage = document.getElementById('alarmModalMessage');
            const alarmModalCloseBtn = document.getElementById('alarmModalCloseBtn');

            alarmModalTitle.textContent = translations[currentLanguage].alarmModalTitle;
            alarmModalMessage.textContent = `${translations[currentLanguage].alarmModalMessage} (${medication})`;
            alarmModal.classList.add('show');
            alarmSynth.triggerAttackRelease("C4", "8n"); // Play a simple tone

            alarmModalCloseBtn.onclick = () => {
                alarmModal.classList.remove('show');
                alarmSynth.releaseAll(); // Stop sound
            };
        }

        setReminderBtn.addEventListener('click', () => {
            const name = medicationNameInput.value.trim();
            const time = medicationTimeInput.value; // HH:MM format

            if (!name || !time) {
                upcomingRemindersOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'மருந்தின் பெயர் மற்றும் நேரத்தை உள்ளிடவும்!' : 'Please enter medication name and time!'}</p>`;
                return;
            }

            const now = new Date();
            const [hours, minutes] = time.split(':').map(Number);
            let reminderTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, 0);

            // If the reminder time is in the past for today, set it for tomorrow
            if (reminderTime < now) {
                reminderTime.setDate(reminderTime.getDate() + 1);
            }

            const reminderId = Date.now(); // Unique ID for the reminder
            const newReminder = {
                id: reminderId,
                name: name,
                time: reminderTime
            };
            reminders.push(newReminder);
            reminders.sort((a, b) => a.time - b.time); // Sort by time

            // Clear existing interval if any for this ID (though new ID means no existing)
            if (reminderIntervals[reminderId]) {
                clearInterval(reminderIntervals[reminderId]);
            }

            // Set a new interval to check every minute if it's time for the reminder
            reminderIntervals[reminderId] = setInterval(() => {
                const currentTime = new Date();
                if (currentTime.getHours() === newReminder.time.getHours() &&
                    currentTime.getMinutes() === newReminder.time.getMinutes()) {
                    showAlarmModal(newReminder.name);
                    // For a daily reminder, reschedule for the next day
                    newReminder.time.setDate(newReminder.time.getDate() + 1);
                    displayReminders(); // Update display to show next day's time
                }
            }, 60 * 1000); // Check every minute

            displayReminders();
            medicationNameInput.value = '';
            medicationTimeInput.value = '';
            upcomingRemindersOutput.innerHTML = `<p>${currentLanguage === 'ta' ? 'நினைவூட்டல் அமைக்கப்பட்டது!' : 'Reminder set!'}</p>`;
        });

        function displayReminders() {
            if (reminders.length === 0) {
                upcomingRemindersOutput.innerHTML = `<p>${currentLanguage === 'ta' ? 'வரவிருக்கும் நினைவூட்டல்கள் இல்லை.' : 'No upcoming reminders.'}</p>`;
                return;
            }
            let html = `<h4>${currentLanguage === 'ta' ? 'வரவிருக்கும் நினைவூட்டல்கள்:' : 'Upcoming Reminders:'}</h4><ul>`;
            reminders.forEach(reminder => {
                const timeString = reminder.time.toLocaleTimeString(currentLanguage === 'ta' ? 'ta-IN' : 'en-US', { hour: '2-digit', minute: '2-digit' });
                const dateString = reminder.time.toLocaleDateString(currentLanguage === 'ta' ? 'ta-IN' : 'en-US', { month: 'short', day: 'numeric' });
                html += `<li><strong>${reminder.name}</strong> - ${timeString} (${dateString}) <button data-id="${reminder.id}" class="text-red-500 hover:text-red-700 ml-2 text-sm">${currentLanguage === 'ta' ? 'நீக்கு' : 'Delete'}</button></li>`;
            });
            html += `</ul>`;
            upcomingRemindersOutput.innerHTML = html;

            // Add event listeners to delete buttons
            upcomingRemindersOutput.querySelectorAll('button').forEach(button => {
                button.addEventListener('click', (event) => {
                    const idToDelete = parseInt(event.target.dataset.id);
                    reminders = reminders.filter(r => r.id !== idToDelete);
                    clearInterval(reminderIntervals[idToDelete]); // Clear the interval
                    delete reminderIntervals[idToDelete];
                    displayReminders();
                    upcomingRemindersOutput.innerHTML = `<p>${currentLanguage === 'ta' ? 'நினைவூட்டல் நீக்கப்பட்டது!' : 'Reminder deleted!'}</p>`;
                });
            });
        }

        // --- Body Pain Mapping (Existing Feature) ---
        const bodyMapImage = document.getElementById('bodyMapImage');
        const bodyMapContainer = document.querySelector('.body-map-container');
        const painDescriptionInput = document.getElementById('painDescription');
        const savePainEntryBtn = document.getElementById('savePainEntryBtn');
        const painEntriesOutput = document.getElementById('painEntriesOutput');
        const analyzePainBtn = document.getElementById('analyzePainBtn');
        const painAnalysisOutput = document.getElementById('painAnalysisOutput');

        let painPoints = []; // Stores {x, y, description}

        bodyMapContainer.addEventListener('click', (event) => {
            const rect = bodyMapImage.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            const dot = document.createElement('div');
            dot.classList.add('pain-dot');
            dot.style.left = `${(x / rect.width) * 100}%`;
            dot.style.top = `${(y / rect.height) * 100}%`;

            // Store percentage coordinates for responsiveness
            const newPainPoint = {
                x: (x / rect.width),
                y: (y / rect.height),
                description: '', // Will be filled on save
                element: dot // Reference to the DOM element
            };
            painPoints.push(newPainPoint);
            bodyMapContainer.appendChild(dot);

            // Select the newly added dot
            painPoints.forEach(p => p.element.classList.remove('selected'));
            dot.classList.add('selected');

            // Clear description input for new entry
            painDescriptionInput.value = '';
        });

        savePainEntryBtn.addEventListener('click', () => {
            const selectedDot = painPoints.find(p => p.element.classList.contains('selected'));
            if (selectedDot) {
                selectedDot.description = painDescriptionInput.value.trim();
                displayPainEntries();
                painDescriptionInput.value = '';
                painEntriesOutput.innerHTML = `<p>${currentLanguage === 'ta' ? 'வலி பதிவு சேமிக்கப்பட்டது!' : 'Pain entry saved!'}</p>`;
            } else {
                painEntriesOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'சேமிக்க ஒரு வலி புள்ளியைத் தேர்ந்தெடுக்கவும் அல்லது சேர்க்கவும்.' : 'Please select or add a pain point to save.'}</p>`;
            }
        });

        function displayPainEntries() {
            if (painPoints.length === 0) {
                painEntriesOutput.innerHTML = `<p>${currentLanguage === 'ta' ? 'இதுவரை எந்த வலி பதிவுகளும் இல்லை.' : 'No pain entries yet.'}</p>`;
                return;
            }
            let html = `<h4>${currentLanguage === 'ta' ? 'உங்கள் வலி பதிவுகள்:' : 'Your Pain Entries:'}</h4><ul>`;
            painPoints.forEach((point, index) => {
                html += `<li><strong>புள்ளி ${index + 1}</strong> (${(point.x * 100).toFixed(1)}%, ${(point.y * 100).toFixed(1)}%): ${point.description || (currentLanguage === 'ta' ? 'விளக்கம் இல்லை' : 'No description')} <button data-index="${index}" class="text-red-500 hover:text-red-700 ml-2 text-sm">${currentLanguage === 'ta' ? 'நீக்கு' : 'Delete'}</button></li>`;
            });
            html += `</ul>`;
            painEntriesOutput.innerHTML = html;

            painEntriesOutput.querySelectorAll('button').forEach(button => {
                button.addEventListener('click', (event) => {
                    const indexToDelete = parseInt(event.target.dataset.index);
                    if (painPoints[indexToDelete] && painPoints[indexToDelete].element) {
                        painPoints[indexToDelete].element.remove(); // Remove the dot from DOM
                    }
                    painPoints.splice(indexToDelete, 1); // Remove from array
                    displayPainEntries(); // Re-render the list
                    painEntriesOutput.innerHTML = `<p>${currentLanguage === 'ta' ? 'வலி பதிவு நீக்கப்பட்டது!' : 'Pain entry deleted!'}</p>`;
                });
            });
        }

        analyzePainBtn.addEventListener('click', async () => {
            if (painPoints.length === 0) {
                painAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'பகுப்பாய்வு செய்ய வலி பதிவுகள் இல்லை.' : 'No pain entries to analyze.'}</p>`;
                return;
            }

            const painData = painPoints.map((p, i) => `Point ${i + 1} at X:${p.x.toFixed(2)}, Y:${p.y.toFixed(2)} with description: "${p.description || 'No description'}"`).join('\n');

            loadingDiv.style.display = 'flex';
            painAnalysisOutput.innerHTML = '';
            painAnalysisAiVoiceBtn.style.display = 'none';

            try {
                const prompt = `Analyze the following pain points on a human body map. Provide possible reasons for the pain based on location and description, and suggest general remedies or next steps (e.g., rest, stretching, consult a doctor). Ensure the response is in ${currentLanguage === 'ta' ? 'தமிழ்' : 'English'}.
                Pain Points:
                ${painData}`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = { contents: chatHistory };
                // IMPORTANT: Replace "YOUR_GEMINI_API_KEY" with your actual Gemini API Key.
                // You can obtain one from Google AI Studio: https://aistudio.google.com/
                const apiKey = ""; // <--- INSERT YOUR GEMINI API KEY HERE
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    painAnalysisOutput.innerHTML = `<p>${text}</p>`;
                    if ('speechSynthesis' in window) {
                        painAnalysisAiVoiceBtn.style.display = 'inline-flex';
                    }
                } else {
                    painAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'வலியை பகுப்பாய்வு செய்ய முடியவில்லை. எதிர்பாராத API பதில் அமைப்பு.' : 'Failed to analyze pain. Unexpected API response structure.'}</p>`;
                    console.error('Unexpected API response structure:', result);
                }
            } catch (error) {
                console.error('Error analyzing pain:', error);
                painAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'வலியை பகுப்பாய்வு செய்யும்போது பிழை ஏற்பட்டது: ' : 'An error occurred while analyzing pain: '}${error.message || 'உங்கள் இணைய இணைப்பைச் சரிபார்த்து மீண்டும் முயற்சிக்கவும்.'}</p>`;
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        // Pain Analysis AI Voice
        const painAnalysisAiVoiceBtn = document.getElementById('painAnalysisAiVoiceBtn');
        const painAnalysisTtsVoiceSelect = document.getElementById('painAnalysisTtsVoiceSelect');
        if ('speechSynthesis' in window) {
            painAnalysisAiVoiceBtn.style.display = 'inline-flex';
            painAnalysisTtsVoiceSelect.style.display = 'inline-block';
        }
        painAnalysisAiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = document.getElementById('painAnalysisOutput').textContent;
            if (textToSpeak) {
                speakText(textToSpeak, painAnalysisTtsVoiceSelect, painAnalysisAiVoiceBtn);
            }
        });

        // --- First Aid & Emergency (Existing Feature) ---
        const emergencyQueryInput = document.getElementById('emergencyQuery');
        const getEmergencyInfoBtn = document.getElementById('getEmergencyInfoBtn');
        const emergencyInfoOutput = document.getElementById('emergencyInfoOutput');

        getEmergencyInfoBtn.addEventListener('click', async () => {
            const query = emergencyQueryInput.value.trim();

            if (!query) {
                emergencyInfoOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'அவசர உதவி வினவலை உள்ளிடவும்!' : 'Please enter an emergency query!'}</p>`;
                return;
            }

            loadingDiv.style.display = 'flex';
            emergencyInfoOutput.innerHTML = '';
            emergencyInfoAiVoiceBtn.style.display = 'none';

            try {
                const prompt = `Provide concise and clear first aid or emergency information for "${query}". Focus on immediate steps. Always include a strong disclaimer to call emergency services (e.g., 108 in India, 911 in US) if it's a serious emergency. Ensure the response is in ${currentLanguage === 'ta' ? 'தமிழ்' : 'English'}.`;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = { contents: chatHistory };
                // IMPORTANT: Replace "YOUR_GEMINI_API_KEY" with your actual Gemini API Key.
                // You can obtain one from Google AI Studio: https://aistudio.google.com/
                const apiKey = ""; // <--- INSERT YOUR GEMINI API KEY HERE
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status} ${response.statusText} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    emergencyInfoOutput.innerHTML = `<p>${text}</p>`;
                    if ('speechSynthesis' in window) {
                        emergencyInfoAiVoiceBtn.style.display = 'inline-flex';
                    }
                } else {
                    emergencyInfoOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'அவசர உதவி தகவலைப் பெற முடியவில்லை. எதிர்பாராத API பதில் அமைப்பு.' : 'Failed to get emergency info. Unexpected API response structure.'}</p>`;
                    console.error('Unexpected API response structure:', result);
                }
            } catch (error) {
                console.error('Error getting emergency info:', error);
                emergencyInfoOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'அவசர உதவி தகவலைப் பெறும்போது பிழை ஏற்பட்டது: ' : 'An error occurred while getting emergency info: '}${error.message || 'உங்கள் இணைய இணைப்பைச் சரிபார்த்து மீண்டும் முயற்சிக்கவும்.'}</p>`;
            } finally {
                loadingDiv.style.display = 'none';
            }
        });

        // Emergency Info AI Voice
        const emergencyInfoAiVoiceBtn = document.getElementById('emergencyInfoAiVoiceBtn');
        const emergencyInfoTtsVoiceSelect = document.getElementById('emergencyInfoTtsVoiceSelect');
        if ('speechSynthesis' in window) {
            emergencyInfoAiVoiceBtn.style.display = 'inline-flex';
            emergencyInfoTtsVoiceSelect.style.display = 'inline-block';
        }
        emergencyInfoAiVoiceBtn.addEventListener('click', () => {
            const textToSpeak = document.getElementById('emergencyInfoOutput').textContent;
            if (textToSpeak) {
                speakText(textToSpeak, emergencyInfoTtsVoiceSelect, emergencyInfoAiVoiceBtn);
            }
        });


        // Initial setup on window load
        window.onload = function () {
            // Fade out splash screen
            const splashScreen = document.getElementById('splashScreen');
            const mainContent = document.getElementById('mainContent');

            splashScreen.classList.add('fade-out');
            splashScreen.addEventListener('transitionend', () => {
                splashScreen.style.display = 'none';
                mainContent.style.display = 'block'; // Show main content
                updateContent(); // Update content based on initial language
                populateVoiceList(); // Ensure voices are populated after content is visible
            }, { once: true });
        };
    </script>
</body>
</html>
