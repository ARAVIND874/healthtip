<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>роЖро░рпЛроХрпНроХро┐роп рокропройрпНрокро╛роЯрпБ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        body {
            font-family: 'Noto Sans Tamil', sans-serif;
            background: linear-gradient(135deg, #f0f4f8, #c1c1c1);
            animation: fadeIn 0.8s ease-in-out;
            transition: background-color 0.5s ease;
        }
        .pain-map-svg .body-part:hover {
            fill: #4299e1;
            cursor: pointer;
            transition: fill 0.3s ease;
        }
        .pain-map-svg .body-part.pain {
            fill: #ef4444;
        }
        .fixed-bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        .pain-map-container {
            width: 100%;
            max-width: 400px;
            height: auto;
            margin: 0 auto;
        }
        .output-box {
            width: 100%;
            padding: 1.5rem;
            background-color: #f3f4f6;
            border-radius: 1rem;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #4b5563;
            overflow-y: auto;
        }
        .output-box-container {
            position: relative;
            width: 100%;
        }
        .output-box-actions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #4f46e5;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .feature-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer;
        }
        .feature-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        .login-card {
            background: linear-gradient(180deg, #ffffff, #f9fafb);
        }
    </style>
</head>
<body class="bg-gray-100 antialiased text-gray-800">

<div id="app" class="min-h-screen flex flex-col items-center justify-center p-4"></div>

<div id="bottom-bar" class="fixed-bottom-bar flex justify-center items-center gap-4 p-4 hidden"></div>

<div id="message-box" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center p-4 z-50">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
        <p class="text-lg font-medium text-gray-800 text-center" id="message-text"></p>
        <button onclick="closeMessageBox()" class="mt-4 w-full py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
            роЪро░ро┐
        </button>
    </div>
</div>

<script type="module">
    // Language translations
    const translations = {
        'ta': {
            loginTitle: 'ЁЯФТроЙро│рпНроирпБро┤рпИроХ',
            usernamePlaceholder: 'рокропройро░рпН рокрпЖропро░рпН',
            passwordPlaceholder: 'роХроЯро╡рпБроЪрпНроЪрпКро▓рпН',
            loginButton: 'роЙро│рпНроирпБро┤рпИроп',
            loginError: 'родропро╡рпБроЪрпЖропрпНродрпБ рокропройро░рпН рокрпЖропро░рпН рооро▒рпНро▒рпБроорпН роХроЯро╡рпБроЪрпНроЪрпКро▓рпНро▓рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН.',
            allFeaturesTitle: 'роЕройрпИродрпНродрпБ роЖро░рпЛроХрпНроХро┐роп роЕроорпНроЪроЩрпНроХро│рпН',
            backToFeatures: 'роЕроорпНроЪроЩрпНроХро│рпБроХрпНроХрпБ родро┐ро░рпБроорпНрокрпБ',
            featureNotDeveloped: 'роЗроирпНрод роЕроорпНроЪроорпН роЗройрпНройрпБроорпН роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ.',
            mainMenuTitle: 'роорпБроХрпНроХро┐роп роорпЖройрпБ',
            stepTracker: 'рокроЯро┐ роХрогрпНроХро╛рогро┐рокрпНрокрпБ',
            heartRate: 'роЗродропродрпН родрпБроЯро┐рокрпНрокрпБ',
            waterIntake: 'роирпАро░рпН роЙроЯрпНроХрпКро│рпНро│ро▓рпН',
            moodJournal: 'рооройроиро┐ро▓рпИ & роиройрпНро▒ро┐ропрпБрогро░рпНро╡рпБ роиро╛роЯрпНроХрпБро▒ро┐рокрпНрокрпБ',
            medicationReminder: 'рооро░рпБроирпНродрпБ роиро┐ройрпИро╡рпВроЯрпНроЯро▓рпН',
            foodPlan: 'роЙрогро╡рпБродрпН родро┐роЯрпНроЯроорпН',
            exerciseYoga: 'роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐ & ропрпЛроХро╛',
            bodyPainMap: 'роЙроЯро▓рпН ро╡ро▓ро┐ ро╡ро░рпИрокроЯроорпН',
            generalTips: 'рокрпКродрпБро╡ро╛рой роЪрпБроХро╛родро╛ро░ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН',
            localTips: 'роЙро│рпНро│рпВро░рпН роЪрпБроХро╛родро╛ро░ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН',
            beautyTips: 'ро╡рпАроЯрпНроЯрпБ роЕро┤роХрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН',
            symptomFinder: 'роЕро▒ро┐роХрпБро▒ро┐роХро│рпН роХрогрпНроЯрпБрокро┐роЯро┐рокрпНрокрпБ AI',
            firstAid: 'роорпБродро▓рпБродро╡ро┐ & роЕро╡роЪро░роорпН',
            foodRecipes: 'роЙрогро╡рпБ роЪрпЖропрпНроорпБро▒рпИроХро│рпН',
            search: 'родрпЗроЯрпБ',
            submit: 'роЪрооро░рпНрокрпНрокро┐',
            yourTipHere: 'роЙроЩрпНроХро│рпН роХрпБро▒ро┐рокрпНрокрпБ роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН.',
            noRecipe: 'роЪрпЖропрпНроорпБро▒рпИ роОродрпБро╡рпБроорпН роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ. роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН.',
            loadingMessage: 'AI роХрпБро▒ро┐рокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроХро┐ро▒родрпБ...',
            inputPlaceholderGeneral: 'роирпАроЩрпНроХро│рпН ро╡ро┐ро░рпБроорпНрокрпБроорпН рокрпКродрпБро╡ро╛рой роЪрпБроХро╛родро╛ро░ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            inputPlaceholderBeauty: 'роирпАроЩрпНроХро│рпН ро╡ро┐ро░рпБроорпНрокрпБроорпН роЕро┤роХрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            inputPlaceholderLocal: 'роирпАроЩрпНроХро│рпН ро╡ро┐ро░рпБроорпНрокрпБроорпН роЙро│рпНро│рпВро░рпН роЪрпБроХро╛родро╛ро░ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            inputPlaceholderSymptom: 'роЙроЩрпНроХро│рпН роЕро▒ро┐роХрпБро▒ро┐роХро│рпН рокро▒рпНро▒ро┐роп родроХро╡ро▓рпНроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            inputPlaceholderRecipes: 'роТро░рпБ роЙрогро╡ро┐ройрпН рокрпЖропро░рпН роЕро▓рпНро▓родрпБ роорпВро▓рокрпНрокрпКро░рпБроЯрпНроХро│рпИ роЙро│рпНро│ро┐роЯрпНроЯрпБ роЪрпЖропрпНроорпБро▒рпИропрпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            getTip: 'роХрпБро▒ро┐рокрпНрокрпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН',
            stepsCount: 'рокроЯро┐роХро│рпН: ',
            startTracking: 'роХрогрпНроХро╛рогро┐рокрпНрокрпИ родрпКроЯроЩрпНроХрпБ',
            stopTracking: 'роХрогрпНроХро╛рогро┐рокрпНрокрпИ роиро┐ро▒рпБродрпНродрпБ',
            reset: 'рокроЯро┐роХро│рпИ роорпАроЯрпНроЯроорпИ',
            stepMotivation: 'роТро░рпБ роиро╛ро│рпИроХрпНроХрпБ 10,000 рокроЯро┐роХро│рпН роироЯрокрпНрокродрпБ роЙроЩрпНроХро│рпН роЖро░рпЛроХрпНроХро┐ропродрпНродрпИ роХрогро┐роЪрооро╛роХ роорпЗроорпНрокроЯрпБродрпНродрпБроорпН.',
            journalPrompt: 'роЙроЩрпНроХро│рпН рооройроиро┐ро▓рпИропрпИропрпБроорпН, роирпАроЩрпНроХро│рпН роиройрпНро▒ро┐ропрпБро│рпНро│ ро╡ро┐ро╖ропроЩрпНроХро│рпИропрпБроорпН родро┐ройроорпБроорпН рокродро┐ро╡рпБ роЪрпЖропрпНропрпБроЩрпНроХро│рпН.',
            moodSelect: '-- рооройроиро┐ро▓рпИропрпИродрпН родрпЗро░рпНро╡рпБроЪрпЖропрпНропро╡рпБроорпН --',
            moodHappy: 'роороХро┐ро┤рпНроЪрпНроЪро┐',
            moodSad: 'роЪрпЛроХроорпН',
            moodNormal: 'роЪро╛родро╛ро░рогроорпН',
            moodAnxious: 'рокродроЯрпНроЯроорпН',
            moodGrateful: 'роиройрпНро▒ро┐ропрпБрогро░рпНро╡рпБ',
            saveEntry: 'рокродро┐ро╡рпИ роЪрпЗрооро┐',
            analyzeMood: 'рооройроиро┐ро▓рпИропрпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпН',
            moodAnalysis: 'рооройроиро┐ро▓рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ',
            moodAnalysisPlaceholder: 'роЙроЩрпНроХро│рпН рооройроиро┐ро▓рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН.',
            yourEntries: 'роЙроЩрпНроХро│рпН рокродро┐ро╡рпБроХро│рпН',
            entriesPlaceholder: 'роЙроЩрпНроХро│рпН роиро╛роЯрпНроХрпБро▒ро┐рокрпНрокрпБ рокродро┐ро╡рпБроХро│рпН роЗроЩрпНроХрпЗ родрпЛройрпНро▒рпБроорпН.',
            foodPlanPrompt: 'роЙроЩрпНроХро│рпН роЙрогро╡рпБ, роЙроЯро▓рпНроиро▓роорпН, роТро╡рпНро╡ро╛роорпИ роЕро▓рпНро▓родрпБ рокро┐ро░роЪрпНроЪройрпИропрпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН.',
            painMapPrompt: 'роЙроЯро▓ро┐ройрпН роОроирпНродрокрпН рокроХрпБродро┐ропро┐ро▓рпН ро╡ро▓ро┐ роЗро░рпБроХрпНроХро┐ро▒родрпЛ, роЕродрпИродрпН родрпКроЯрпНроЯрпБ ро╡ро▓ро┐ рооро▒рпНро▒рпБроорпН роЕродройрпН ро╡ро┐ро│роХрпНроХродрпНродрпИ роЪрпЗро░рпНроХрпНроХро╡рпБроорпН.',
            removePain: 'роирпАроЩрпНроХро│рпН роЕродрпИ роорпАрогрпНроЯрпБроорпН роЕро┤рпБродрпНродро┐ройро╛ро▓рпН ро╡ро▓ро┐ роирпАроХрпНроХрокрпНрокроЯрпБроорпН.',
            aiTipTitle: 'AI роЙродро╡ро┐роХрпНроХрпБро▒ро┐рокрпНрокрпБ',
            firstAidPrompt: 'роЕро╡роЪро░ роХро╛ро▓роЩрпНроХро│ро┐ро▓рпН роЙродро╡ро┐роХро│рпН рооро▒рпНро▒рпБроорпН родроХро╡ро▓рпНроХро│рпИ рокрпЖро▒ро╡рпБроорпН.',
            emergencyContacts: 'роЕро╡роЪро░ родрпКроЯро░рпНрокрпБроХро│рпН',
            addContact: 'родрпКроЯро░рпНрокрпИ роЪрпЗро░рпН',
            noContacts: 'роЕро╡роЪро░ родрпКроЯро░рпНрокрпБроХро│рпН роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ.',
            symptomPrompt: 'роЙроЩрпНроХро│рпН роЕро▒ро┐роХрпБро▒ро┐роХро│рпН рокро▒рпНро▒ро┐роп родроХро╡ро▓рпНроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            exercisePrompt: 'роЙроЩрпНроХро│рпН роЙроЯро▒рпНрокропро┐ро▒рпНроЪро┐, ро╡ро▓ро┐ роЕро▓рпНро▓родрпБ рокро┐ро░роЪрпНроЪройрпИроХрпНроХро╛рой ропрпЛроЪройрпИроХро│рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН.',
            painPromptPrefix: 'роЗроирпНрод роЙроЯро▒рпНрокроХрпБродро┐ ро╡ро▓ро┐роХрпНроХрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН:',
            painMapTipInstructions: 'ро╡ро▓ро┐ роЙро│рпНро│ рокроХрпБродро┐ропрпИродрпН родрпКроЯрпНроЯрпБ, роЕродройрпН рокро▒рпНро▒ро┐роп роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН.',
            genericPainTip: 'роЙроЯро▓рпН ро╡ро▓ро┐роХрпНроХрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпИрокрпН рокрпЖро▒ роТро░рпБ роЙроЯро▓рпН рокроХрпБродро┐ропрпИродрпН родрпКроЯро╡рпБроорпН.',
            micListening: 'роХрпЗроЯрпНроХро┐ро▒родрпБ...',
            micStopped: 'роорпИроХрпНро░рпЛроГрокрпЛройрпН роиро┐ро▒рпБродрпНродро┐ро╡ро┐роЯрпНроЯродрпБ.',
            speakTip: 'роХрпБро▒ро┐рокрпНрокрпИрокрпН рокрпЗроЪро╡рпБроорпН',
            stopSpeaking: 'рокрпЗроЪрпБро╡родрпИ роиро┐ро▒рпБродрпНродро╡рпБроорпН',
            motionSensorNotSupported: 'роЙроЩрпНроХро│рпН роЪро╛родройроорпН роорпЛро╖ройрпН роЪрпЖройрпНроЪро╛ро░рпИ роЖродро░ро┐роХрпНроХро╡ро┐ро▓рпНро▓рпИ. (Your device does not support motion sensors).',
            emergencyTip: 'роЕро╡роЪро░ роЙродро╡ро┐роХрпНроХрпБро▒ро┐рокрпНрокрпБ',
            viewFront: 'роорпБройрпНрокроХрпНроХ рокро╛ро░рпНро╡рпИ',
            viewBack: 'рокро┐ройрпНродро┐ро░рпБроорпНрокро┐роп рокро╛ро░рпНро╡рпИ',
            getRecipe: 'роЪрпЖропрпНроорпБро▒рпИропрпИрокрпН рокрпЖро▒рпБроЩрпНроХро│рпН',
            ingredientsTitle: 'родрпЗро╡рпИропро╛рой рокрпКро░рпБроЯрпНроХро│рпН',
            instructionsTitle: 'роЪрпЖропрпНроорпБро▒рпИ',
        },
        'en': {
            loginTitle: 'ЁЯФТLogin',
            usernamePlaceholder: 'Username',
            passwordPlaceholder: 'Password',
            loginButton: 'Log In',
            loginError: 'Please enter a username and password.',
            allFeaturesTitle: 'All Health Features',
            backToFeatures: 'Back to Features',
            featureNotDeveloped: 'This feature is not yet developed.',
            mainMenuTitle: 'Main Menu',
            stepTracker: 'Step Tracker',
            heartRate: 'Heart Rate',
            waterIntake: 'Water Intake',
            moodJournal: 'Mood & Gratitude Journal',
            medicationReminder: 'Medication Reminder',
            foodPlan: 'Food Plan',
            exerciseYoga: 'Exercise & Yoga',
            bodyPainMap: 'Body Pain Map',
            generalTips: 'General Health Tips',
            localTips: 'Local Health Tips',
            beautyTips: 'Home Beauty Tips',
            symptomFinder: 'Symptom Finder AI',
            firstAid: 'First Aid & Emergency',
            foodRecipes: 'Food Recipes',
            search: 'Search',
            submit: 'Submit',
            yourTipHere: 'Your tip will appear here.',
            noRecipe: 'No recipe available. Please try again.',
            loadingMessage: 'Generating AI tip...',
            inputPlaceholderGeneral: 'Get the general health tips you want.',
            inputPlaceholderBeauty: 'Get the beauty tips you want.',
            inputPlaceholderLocal: 'Get the local health tips you want.',
            inputPlaceholderSymptom: 'Get information about your symptoms.',
            inputPlaceholderRecipes: 'Enter a food name or ingredients to get the recipe.',
            getTip: 'Get Tips',
            stepsCount: 'Steps: ',
            startTracking: 'Start Tracking',
            stopTracking: 'Stop Tracking',
            reset: 'Reset Steps',
            stepMotivation: 'Walking 10,000 steps a day can significantly improve your health.',
            journalPrompt: 'Record your mood and things you are grateful for daily.',
            moodSelect: '-- Select a mood --',
            moodHappy: 'Happy',
            moodSad: 'Sad',
            moodNormal: 'Normal',
            moodAnxious: 'Anxious',
            moodGrateful: 'Grateful',
            saveEntry: 'Save Entry',
            analyzeMood: 'Analyze Mood',
            moodAnalysis: 'Mood Analysis',
            moodAnalysisPlaceholder: 'Your mood analysis will appear here.',
            yourEntries: 'Your Entries',
            entriesPlaceholder: 'Your journal entries will appear here.',
            foodPlanPrompt: 'Enter your diet, health, allergy or problem.',
            painMapPrompt: 'Touch the area of your body where you have pain to add the pain and its description.',
            removePain: 'You can touch it again to remove the pain.',
            aiTipTitle: 'AI Tip',
            firstAidPrompt: 'Get help and information in emergencies.',
            emergencyContacts: 'Emergency Contacts',
            addContact: 'Add Contact',
            noContacts: 'No emergency contacts added.',
            symptomPrompt: 'Get information about your symptoms.',
            exercisePrompt: 'Enter your exercise, pain or problem for ideas.',
            painPromptPrefix: 'Tips for this body part pain:',
            painMapTipInstructions: 'Touch a painful area to get tips about it.',
            genericPainTip: 'Touch a body part to get tips for pain in that area.',
            micListening: 'Listening...',
            micStopped: 'Microphone stopped.',
            speakTip: 'Speak Tip',
            stopSpeaking: 'Stop Speaking',
            motionSensorNotSupported: 'Your device does not support motion sensors.',
            emergencyTip: 'Emergency Tip',
            viewFront: 'Front View',
            viewBack: 'Back View',
            getRecipe: 'Get Recipe',
            ingredientsTitle: 'Ingredients',
            instructionsTitle: 'Instructions',
        }
    };
    
    // Updated list of features with colors
    const features = [
        { id: 'stepTracker', icon: 'fa-walking', titleKey: 'stepTracker', color: 'bg-green-500' },
        { id: 'generalTips', icon: 'fa-lightbulb', titleKey: 'generalTips', color: 'bg-yellow-500' },
        { id: 'symptomFinder', icon: 'fa-stethoscope', titleKey: 'symptomFinder', color: 'bg-blue-500' },
        { id: 'firstAid', icon: 'fa-hand-holding-medical', titleKey: 'firstAid', color: 'bg-red-500' },
        { id: 'localTips', icon: 'fa-seedling', titleKey: 'localTips', color: 'bg-lime-500' },
        { id: 'foodPlan', icon: 'fa-apple-alt', titleKey: 'foodPlan', color: 'bg-orange-500' },
        { id: 'foodRecipes', icon: 'fa-utensils', titleKey: 'foodRecipes', color: 'bg-amber-500' },
        { id: 'beautyTips', icon: 'fa-spa', titleKey: 'beautyTips', color: 'bg-pink-500' },
        { id: 'exerciseYoga', icon: 'fa-running', titleKey: 'exerciseYoga', color: 'bg-indigo-500' },
        { id: 'bodyPainMap', icon: 'fa-user-injured', titleKey: 'bodyPainMap', color: 'bg-purple-500' },
        { id: 'moodJournal', icon: 'fa-grin-hearts', titleKey: 'moodJournal', color: 'bg-sky-500' },
    ];

    // Mapping from SVG part IDs to human-readable names for AI prompt generation
    const painMapPartNames = {
        'head-front': { ta: 'родро▓рпИ', en: 'head' },
        'neck-front': { ta: 'роХро┤рпБродрпНродрпБ', en: 'neck' },
        'chest-front': { ta: 'рооро╛ро░рпНрокрпБ', en: 'chest' },
        'stomach-front': { ta: 'ро╡ропро┐ро▒рпБ', en: 'stomach' },
        'shoulder-r-front': { ta: 'ро╡ро▓родрпБ родрпЛро│рпНрокроЯрпНроЯрпИ', en: 'right shoulder' },
        'shoulder-l-front': { ta: 'роЗроЯродрпБ родрпЛро│рпНрокроЯрпНроЯрпИ', en: 'left shoulder' },
        'arm-r-front': { ta: 'ро╡ро▓родрпБ роХрпИ', en: 'right arm' },
        'arm-l-front': { ta: 'роЗроЯродрпБ роХрпИ', en: 'left arm' },
        'elbow-r-front': { ta: 'ро╡ро▓родрпБ роорпБро┤роЩрпНроХрпИ', en: 'right elbow' },
        'elbow-l-front': { ta: 'роЗроЯродрпБ роорпБро┤роЩрпНроХрпИ', en: 'left elbow' },
        'forearm-r-front': { ta: 'ро╡ро▓родрпБ роорпБройрпНроХрпИ', en: 'right forearm' },
        'forearm-l-front': { ta: 'роЗроЯродрпБ роорпБройрпНроХрпИ', en: 'left forearm' },
        'hand-r-front': { ta: 'ро╡ро▓родрпБ роХрпИ', en: 'right hand' },
        'hand-l-front': { ta: 'роЗроЯродрпБ роХрпИ', en: 'left hand' },
        'waist-front': { ta: 'роЗроЯрпБрокрпНрокрпБ', en: 'waist' },
        'thigh-r-front': { ta: 'ро╡ро▓родрпБ родрпКроЯрпИ', en: 'right thigh' },
        'thigh-l-front': { ta: 'роЗроЯродрпБ родрпКроЯрпИ', en: 'left thigh' },
        'knee-r-front': { ta: 'ро╡ро▓родрпБ роорпБро┤роЩрпНроХро╛ро▓рпН', en: 'right knee' },
        'knee-l-front': { ta: 'роЗроЯродрпБ роорпБро┤роЩрпНроХро╛ро▓рпН', en: 'left knee' },
        'shin-r-front': { ta: 'ро╡ро▓родрпБ роХро╛ро▓рпН', en: 'right shin' },
        'shin-l-front': { ta: 'роЗроЯродрпБ роХро╛ро▓рпН', en: 'left shin' },
        'ankle-r-front': { ta: 'ро╡ро▓родрпБ роХрогрпБроХрпНроХро╛ро▓рпН', en: 'right ankle' },
        'ankle-l-front': { ta: 'роЗроЯродрпБ роХрогрпБроХрпНроХро╛ро▓рпН', en: 'left ankle' },
        'foot-r-front': { ta: 'ро╡ро▓родрпБ рокро╛родроорпН', en: 'right foot' },
        'foot-l-front': { ta: 'роЗроЯродрпБ рокро╛родроорпН', en: 'left foot' },
        // Back View
        'head-back': { ta: 'родро▓рпИ', en: 'head' },
        'neck-back': { ta: 'роХро┤рпБродрпНродрпБ', en: 'neck' },
        'back-back': { ta: 'роорпБродрпБроХрпБ', en: 'back' },
        'buttocks-back': { ta: 'рокро┐роЯрпНроЯроорпН', en: 'buttocks' },
        'shoulder-r-back': { ta: 'ро╡ро▓родрпБ родрпЛро│рпНрокроЯрпНроЯрпИ', en: 'right shoulder' },
        'shoulder-l-back': { ta: 'роЗроЯродрпБ родрпЛро│рпНрокроЯрпНроЯрпИ', en: 'left shoulder' },
        'arm-r-back': { ta: 'ро╡ро▓родрпБ роХрпИ', en: 'right arm' },
        'arm-l-back': { ta: 'роЗроЯродрпБ роХрпИ', en: 'left arm' },
        'elbow-r-back': { ta: 'ро╡ро▓родрпБ роорпБро┤роЩрпНроХрпИ', en: 'right elbow' },
        'elbow-l-back': { ta: 'роЗроЯродрпБ роорпБро┤роЩрпНроХрпИ', en: 'left elbow' },
        'forearm-r-back': { ta: 'ро╡ро▓родрпБ роорпБройрпНроХрпИ', en: 'right forearm' },
        'forearm-l-back': { ta: 'роЗроЯродрпБ роорпБройрпНроХрпИ', en: 'left forearm' },
        'hand-r-back': { ta: 'ро╡ро▓родрпБ роХрпИ', en: 'right hand' },
        'hand-l-back': { ta: 'роЗроЯродрпБ роХрпИ', en: 'left hand' },
        'waist-back': { ta: 'роЗроЯрпБрокрпНрокрпБ', en: 'waist' },
        'thigh-r-back': { ta: 'ро╡ро▓родрпБ родрпКроЯрпИ', en: 'right thigh' },
        'thigh-l-back': { ta: 'роЗроЯродрпБ родрпКроЯрпИ', en: 'left thigh' },
        'knee-r-back': { ta: 'ро╡ро▓родрпБ роорпБро┤роЩрпНроХро╛ро▓рпН', en: 'right knee' },
        'knee-l-back': { ta: 'роЗроЯродрпБ роорпБро┤роЩрпНроХро╛ро▓рпН', en: 'left knee' },
        'calf-r-back': { ta: 'ро╡ро▓родрпБ роХройрпНро▒рпБ', en: 'right calf' },
        'calf-l-back': { ta: 'роЗроЯродрпБ роХройрпНро▒рпБ', en: 'left calf' },
        'ankle-r-back': { ta: 'ро╡ро▓родрпБ роХрогрпБроХрпНроХро╛ро▓рпН', en: 'right ankle' },
        'ankle-l-back': { ta: 'роЗроЯродрпБ роХрогрпБроХрпНроХро╛ро▓рпН', en: 'left ankle' },
        'foot-r-back': { ta: 'ро╡ро▓родрпБ рокро╛родроорпН', en: 'right foot' },
        'foot-l-back': { ta: 'роЗроЯродрпБ рокро╛родроорпН', en: 'left foot' },
    };

    let currentPage = 'login';
    let currentLang = 'ta';
    let steps = 0;
    let isTracking = false;
    let lastAcceleration = { x: 0, y: 0, z: 0 };
    const stepThreshold = 1.2;
    let stepCooldown = false;
    let cooldownTimer = null;
    let stepTrackerHandler = null;
    const moodEntries = [];
    const foodPlan = [];
    const emergencyContacts = [];
    const painMapState = {};
    let isFrontView = true;

    const getTranslation = (key) => translations[currentLang][key] || key;
    const appContainer = document.getElementById('app');
    const bottomBar = document.getElementById('bottom-bar');
    const messageBox = document.getElementById('message-box');
    const messageText = document.getElementById('message-text');

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const synth = window.speechSynthesis;

    let recognition = null;
    let isListening = false;
    let isSpeaking = false;

    function showMessageBox(message) {
        messageText.textContent = message;
        messageBox.classList.remove('hidden');
        messageBox.classList.add('flex');
    }

    function closeMessageBox() {
        messageBox.classList.add('hidden');
        messageBox.classList.remove('flex');
    }

    const toggleSpeechRecognition = (inputElementId, buttonElement) => {
        const aiTipElement = document.getElementById('tipOutput') || document.getElementById('recipeOutput');
        const input = document.getElementById(inputElementId);

        if (!SpeechRecognition) {
            showMessageBox('роЙроЩрпНроХро│рпН роЙро▓ро╛ро╡ро┐ рокрпЗроЪрпНроЪрпБ роЕроЩрпНроХрпАроХро╛ро░родрпНродрпИ роЖродро░ро┐роХрпНроХро╡ро┐ро▓рпНро▓рпИ. (Your browser does not support Speech Recognition).');
            return;
        }

        if (isListening) {
            recognition.stop();
            isListening = false;
            buttonElement.innerHTML = '<i class="fas fa-microphone"></i>';
            if (aiTipElement) {
                aiTipElement.textContent = getTranslation('micStopped');
            }
        } else {
            recognition = new SpeechRecognition();
            recognition.lang = currentLang === 'ta' ? 'ta-IN' : 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                isListening = true;
                buttonElement.innerHTML = '<i class="fas fa-microphone-slash"></i>';
                if (aiTipElement) {
                    aiTipElement.textContent = getTranslation('micListening');
                }
            };

            recognition.onresult = (event) => {
                const speechResult = event.results[0][0].transcript;
                if (input) {
                    input.value = speechResult;
                }
                if (aiTipElement) {
                    aiTipElement.textContent = '';
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error', event.error);
                showMessageBox(`рокрпЗроЪрпНроЪрпБ роЕроЩрпНроХрпАроХро╛ро░роорпН рокро┐ро┤рпИ: ${event.error}. (Speech recognition error: ${event.error})`);
            };

            recognition.onend = () => {
                isListening = false;
                buttonElement.innerHTML = '<i class="fas fa-microphone"></i>';
                if (aiTipElement && aiTipElement.textContent === getTranslation('micListening')) {
                    aiTipElement.textContent = '';
                }
            };

            recognition.start();
        }
    };

    const toggleSpeak = (text, buttonElement) => {
        if (!synth) {
            showMessageBox('роЙроЩрпНроХро│рпН роЙро▓ро╛ро╡ро┐ рокрпЗроЪрпНроЪрпБ родрпКроХрпБрокрпНрокрпИ роЖродро░ро┐роХрпНроХро╡ро┐ро▓рпНро▓рпИ. (Your browser does not support speech synthesis).');
            return;
        }

        if (isSpeaking) {
            synth.cancel();
            isSpeaking = false;
            buttonElement.innerHTML = '<i class="fas fa-volume-up"></i>';
        } else {
            if (!text || text.trim() === getTranslation('yourTipHere') || text.trim() === getTranslation('noRecipe') || text.trim() === getTranslation('loadingMessage')) {
                showMessageBox('рокрпЗроЪ роОродрпБро╡рпБроорпН роЗро▓рпНро▓рпИ.');
                return;
            }

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = currentLang === 'ta' ? 'ta-IN' : 'en-US';

            utterance.onstart = () => {
                isSpeaking = true;
                buttonElement.innerHTML = '<i class="fas fa-volume-mute"></i>';
            };

            utterance.onend = () => {
                isSpeaking = false;
                buttonElement.innerHTML = '<i class="fas fa-volume-up"></i>';
            };

            synth.speak(utterance);
        }
    };
    
    // Function to parse and format general AI tips
    const parseTipsAsList = (tipText) => {
        const lines = tipText.split('\n').filter(line => line.trim() !== '');
        
        let html = '';
        if (lines.length > 1) {
            html += '<ol class="list-decimal list-inside space-y-2 mt-4 text-left">';
            lines.forEach(line => {
                const cleanedLine = line.replace(/^\s*(\d+\.|\*|-)\s*/, '').trim();
                if (cleanedLine) {
                    html += `<li class="text-gray-700">${cleanedLine}</li>`;
                }
            });
            html += '</ol>';
        } else {
            html = `<p class="text-gray-700 mt-4 text-center">${tipText}</p>`;
        }
        return html;
    };

    // Function to parse and format AI recipes
    const parseRecipe = (recipeText) => {
        const parts = recipeText.split(getTranslation('instructionsTitle'));
        const ingredientsPart = parts[0].replace(getTranslation('ingredientsTitle'), '').trim();
        const instructionsPart = parts[1] ? parts[1].trim() : '';

        let html = '';
        
        if (ingredientsPart) {
            const ingredientsLines = ingredientsPart.split('\n').filter(line => line.trim() !== '');
            html += `<h3 class="text-xl font-bold mt-4 mb-2 text-gray-800">${getTranslation('ingredientsTitle')}</h3>`;
            html += '<ul class="list-disc list-inside space-y-1 text-left">';
            ingredientsLines.forEach(line => {
                html += `<li class="text-gray-700">${line.trim()}</li>`;
            });
            html += '</ul>';
        }
        
        if (instructionsPart) {
            const instructionsLines = instructionsPart.split('\n').filter(line => line.trim() !== '');
            html += `<h3 class="text-xl font-bold mt-4 mb-2 text-gray-800">${getTranslation('instructionsTitle')}</h3>`;
            html += '<ol class="list-decimal list-inside space-y-2 text-left">';
            instructionsLines.forEach(line => {
                html += `<li class="text-gray-700">${line.trim()}</li>`;
            });
            html += '</ol>';
        }

        if (!ingredientsPart && !instructionsPart) {
            html = `<p class="text-gray-700 mt-4 text-center">${getTranslation('noRecipe')}</p>`;
        }
        
        return html;
    };

    const getAiTipFromPrompt = async (prompt, outputId) => {
        const outputElement = document.getElementById(outputId);
        outputElement.innerHTML = `<div class="loading-spinner"></div> <span class="ml-2">${getTranslation('loadingMessage')}</span>`;

        const finalPrompt = `${prompt}
Please provide a response in ${currentLang === 'ta' ? 'Tamil' : 'English'}. Format the response as a detailed, step-by-step numbered list. Add some relevant emojis for each step. Do not include any introductory or concluding sentences outside of the list.`;

        try {
            const chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: finalPrompt }] });
            const payload = { contents: chatHistory };

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API call failed with status: ${response.status}. Message: ${errorData.error.message}`);
            }

            const result = await response.json();

            let tipText = getTranslation('yourTipHere');
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                tipText = result.candidates[0].content.parts[0].text;
            } else {
                tipText = getTranslation('noRecipe');
            }

            outputElement.innerHTML = parseTipsAsList(tipText);
        } catch (error) {
            console.error('Error generating AI tip:', error);
            outputElement.innerHTML = `<p class="text-red-500 text-center">роЙродро╡ро┐роХрпНроХрпБро▒ро┐рокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ: ${error.message}</p>`;
        }
    };
    
    // New function to get a recipe from AI
    const getAiRecipeFromPrompt = async (prompt, outputId) => {
        const outputElement = document.getElementById(outputId);
        outputElement.innerHTML = `<div class="loading-spinner"></div> <span class="ml-2">${getTranslation('loadingMessage')}</span>`;

        // Create a specific prompt for recipes, requesting ingredients and instructions
        const recipePrompt = `I need a recipe for "${prompt}". Please provide the recipe in Tamil with two distinct sections: '${getTranslation('ingredientsTitle')}' and '${getTranslation('instructionsTitle')}'. Do not include any extra text.`;

        try {
            const chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: recipePrompt }] });
            const payload = { contents: chatHistory };

            const apiKey = "AIzaSyBNO54-Ds6cEucn8aerq0ZLQZBNegFLsJY";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API call failed with status: ${response.status}. Message: ${errorData.error.message}`);
            }

            const result = await response.json();

            let recipeText = getTranslation('noRecipe');
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                recipeText = result.candidates[0].content.parts[0].text;
            }

            outputElement.innerHTML = parseRecipe(recipeText);
        } catch (error) {
            console.error('Error generating AI recipe:', error);
            outputElement.innerHTML = `<p class="text-red-500 text-center">роЪрпЖропрпНроорпБро▒рпИропрпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ: ${error.message}</p>`;
        }
    };

    const render = () => {
        appContainer.innerHTML = '';
        bottomBar.innerHTML = '';

        bottomBar.classList.add('hidden');

        // Stop the motion sensor listener before rendering a new page
        if (stepTrackerHandler) {
            window.removeEventListener('devicemotion', stepTrackerHandler);
            stepTrackerHandler = null;
            isTracking = false;
        }

        switch (currentPage) {
            case 'login':
                renderLoginPage();
                break;
            case 'main':
                renderMainPage();
                break;
            case 'stepTracker':
                renderStepTrackerPage();
                renderBottomBar();
                break;
            case 'moodJournal':
                renderMoodJournalPage();
                renderBottomBar();
                break;
            case 'foodRecipes':
                renderFoodRecipesPage();
                renderBottomBar();
                break;
            case 'bodyPainMap':
                renderBodyPainMapPage();
                renderBottomBar();
                break;
            case 'firstAid':
                renderFirstAidPage();
                renderBottomBar();
                break;
            case 'exerciseYoga':
            case 'beautyTips':
            case 'generalTips':
            case 'localTips':
            case 'symptomFinder':
            case 'foodPlan':
                const featureTitle = getTranslation(currentPage);
                let placeholderKey = currentPage === 'foodPlan' ? 'foodPlanPrompt' : (currentPage === 'exerciseYoga' ? 'exercisePrompt' : `inputPlaceholder${currentPage.charAt(0).toUpperCase() + currentPage.slice(1)}`);
                if (!translations[currentLang][placeholderKey]) {
                    placeholderKey = 'yourTipHere';
                }
                renderAiTipsPage(featureTitle, getTranslation(placeholderKey), currentPage);
                renderBottomBar();
                break;
            default:
                renderSimplePage(getTranslation('featureNotDeveloped'), 'ЁЯЪл', '');
                break;
        }
    };

    const navigateTo = (page) => {
        currentPage = page;
        render();
    };

    const toggleLanguage = () => {
        currentLang = currentLang === 'ta' ? 'en' : 'ta';
        render();
    };

    const renderBottomBar = () => {
        bottomBar.innerHTML = `
            <button id="backButton" class="bg-gray-200 text-gray-800 p-3 rounded-full shadow-lg hover:bg-gray-300 transition-colors flex items-center justify-center">
                <i class="fa fa-arrow-left"></i>
                <span class="ml-2 font-bold">${getTranslation('backToFeatures')}</span>
            </button>
            <button id="langToggleBottom" class="bg-gray-200 text-gray-800 text-xl p-3 rounded-full shadow-lg hover:bg-gray-300 transition-colors flex items-center justify-center">
                <i class="fas fa-globe"></i>
            </button>
        `;
        bottomBar.classList.remove('hidden');

        document.getElementById('backButton').addEventListener('click', () => navigateTo('main'));
        document.getElementById('langToggleBottom').addEventListener('click', toggleLanguage);
    };

    const renderLoginPage = () => {
        appContainer.innerHTML = `
            <div class="login-card p-8 rounded-2xl shadow-2xl w-full max-w-sm transform transition-all duration-300 scale-95 hover:scale-100">
                <h2 class="text-4xl font-extrabold mb-6 text-center text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500">${getTranslation('loginTitle')}</h2>
                <input id="username" type="text" placeholder="${getTranslation('usernamePlaceholder')}" class="w-full p-4 mb-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-4 focus:ring-purple-300 transition-colors">
                <input id="password" type="password" placeholder="${getTranslation('passwordPlaceholder')}" class="w-full p-4 mb-6 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-4 focus:ring-purple-300 transition-colors">
                <button id="loginButton" class="w-full py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-indigo-300">
                    ${getTranslation('loginButton')}
                </button>
                <button id="langToggle" class="w-full mt-4 py-3 bg-gray-200 text-gray-800 font-semibold rounded-xl hover:bg-gray-300 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-400">
                    <i class="fas fa-globe mr-2"></i> ${currentLang === 'ta' ? 'English' : 'родрооро┐ро┤рпН'}
                </button>
            </div>
        `;

        document.getElementById('loginButton').addEventListener('click', () => {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            if (username && password) {
                navigateTo('main');
            } else {
                showMessageBox(getTranslation('loginError'));
            }
        });
        document.getElementById('langToggle').addEventListener('click', toggleLanguage);
    };

    const renderMainPage = () => {
        appContainer.innerHTML = `
            <div class="w-full max-w-4xl p-6 md:p-10 bg-white rounded-3xl shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-800">${getTranslation('allFeaturesTitle')}</h1>
                    <button id="langToggleMain" class="p-3 bg-gray-200 text-gray-800 text-xl rounded-full shadow-md hover:bg-gray-300 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-400">
                        <i class="fas fa-globe"></i>
                    </button>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
                    ${features.map(feature => `
                        <div class="feature-card flex flex-col items-center justify-center p-4 md:p-6 rounded-2xl shadow-md ${feature.color} text-white text-center">
                            <i class="fas ${feature.icon} text-4xl mb-3"></i>
                            <span class="text-sm md:text-base font-semibold">${getTranslation(feature.titleKey)}</span>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;

        features.forEach(feature => {
            document.querySelector(`.feature-card:nth-child(${features.indexOf(feature) + 1})`).addEventListener('click', () => {
                navigateTo(feature.id);
            });
        });
        document.getElementById('langToggleMain').addEventListener('click', toggleLanguage);
    };

    const renderStepTrackerPage = () => {
        appContainer.innerHTML = `
            <div class="w-full max-w-md bg-white p-8 rounded-2xl shadow-xl text-center">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">${getTranslation('stepTracker')}</h2>
                <div class="flex items-center justify-center mb-6 text-5xl text-indigo-600">
                    <i class="fas fa-walking mr-4"></i>
                    <span id="stepCountDisplay" class="font-extrabold text-7xl">${steps}</span>
                </div>
                <p class="text-gray-600 mb-6">${getTranslation('stepMotivation')}</p>
                <div class="space-y-4">
                    <button id="startStopButton" class="w-full py-4 font-bold rounded-xl text-white shadow-lg transform transition-all duration-300 focus:outline-none focus:ring-4 ${isTracking ? 'bg-red-500 hover:bg-red-600 focus:ring-red-300' : 'bg-green-500 hover:bg-green-600 focus:ring-green-300'}">
                        ${isTracking ? getTranslation('stopTracking') : getTranslation('startTracking')}
                    </button>
                    <button id="resetButton" class="w-full py-4 bg-gray-300 text-gray-800 font-bold rounded-xl shadow-md hover:bg-gray-400 transition-colors transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-500">
                        ${getTranslation('reset')}
                    </button>
                </div>
            </div>
        `;
        
        document.getElementById('startStopButton').addEventListener('click', () => {
            if (isTracking) {
                stopStepTracking();
            } else {
                startStepTracking();
            }
        });

        document.getElementById('resetButton').addEventListener('click', () => {
            steps = 0;
            document.getElementById('stepCountDisplay').textContent = steps;
        });
    };

    const startStepTracking = () => {
        if (!isTracking) {
            if ('ondevicemotion' in window) {
                isTracking = true;
                stepTrackerHandler = (event) => {
                    const acceleration = event.accelerationIncludingGravity;
                    const totalAcceleration = Math.sqrt(
                        Math.pow(acceleration.x, 2) +
                        Math.pow(acceleration.y, 2) +
                        Math.pow(acceleration.z, 2)
                    );
                    
                    if (totalAcceleration > stepThreshold && !stepCooldown) {
                        steps++;
                        document.getElementById('stepCountDisplay').textContent = steps;
                        stepCooldown = true;
                        cooldownTimer = setTimeout(() => {
                            stepCooldown = false;
                        }, 500); // Cooldown to prevent multiple steps from one motion
                    }
                };
                window.addEventListener('devicemotion', stepTrackerHandler);
                document.getElementById('startStopButton').textContent = getTranslation('stopTracking');
                document.getElementById('startStopButton').classList.replace('bg-green-500', 'bg-red-500');
                document.getElementById('startStopButton').classList.replace('focus:ring-green-300', 'focus:ring-red-300');
            } else {
                showMessageBox(getTranslation('motionSensorNotSupported'));
            }
        }
    };

    const stopStepTracking = () => {
        isTracking = false;
        if (stepTrackerHandler) {
            window.removeEventListener('devicemotion', stepTrackerHandler);
        }
        if (cooldownTimer) {
            clearTimeout(cooldownTimer);
        }
        document.getElementById('startStopButton').textContent = getTranslation('startTracking');
        document.getElementById('startStopButton').classList.replace('bg-red-500', 'bg-green-500');
        document.getElementById('startStopButton').classList.replace('focus:ring-red-300', 'focus:ring-green-300');
    };

    const renderMoodJournalPage = () => {
        appContainer.innerHTML = `
            <div class="w-full max-w-md bg-white p-8 rounded-2xl shadow-xl">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">${getTranslation('moodJournal')}</h2>
                <div class="flex items-center justify-center mb-6">
                    <i class="fas fa-book-open text-5xl text-sky-600"></i>
                </div>
                <p class="text-gray-600 mb-4 text-center">${getTranslation('journalPrompt')}</p>
                <select id="moodSelect" class="w-full p-3 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500">
                    <option value="">${getTranslation('moodSelect')}</option>
                    <option value="happy">${getTranslation('moodHappy')}</option>
                    <option value="sad">${getTranslation('moodSad')}</option>
                    <option value="normal">${getTranslation('moodNormal')}</option>
                    <option value="anxious">${getTranslation('moodAnxious')}</option>
                    <option value="grateful">${getTranslation('moodGrateful')}</option>
                </select>
                <textarea id="journalEntry" rows="4" placeholder="${getTranslation('entriesPlaceholder')}" class="w-full p-3 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"></textarea>
                <button id="saveEntryButton" class="w-full py-3 bg-sky-600 text-white font-bold rounded-xl shadow-lg hover:bg-sky-700 transition-colors transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-sky-300">
                    ${getTranslation('saveEntry')}
                </button>
                <div class="mt-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">${getTranslation('yourEntries')}</h3>
                    <div id="entriesList" class="space-y-4 max-h-64 overflow-y-auto p-2 bg-gray-100 rounded-lg">
                        <p class="text-gray-500 text-center">${getTranslation('entriesPlaceholder')}</p>
                    </div>
                </div>
            </div>
        `;
        
        const saveEntryButton = document.getElementById('saveEntryButton');
        saveEntryButton.addEventListener('click', () => {
            const mood = document.getElementById('moodSelect').value;
            const entry = document.getElementById('journalEntry').value.trim();
            if (mood && entry) {
                const newEntry = {
                    mood: mood,
                    text: entry,
                    date: new Date().toLocaleString()
                };
                moodEntries.unshift(newEntry);
                updateEntriesList();
                document.getElementById('journalEntry').value = '';
                document.getElementById('moodSelect').value = '';
            } else {
                showMessageBox('Please select a mood and write an entry.');
            }
        });

        const updateEntriesList = () => {
            const entriesList = document.getElementById('entriesList');
            entriesList.innerHTML = '';
            if (moodEntries.length > 0) {
                moodEntries.forEach(entry => {
                    const entryDiv = document.createElement('div');
                    entryDiv.className = 'p-4 bg-white rounded-lg shadow-md';
                    entryDiv.innerHTML = `
                        <p class="text-sm text-gray-500">${entry.date}</p>
                        <p class="font-bold text-lg text-gray-800">${getTranslation('mood' + entry.mood.charAt(0).toUpperCase() + entry.mood.slice(1))}</p>
                        <p class="text-gray-700 mt-2">${entry.text}</p>
                    `;
                    entriesList.appendChild(entryDiv);
                });
            } else {
                entriesList.innerHTML = `<p class="text-gray-500 text-center">${getTranslation('entriesPlaceholder')}</p>`;
            }
        };
        updateEntriesList();
    };

    const renderAiTipsPage = (title, placeholder, featureId) => {
        appContainer.innerHTML = `
            <div class="w-full max-w-2xl bg-white p-8 rounded-2xl shadow-xl text-center">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">${title}</h2>
                <p class="text-gray-600 mb-4">${placeholder}</p>
                <div class="flex items-center space-x-2 w-full mb-4">
                    <input id="tipInput" type="text" placeholder="${placeholder}" class="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-colors">
                    <button id="micButton" class="p-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-300">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button id="submitButton" class="p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-300">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="output-box-container mt-6">
                    <div id="tipOutput" class="output-box">
                        <p class="text-gray-500 text-center">${getTranslation('yourTipHere')}</p>
                    </div>
                </div>
            </div>
        `;
        
        const tipInput = document.getElementById('tipInput');
        const submitButton = document.getElementById('submitButton');
        const micButton = document.getElementById('micButton');
        const tipOutput = document.getElementById('tipOutput');
        
        submitButton.addEventListener('click', () => {
            if (tipInput.value.trim()) {
                const prompt = `Health tip for ${tipInput.value.trim()}`;
                getAiTipFromPrompt(prompt, 'tipOutput');
            } else {
                showMessageBox('Please enter a query.');
            }
        });
        
        micButton.addEventListener('click', () => toggleSpeechRecognition('tipInput', micButton));
    };

    const renderFoodRecipesPage = () => {
        appContainer.innerHTML = `
            <div class="w-full max-w-2xl bg-white p-8 rounded-2xl shadow-xl text-center">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">${getTranslation('foodRecipes')}</h2>
                <p class="text-gray-600 mb-4">${getTranslation('inputPlaceholderRecipes')}</p>
                <div class="flex items-center space-x-2 w-full mb-4">
                    <input id="recipeInput" type="text" placeholder="${getTranslation('inputPlaceholderRecipes')}" class="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 transition-colors">
                    <button id="micButton" class="p-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-300">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button id="getRecipeButton" class="p-3 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition-colors transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-amber-300">
                        <i class="fas fa-utensils"></i>
                    </button>
                </div>
                <div class="output-box-container mt-6">
                    <div id="recipeOutput" class="output-box">
                        <p class="text-gray-500 text-center">${getTranslation('yourTipHere')}</p>
                    </div>
                    <button id="speakTipButton" class="absolute top-2 right-2 p-2 bg-gray-200 text-gray-800 rounded-full shadow-md hover:bg-gray-300 transition-colors hidden">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>
            </div>
        `;

        const recipeInput = document.getElementById('recipeInput');
        const getRecipeButton = document.getElementById('getRecipeButton');
        const micButton = document.getElementById('micButton');
        const speakTipButton = document.getElementById('speakTipButton');
        const recipeOutput = document.getElementById('recipeOutput');

        getRecipeButton.addEventListener('click', () => {
            if (recipeInput.value.trim()) {
                getAiRecipeFromPrompt(recipeInput.value.trim(), 'recipeOutput');
            } else {
                showMessageBox('Please enter a food item or ingredients.');
            }
        });

        micButton.addEventListener('click', () => toggleSpeechRecognition('recipeInput', micButton));

        speakTipButton.addEventListener('click', () => {
            const text = recipeOutput.textContent || recipeOutput.innerText;
            if (text) {
                toggleSpeak(text, speakTipButton);
            }
        });
    };

    const renderBodyPainMapPage = () => {
        appContainer.innerHTML = `
            <div class="w-full max-w-lg bg-white p-8 rounded-2xl shadow-xl text-center">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">${getTranslation('bodyPainMap')}</h2>
                <div id="painMapContainer" class="pain-map-container mb-4">
                    ${isFrontView ? getFrontBodyMapSVG() : getBackBodyMapSVG()}
                </div>
                <div class="flex justify-center items-center space-x-4 mb-6">
                    <button id="toggleViewBtn" class="py-2 px-4 bg-gray-200 text-gray-800 rounded-full shadow-md hover:bg-gray-300 transition-colors">
                        ${isFrontView ? getTranslation('viewBack') : getTranslation('viewFront')}
                    </button>
                </div>
                <div class="output-box-container mt-6">
                    <div id="painTipOutput" class="output-box">
                        <p class="text-gray-500 text-center">${getTranslation('genericPainTip')}</p>
                    </div>
                </div>
            </div>
        `;

        const painMapContainer = document.getElementById('painMapContainer');
        const toggleViewBtn = document.getElementById('toggleViewBtn');
        const painTipOutput = document.getElementById('painTipOutput');
        
        const attachPainMapListeners = () => {
            const bodyParts = document.querySelectorAll('.body-part');
            bodyParts.forEach(part => {
                const partId = part.id;
                part.addEventListener('click', async () => {
                    const painName = painMapPartNames[partId][currentLang] || partId;
                    
                    if (painMapState[partId]) {
                        delete painMapState[partId];
                        part.classList.remove('pain');
                        painTipOutput.innerHTML = `<p class="text-gray-500 text-center">${getTranslation('genericPainTip')}</p>`;
                    } else {
                        painMapState[partId] = true;
                        part.classList.add('pain');
                        
                        const prompt = `${getTranslation('painPromptPrefix')} ${painName}.`;
                        painTipOutput.innerHTML = `<div class="loading-spinner"></div> <span class="ml-2">${getTranslation('loadingMessage')}</span>`;
                        
                        try {
                            const chatHistory = [];
                            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                            const payload = { contents: chatHistory };

                            const apiKey = "";
                            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                            const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            });

                            const result = await response.json();
                            let tipText = getTranslation('yourTipHere');
                            if (result.candidates && result.candidates.length > 0 &&
                                result.candidates[0].content && result.candidates[0].content.parts &&
                                result.candidates[0].content.parts.length > 0) {
                                tipText = result.candidates[0].content.parts[0].text;
                            } else {
                                tipText = getTranslation('noRecipe');
                            }
                            painTipOutput.innerHTML = parseTipsAsList(tipText);

                        } catch (error) {
                            console.error('Error generating AI tip for pain map:', error);
                            painTipOutput.innerHTML = `<p class="text-red-500 text-center">роЙродро╡ро┐роХрпНроХрпБро▒ро┐рокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ: ${error.message}</p>`;
                        }
                    }
                });
            });
        };

        toggleViewBtn.addEventListener('click', () => {
            isFrontView = !isFrontView;
            if (isFrontView) {
                painMapContainer.innerHTML = getFrontBodyMapSVG();
                toggleViewBtn.textContent = getTranslation('viewBack');
            } else {
                painMapContainer.innerHTML = getBackBodyMapSVG();
                toggleViewBtn.textContent = getTranslation('viewFront');
            }
            attachPainMapListeners();
        });
        
        attachPainMapListeners();
    };
    
    const renderFirstAidPage = () => {
        appContainer.innerHTML = `
            <div class="w-full max-w-lg bg-white p-8 rounded-2xl shadow-xl">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">${getTranslation('firstAid')}</h2>
                <div class="flex items-center justify-center mb-6">
                    <i class="fas fa-hand-holding-medical text-5xl text-red-600"></i>
                </div>
                <p class="text-gray-600 mb-4 text-center">${getTranslation('firstAidPrompt')}</p>
                <div class="output-box-container mt-6">
                    <div id="firstAidTipOutput" class="output-box mb-4">
                        <p class="text-gray-500 text-center">${getTranslation('emergencyTip')}</p>
                    </div>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center mt-6">${getTranslation('emergencyContacts')}</h3>
                <div id="contactsList" class="space-y-4 max-h-48 overflow-y-auto p-2 bg-gray-100 rounded-lg">
                    <p class="text-gray-500 text-center">${getTranslation('noContacts')}</p>
                </div>
                <button id="addContactButton" class="w-full py-3 mt-4 bg-red-600 text-white font-bold rounded-xl shadow-lg hover:bg-red-700 transition-colors transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-red-300">
                    <i class="fas fa-user-plus mr-2"></i> ${getTranslation('addContact')}
                </button>
            </div>
        `;
        
        const updateContactsList = () => {
            const contactsList = document.getElementById('contactsList');
            contactsList.innerHTML = '';
            if (emergencyContacts.length > 0) {
                emergencyContacts.forEach((contact, index) => {
                    const contactDiv = document.createElement('div');
                    contactDiv.className = 'p-4 bg-white rounded-lg shadow-md flex items-center justify-between';
                    contactDiv.innerHTML = `
                        <div>
                            <p class="font-bold text-lg text-gray-800">${contact.name}</p>
                            <p class="text-gray-700">${contact.number}</p>
                        </div>
                        <button class="remove-contact-btn text-red-500 hover:text-red-700 transition-colors" data-index="${index}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    `;
                    contactsList.appendChild(contactDiv);
                });

                document.querySelectorAll('.remove-contact-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.dataset.index);
                        emergencyContacts.splice(index, 1);
                        updateContactsList();
                    });
                });
            } else {
                contactsList.innerHTML = `<p class="text-gray-500 text-center">${getTranslation('noContacts')}</p>`;
            }
        };

        document.getElementById('addContactButton').addEventListener('click', () => {
            const name = prompt("родрпКроЯро░рпНрокро┐ройрпН рокрпЖропро░рпН:");
            const number = prompt("родрпКроЯро░рпНрокро┐ройрпН роОрогрпН:");
            if (name && number) {
                emergencyContacts.push({ name, number });
                updateContactsList();
            }
        });
        
        updateContactsList();
    };

    const getFrontBodyMapSVG = () => {
        return `
            <svg class="pain-map-svg" viewBox="0 0 500 800" xmlns="http://www.w3.org/2000/svg">
                <g fill="#c4a58b" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <!-- Head -->
                    <path class="body-part" id="head-front" d="M250 50 C280 50, 300 70, 300 100 C300 130, 280 150, 250 150 C220 150, 200 130, 200 100 C200 70, 220 50, 250 50 Z" />
                    <!-- Neck -->
                    <path class="body-part" id="neck-front" d="M240 150 L260 150 L260 170 L240 170 Z" />
                    <!-- Chest -->
                    <path class="body-part" id="chest-front" d="M250 170 C280 170, 300 210, 300 240 C300 270, 280 300, 250 300 C220 300, 200 270, 200 240 C200 210, 220 170, 250 170 Z" />
                    <!-- Stomach -->
                    <path class="body-part" id="stomach-front" d="M250 300 C280 300, 300 340, 300 370 C300 400, 280 430, 250 430 C220 430, 200 400, 200 370 C200 340, 220 300, 250 300 Z" />
                    <!-- Shoulders -->
                    <path class="body-part" id="shoulder-r-front" d="M300 170 C350 180, 370 200, 380 220 L370 240 L300 230 Z" />
                    <path class="body-part" id="shoulder-l-front" d="M200 170 C150 180, 130 200, 120 220 L130 240 L200 230 Z" />
                    <!-- Arms -->
                    <path class="body-part" id="arm-r-front" d="M370 240 L380 340 C390 380, 410 400, 420 420 L400 440 L350 420 L340 320 Z" />
                    <path class="body-part" id="arm-l-front" d="M130 240 L120 340 C110 380, 90 400, 80 420 L100 440 L150 420 L160 320 Z" />
                    <!-- Elbows -->
                    <circle class="body-part" id="elbow-r-front" cx="375" cy="320" r="10" />
                    <circle class="body-part" id="elbow-l-front" cx="125" cy="320" r="10" />
                    <!-- Forearms -->
                    <path class="body-part" id="forearm-r-front" d="M375 320 C380 350, 390 400, 395 440 L405 440 C410 400, 400 350, 395 320 Z" />
                    <path class="body-part" id="forearm-l-front" d="M125 320 C120 350, 110 400, 105 440 L95 440 C90 400, 100 350, 105 320 Z" />
                    <!-- Hands -->
                    <path class="body-part" id="hand-r-front" d="M395 440 L420 460 L410 480 L385 460 Z" />
                    <path class="body-part" id="hand-l-front" d="M105 440 L80 460 L90 480 L115 460 Z" />
                    <!-- Waist -->
                    <path class="body-part" id="waist-front" d="M200 430 L300 430 L310 460 C320 490, 280 500, 250 500 C220 500, 180 490, 190 460 Z" />
                    <!-- Thighs -->
                    <path class="body-part" id="thigh-r-front" d="M250 500 L280 500 C300 520, 310 560, 300 600 C290 640, 270 660, 250 660 L250 500 Z" />
                    <path class="body-part" id="thigh-l-front" d="M250 500 L220 500 C200 520, 190 560, 200 600 C210 640, 230 660, 250 660 L250 500 Z" />
                    <!-- Knees -->
                    <circle class="body-part" id="knee-r-front" cx="280" cy="620" r="10" />
                    <circle class="body-part" id="knee-l-front" cx="220" cy="620" r="10" />
                    <!-- Shins -->
                    <path class="body-part" id="shin-r-front" d="M280 620 L280 720 C280 740, 270 760, 260 760 L250 720 L250 620 Z" />
                    <path class="body-part" id="shin-l-front" d="M220 620 L220 720 C220 740, 230 760, 240 760 L250 720 L250 620 Z" />
                    <!-- Ankles -->
                    <circle class="body-part" id="ankle-r-front" cx="260" cy="760" r="10" />
                    <circle class="body-part" id="ankle-l-front" cx="240" cy="760" r="10" />
                    <!-- Feet -->
                    <path class="body-part" id="foot-r-front" d="M260 760 L280 780 L250 780 Z" />
                    <path class="body-part" id="foot-l-front" d="M240 760 L220 780 L250 780 Z" />
                </g>
            </svg>
        `;
    };

    const getBackBodyMapSVG = () => {
        return `
            <svg class="pain-map-svg" viewBox="0 0 500 800" xmlns="http://www.w3.org/2000/svg">
                <g fill="#c4a58b" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <!-- Head -->
                    <path class="body-part" id="head-back" d="M250 50 C280 50, 300 70, 300 100 C300 130, 280 150, 250 150 C220 150, 200 130, 200 100 C200 70, 220 50, 250 50 Z" />
                    <!-- Neck -->
                    <path class="body-part" id="neck-back" d="M240 150 L260 150 L260 170 L240 170 Z" />
                    <!-- Back -->
                    <path class="body-part" id="back-back" d="M250 170 C280 170, 300 210, 300 240 L300 400 C300 430, 280 460, 250 460 C220 460, 200 430, 200 400 L200 240 C200 210, 220 170, 250 170 Z" />
                    <!-- Shoulders -->
                    <path class="body-part" id="shoulder-r-back" d="M300 170 C350 180, 370 200, 380 220 L370 240 L300 230 Z" />
                    <path class="body-part" id="shoulder-l-back" d="M200 170 C150 180, 130 200, 120 220 L130 240 L200 230 Z" />
                    <!-- Arms -->
                    <path class="body-part" id="arm-r-back" d="M370 240 L380 340 C390 380, 410 400, 420 420 L400 440 L350 420 L340 320 Z" />
                    <path class="body-part" id="arm-l-back" d="M130 240 L120 340 C110 380, 90 400, 80 420 L100 440 L150 420 L160 320 Z" />
                    <!-- Elbows -->
                    <circle class="body-part" id="elbow-r-back" cx="375" cy="320" r="10" />
                    <circle class="body-part" id="elbow-l-back" cx="125" cy="320" r="10" />
                    <!-- Forearms -->
                    <path class="body-part" id="forearm-r-back" d="M375 320 C380 350, 390 400, 395 440 L405 440 C410 400, 400 350, 395 320 Z" />
                    <path class="body-part" id="forearm-l-back" d="M125 320 C120 350, 110 400, 105 440 L95 440 C90 400, 100 350, 105 320 Z" />
                    <!-- Hands -->
                    <path class="body-part" id="hand-r-back" d="M395 440 L420 460 L410 480 L385 460 Z" />
                    <path class="body-part" id="hand-l-back" d="M105 440 L80 460 L90 480 L115 460 Z" />
                    <!-- Buttocks -->
                    <path class="body-part" id="buttocks-back" d="M250 460 C280 460, 300 490, 300 520 C300 550, 280 580, 250 580 C220 580, 200 550, 200 520 C200 490, 220 460, 250 460 Z" />
                    <!-- Thighs -->
                    <path class="body-part" id="thigh-r-back" d="M250 580 L280 580 C300 600, 310 640, 300 680 C290 720, 270 740, 250 740 L250 580 Z" />
                    <path class="body-part" id="thigh-l-back" d="M250 580 L220 580 C200 600, 190 640, 200 680 C210 720, 230 740, 250 740 L250 580 Z" />
                    <!-- Knees -->
                    <circle class="body-part" id="knee-r-back" cx="280" cy="700" r="10" />
                    <circle class="body-part" id="knee-l-back" cx="220" cy="700" r="10" />
                    <!-- Calves -->
                    <path class="body-part" id="calf-r-back" d="M280 700 L280 800 C280 820, 270 840, 260 840 L250 800 L250 700 Z" />
                    <path class="body-part" id="calf-l-back" d="M220 700 L220 800 C220 820, 230 840, 240 840 L250 800 L250 700 Z" />
                    <!-- Ankles -->
                    <circle class="body-part" id="ankle-r-back" cx="260" cy="840" r="10" />
                    <circle class="body-part" id="ankle-l-back" cx="240" cy="840" r="10" />
                    <!-- Feet -->
                    <path class="body-part" id="foot-r-back" d="M260 840 L280 860 L250 860 Z" />
                    <path class="body-part" id="foot-l-back" d="M240 840 L220 860 L250 860 Z" />
                </g>
            </svg>
        `;
    };
    
    // Initial render
    render();
</script>

</body>
</html>
