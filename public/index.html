<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ஆரோக்கிய நண்பன் - உங்கள் ஆரோக்கிய வழிகாட்டி</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #E6F7FF; /* Light Blue */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1.5rem;
            color: #333333;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            box-sizing: border-box;
            transition: all 0.5s ease-in-out;
            overflow-y: auto; /* Allow scrolling for features */
        }

        body.main-content-active {
            min-height: auto;
            align-items: flex-start;
            padding-top: 2rem;
            padding-bottom: 2rem;
            overflow-y: auto;
        }

        .container {
            max-width: 640px;
            width: 100%;
            background-color: #ffffff;
            border-radius: 1.75rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
            padding: 2.5rem;
            text-align: center;
            position: relative;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .language-selector-wrapper {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
        }
        .input-wrapper {
            position: relative;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }
        .input-field {
            flex-grow: 1;
            padding: 1rem 1.25rem;
            padding-right: 3.5rem; /* Space for mic icon */
            border: 1px solid #D1D5DB;
            border-radius: 0.875rem;
            font-size: 1.05rem;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .input-field:focus {
            border-color: #87CEEB;
            box-shadow: 0 0 0 3px rgba(135, 206, 235, 0.4);
        }
        .mic-button {
            position: absolute;
            right: 1rem;
            background: none;
            border: none;
            color: #0000FF;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: color 0.3s ease, background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .mic-button:hover {
            color: #DC2626; /* Red */
            background-color: rgba(220, 38, 38, 0.1);
        }
        .mic-button.recording {
            color: #DC2626; /* Red */
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.1); opacity: 0.7); }
        }

        .generate-button, .action-button, .open-tracker-button, .ai-voice-button {
            background-color: #6A0DAD; /* Dark Violet */
            color: #ffffff;
            padding: 1rem 2rem;
            border-radius: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 15px rgba(106, 13, 173, 0.4);
            letter-spacing: 0.025em;
            margin-top: 1rem;
            border: none;
            display: inline-flex; /* Ensure flex behavior for centering icon/text */
            align-items: center;
            justify-content: center;
            gap: 0.5rem; /* Space between icon and text */
        }
        .generate-button:hover, .action-button:hover, .open-tracker-button:hover, .ai-voice-button:hover {
            background-color: #4B0A7B; /* Darker Violet */
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(106, 13, 173, 0.5);
        }
        .generate-button:active, .action-button:active, .open-tracker-button:active, .ai-voice-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 10px rgba(106, 13, 173, 0.3);
        }
        .loading-indicator {
            display: none;
            margin-top: 2rem;
            font-size: 1.15rem;
            color: #6B7280;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #6A0DAD;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tip-box, .result-box { /* Unified style for all output boxes */
            background-color: #FFFFAA; /* Light Yellow */
            border: 1px solid #CCCC88; /* Darker Yellow */
            border-radius: 1.25rem;
            padding: 2rem;
            margin-top: 2rem;
            text-align: left;
            color: #333333;
            line-height: 1.7;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            font-size: 1.05rem;
            transition: all 0.5s ease-in-out;
            word-break: break-word; /* Ensure long words break */
        }
        .tip-box p, .result-box p {
            margin: 0;
        }
        .text-red-600 {
            color: #DC2626; /* Red */
        }
        /* Responsive adjustments */
        @media (max-width: 640px) {
            body {
                padding: 1rem;
            }
            .container {
                padding: 1.5rem;
                border-radius: 1.25rem;
            }
            .generate-button, .action-button, .open-tracker-button, .ai-voice-button {
                width: 100%;
                padding: 0.9rem 1.5rem;
            }
            .flex.flex-wrap.justify-center.gap-4 {
                flex-direction: column;
                gap: 0.75rem;
            }
            .language-selector-wrapper {
                top: 0.75rem;
                right: 0.75rem;
            }
            .input-wrapper {
                flex-direction: row;
                justify-content: center;
            }
            .mic-button {
                position: absolute;
                right: 0.5rem;
            }
        }
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #E6F7FF;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 1s ease-out;
            overflow: hidden;
        }
        .splash-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        .splash-screen img {
            max-width: 25%;
            max-height: 25%;
            object-fit: contain;
        }

        /* Feature Button for Main Page */
        .features-toggle-button {
            font-size: 4rem; /* Even larger emoji size for the main toggle */
            cursor: pointer;
            padding: 1rem;
            border-radius: 1rem;
            transition: transform 0.3s ease, background-color 0.3s ease;
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            line-height: 1;
            margin-top: 2rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            background-color: #e0f2fe; /* Light blue background */
        }
        .features-toggle-button:hover {
            transform: scale(1.05);
            background-color: #bee3f8; /* Slightly darker blue hover */
        }
        .features-toggle-button span.label {
            font-size: 1rem;
            margin-top: 0.75rem;
            color: #333;
            font-weight: 600;
        }

        /* Feature Icons and Sections */
        .feature-icon-container {
            display: flex;
            justify-content: center;
            gap: 1.5rem; /* Space between icons */
            margin-top: 2rem;
            flex-wrap: wrap; /* Allow icons to wrap on smaller screens */
        }
        .feature-icon {
            font-size: 3rem; /* Larger emoji size */
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.75rem;
            transition: transform 0.2s ease, background-color 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            line-height: 1;
        }
        .feature-icon:hover {
            transform: translateY(-5px);
            background-color: rgba(135, 206, 235, 0.1); /* Light blue hover */
        }
        .feature-icon span.label {
            font-size: 0.8rem; /* Smaller text label */
            margin-top: 0.5rem;
            color: #555;
            font-weight: 500;
        }

        /* Feature sections (initially hidden, shown by JS) */
        .feature-section {
            display: none;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb; /* Subtle separator */
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Specific feature section styles */
        .dropdown-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #D1D5DB;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            text-align: left;
            padding: 0.5rem 0;
            top: calc(100% + 5px); /* Position below input */
            left: 0;
        }
        .dropdown-menu div {
            padding: 0.75rem 1.25rem;
            cursor: pointer;
        }
        .dropdown-menu div:hover {
            background-color: #F3F4F6;
        }
        .dropdown-menu div.selected {
            background-color: #e0f2fe; /* light blue */
            font-weight: 500;
        }
        
        .tts-voice-selector {
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.875rem;
            font-size: 0.95rem;
            background-color: white;
            margin-left: 1rem;
            flex-grow: 1;
        }
        .body-map-container {
            position: relative;
            width: 100%;
            max-width: 300px; /* Adjust as needed */
            margin: 0 auto;
            border: 1px solid #ccc;
            border-radius: 10px;
            overflow: hidden;
        }
        .body-map-image {
            width: 100%;
            height: auto;
            display: block;
        }
        .pain-dot {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: red;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            transform: translate(-50%, -50%); /* Center the dot on the click */
        }
        .pain-dot.selected {
            background-color: darkred;
            border: 2px solid yellow;
        }
        /* Hide all feature sections by default */
        .feature-section {
            display: none;
        }
        /* Show the main view or a specific section */
        #initialView, #allFeatureIconsContainer.active, .feature-section.active {
            display: block;
        }
        .back-button {
            background: none;
            border: none;
            color: #6A0DAD;
            font-weight: 600;
            cursor: pointer;
            padding: 0.5rem 0;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 1rem;
            transition: color 0.3s ease;
        }
        .back-button:hover {
            color: #4B0A7B;
        }

        /* Alarm Modal Styles */
        .alarm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .alarm-modal.show {
            opacity: 1;
            visibility: visible;
        }
        .alarm-modal-content {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 1.5rem;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            width: 90%;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }
        .alarm-modal.show .alarm-modal-content {
            transform: translateY(0);
        }
        .alarm-modal-content h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #6A0DAD;
            margin-bottom: 1rem;
        }
        .alarm-modal-content p {
            font-size: 1.1rem;
            color: #555;
            margin-bottom: 1.5rem;
        }
        .alarm-modal-content button {
            background-color: #6A0DAD;
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border: none;
        }
        .alarm-modal-content button:hover {
            background-color: #4B0A7B;
        }
    </style>
</head>
<body>
    <div id="splashScreen" class="splash-screen">
        <img src="https://placehold.co/150x150/E6F7FF/000000?text=Healthcare+Logo" alt="Healthcare related image">
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <div class="language-selector-wrapper">
            <select id="languageSelect" aria-label="Select Language" class="p-2 border border-gray-300 rounded-md text-sm bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300">
                <option value="ta">தமிழ்</option>
                <option value="en">English</option>
            </select>
        </div>

        <div id="initialView">
            <h1 id="mainTitle" class="text-3xl font-bold text-gray-800 mb-4 lg:text-4xl"></h1>
            <p id="descriptionText" class="text-gray-600 mb-8 text-lg"></p>

            <h2 id="tipSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <div class="input-wrapper">
                <input type="text" id="goalInput" class="input-field" aria-label="உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும்">
                <button id="micBtn" class="mic-button" title="உங்கள் இலக்கைப் பேசுங்கள்" aria-label="உங்கள் ஆரோக்கிய இலக்கைப் பதிவு செய்யவும்">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                </button>
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-4">
                <button id="generateBtn" class="generate-button">✨ <span data-label-key="generateBtn"></span></button>
                <button id="aiVoiceBtn" class="ai-voice-button" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
                <select id="ttsVoiceSelect" class="tts-voice-selector" style="display: none;" aria-label="Select Voice"></select>
            </div>
            <div id="loading" class="loading-indicator" aria-live="polite">
                <div class="loading-spinner"></div>
                <p id="loadingText"></p>
            </div>
            <div id="tipOutput" class="tip-box" aria-live="polite"></div>

            <hr class="border-t border-gray-300 my-8">

            <h2 id="featuresTitle" class="text-2xl font-semibold text-gray-700 mb-4"></h2>
            <button id="toggleFeaturesBtn" class="features-toggle-button" title="அனைத்து அம்சங்களையும் காண்க">
                ✨<span class="label" data-label-key="showFeaturesLabel"></span>
            </button>
        </div>

        <div id="featuresContainer" style="display: none;">
            <button class="back-button" id="backToMainFromFeaturesContainer" style="display: none;">← பின்செல்</button>
            <h1 id="featuresPageTitle" class="text-3xl font-bold text-gray-800 mb-6 mt-4 lg:text-4xl"></h1>

            <div id="allFeatureIconsContainer" class="feature-icon-container">
                <div id="iconStepTracker" class="feature-icon" data-section="stepTrackerSection" title="படி டிராக்கர்">👟<span class="label" data-label-key="stepTrackerLabel"></span></div>
                <div id="iconHeartRateTracker" class="feature-icon" data-section="heartRateTrackerSection" title="இதயத் துடிப்பு டிராக்கர்">💓<span class="label" data-label-key="heartRateTrackerLabel"></span></div>
                <div id="iconWaterTracker" class="feature-icon" data-section="waterTrackerSection" title="தண்ணீர் டிராக்கர்">💧<span class="label" data-label-key="waterTrackerLabel"></span></div>
                <div id="iconJournal" class="feature-icon" data-section="journalSection" title="மனநிலை & நன்றியுணர்வு ஜர்னல்">📝<span class="label" data-label-key="journalLabel"></span></div>
                <div id="iconLocalTips" class="feature-icon" data-section="localTipsSection" title="உள்ளூர் ஆரோக்கிய குறிப்புகள்">🌱<span class="label" data-label-key="localTipsLabel"></span></div>
                <div id="iconMealPlan" class="feature-icon" data-section="mealPlanSection" title="உணவுத் திட்டப் பரிந்துரைகள்">🍽️<span class="label" data-label-key="mealPlanLabel"></span></div>
                <div id="iconMoodAnalysis" class="feature-icon" data-section="moodAnalysisSection" title="உணர்வுப் பதிவேடு பகுப்பாய்வு">🧠<span class="label" data-label-key="moodAnalysisLabel"></span></div>
                <div id="iconExerciseYoga" class="feature-icon" data-section="exerciseYogaSection" title="உடற்பயிற்சி & யோகா">🤸‍♀️<span class="label" data-label-key="exerciseYogaLabel"></span></div>
                <div id="iconDiseasePrevention" class="feature-icon" data-section="diseasePreventionSection" title="நோய் தடுப்பு">🛡️<span class="label" data-label-key="diseasePreventionLabel"></span></div>
                <div id="iconWellnessChallenge" class="feature-icon" data-section="wellnessChallengeSection" title="ஆரோக்கிய சவால்கள்">🏅<span class="label" data-label-key="wellnessChallengeLabel"></span></div>
                <div id="iconMedicationReminder" class="feature-icon" data-section="medicationReminderSection" title="மருந்து நினைவூட்டல்">⏰<span class="label" data-label-key="medicationReminderLabel"></span></div>
                <div id="iconBodyPainMapping" class="feature-icon" data-section="bodyPainMappingSection" title="உடல் வலி மேப்பிங்">📍<span class="label" data-label-key="bodyPainMappingLabel"></span></div>
                <div id="iconFirstAidEmergency" class="feature-icon" data-section="firstAidEmergencySection" title="முதலுதவி & அவசர உதவி">🆘<span class="label" data-label-key="firstAidEmergencyLabel"></span></div>
            </div>

            <div id="stepTrackerSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="stepSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <div class="input-wrapper">
                    <label for="currentStepsDisplay" class="sr-only">தற்போதைய படிகள்</label>
                    <input type="text" id="currentStepsDisplay" class="input-field" value="0" readonly aria-atomic="true">
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="addOneStepBtn" class="action-button"></button>
                    <button id="toggleTrackingBtn" class="action-button"></button>
                    <button id="resetStepsBtn" class="action-button"></button>
                </div>
                <div id="stepResultOutput" class="result-box" aria-live="polite"></div>
                <div id="stepTipOutput" class="tip-box" aria-live="polite"></div> </div>

            <div id="heartRateTrackerSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="heartRateSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <div class="input-wrapper">
                    <label for="currentHeartRateDisplay" class="sr-only">தற்போதைய இதயத் துடிப்பு</label>
                    <input type="text" id="currentHeartRateDisplay" class="input-field" value="0" readonly aria-atomic="true">
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="simulateHeartRateBtn" class="action-button"></button>
                    <button id="resetHeartRateBtn" class="action-button"></button>
                </div>
                <div id="heartRateResultOutput" class="result-box" aria-live="polite"></div>
                <div id="heartRateTipOutput" class="tip-box" aria-live="polite"></div> </div>

            <div id="waterTrackerSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="waterSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <div class="input-wrapper">
                    <label for="waterIntakeDisplay" class="sr-only">தற்போதைய தண்ணீர் உட்கொள்ளல்</label>
                    <input type="text" id="waterIntakeDisplay" class="input-field" value="0 ml" readonly aria-atomic="true">
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <button id="addWaterBtn" class="action-button"></button>
                    <button id="resetWaterBtn" class="action-button"></button>
                </div>
                <div id="waterResultOutput" class="result-box" aria-live="polite"></div>
                <div id="waterTipOutput" class="tip-box" aria-live="polite"></div> </div>

            <div id="journalSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="journalSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="journalDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="moodSelect" class="sr-only">உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்</label>
                    <select id="moodSelect" class="input-field mb-4" aria-label="உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்">
                        <option value="">உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்</option>
                        <option value="happy">மகிழ்ச்சி 😄</option>
                        <option value="neutral">சாதாரணம் 😐</option>
                        <option value="sad">சோகம் 😔</option>
                        <option value="stressed">மன அழுத்தம் 😩</option>
                        <option value="energetic">ஆற்றல் 💪</option>
                    </select>
                    <label for="gratitudeInput" class="sr-only">நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்</label>
                    <textarea id="gratitudeInput" class="input-field min-h-[100px]" placeholder="நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்..." aria-label="நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்"></textarea>
                </div>
                <button id="saveJournalEntryBtn" class="action-button mt-4"></button>
                <div id="journalEntriesOutput" class="result-box mt-4 text-left"></div>
                <button id="analyzeMoodJournalBtn" class="action-button mt-4">✨ <span data-label-key="analyzeMoodJournalBtn"></span></button>
                <div id="moodAnalysisOutput" class="result-box mt-4 text-left" aria-live="polite"></div>
            </div>

            <div id="localTipsSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="localTipsSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="localTipsDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper mb-4">
                    <input type="text" id="localTipCategory" class="input-field" aria-label="உதவிக்குறிப்பு வகையை உள்ளிடவும்" placeholder="எ.கா. மஞ்சள், முருங்கை, தியானம்...">
                    <button id="localTipMicBtn" class="mic-button" title="உதவிக்குறிப்பு வகையை பேசவும்" aria-label="உதவிக்குறிப்பு வகையைப் பதிவு செய்யவும்">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                    <div id="localTipCategoryDropdown" class="dropdown-menu hidden mt-2 top-full left-0"></div>
                </div>
                <button id="getLocalTipBtn" class="generate-button">✨ <span data-label-key="getLocalTipBtn"></span></button>
                <div id="localTipOutput" class="tip-box" aria-live="polite"></div>
                <button id="localTipAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
            </div>

            <div id="mealPlanSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="mealPlanSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="mealPlanDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="dietGoalInput" class="sr-only">உணவு இலக்கு</label>
                    <div class="input-wrapper mb-4"> <input type="text" id="dietGoalInput" class="input-field" placeholder="எ.கா. எடை குறைப்பு, தசை வளர்ச்சி..." aria-label="உணவு இலக்கு">
                        <button id="dietGoalMicBtn" class="mic-button" title="உணவு இலக்கைப் பேசவும்" aria-label="உணவு இலக்கைப் பதிவு செய்யவும்">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </button>
                    </div>

                    <label for="dietPreferenceSelect" class="sr-only">உணவு விருப்பம்</label>
                    <select id="dietPreferenceSelect" class="input-field mb-4" aria-label="உணவு விருப்பம்">
                        <option value="">உணவு விருப்பத்தைத் தேர்ந்தெடுக்கவும்</option>
                        <option value="vegetarian">சைவம்</option>
                        <option value="non-vegetarian">அசைவம்</option>
                        <option value="vegan">முழு சைவம்</option>
                    </select>

                    <label for="allergiesInput" class="sr-only">ஒவ்வாமைகள் (இருப்பின்)</label>
                    <div class="input-wrapper mb-4"> <input type="text" id="allergiesInput" class="input-field" placeholder="எ.கா. நிலக்கடலை, பால்..." aria-label="ஒவ்வாமைகள்">
                        <button id="allergiesMicBtn" class="mic-button" title="ஒவ்வாமைகளைப் பேசவும்" aria-label="ஒவ்வாமைகளைப் பதிவு செய்யவும்">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                <button id="generateMealPlanBtn" class="generate-button">✨ <span data-label-key="generateMealPlanBtn"></span></button>
                <div id="mealPlanOutput" class="tip-box" aria-live="polite"></div>
                <button id="mealPlanAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
            </div>

            <div id="moodAnalysisSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="moodAnalysisSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="moodAnalysisDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch">
                    <label for="moodEntryInput" class="sr-only">உங்கள் மனநிலை பற்றி எழுதுங்கள்</label>
                    <textarea id="moodEntryInput" class="input-field min-h-[100px]" placeholder="உங்கள் மனநிலை பற்றி எழுதுங்கள்..." aria-label="உங்கள் மனநிலை பற்றி எழுதுங்கள்"></textarea>
                </div>
                <button id="analyzeMoodBtn" class="generate-button">✨ <span data-label-key="analyzeMoodBtn"></span></button>
                <div id="moodAnalysisOutputDetailed" class="tip-box" aria-live="polite"></div>
                <button id="moodAnalysisAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
            </div>

            <div id="exerciseYogaSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="exerciseYogaSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="exerciseYogaDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper mb-4">
                    <input type="text" id="exerciseGoalInput" class="input-field" aria-label="உங்கள் உடற்பயிற்சி/யோகா இலக்கை உள்ளிடவும்" placeholder="எ.கா. நெகிழ்வுத்தன்மை, வலிமை...">
                    <button id="exerciseGoalMicBtn" class="mic-button" title="உங்கள் இலக்கைப் பேசவும்" aria-label="உங்கள் இலக்கைப் பதிவு செய்யவும்">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                </div>
                <button id="generateExercisePlanBtn" class="generate-button">✨ <span data-label-key="generateExercisePlanBtn"></span></button>
                <div id="exerciseYogaOutput" class="tip-box" aria-live="polite"></div>
                <button id="exerciseYogaAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
            </div>

            <div id="diseasePreventionSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="diseasePreventionSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="diseasePreventionDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper mb-4">
                    <input type="text" id="diseaseInput" class="input-field" aria-label="நோய் அல்லது தடுப்பு குறிப்பை உள்ளிடவும்" placeholder="எ.கா. நீரிழிவு, சளி...">
                    <button id="diseaseMicBtn" class="mic-button" title="நோய்/தடுப்பு குறிப்பை பேசவும்" aria-label="நோய்/தடுப்பு குறிப்பை பதிவு செய்யவும்">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                </div>
                <button id="generatePreventionTipsBtn" class="generate-button">✨ <span data-label-key="generatePreventionTipsBtn"></span></button>
                <div id="diseasePreventionOutput" class="tip-box" aria-live="polite"></div>
                <button id="diseasePreventionAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
            </div>

            <div id="wellnessChallengeSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="wellnessChallengeSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="wellnessChallengeDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper mb-4">
                    <input type="text" id="challengeTypeInput" class="input-field" aria-label="சவால் வகையை உள்ளிடவும்" placeholder="எ.கா. 30 நாள் தண்ணீர் சவால்...">
                    <button id="challengeTypeMicBtn" class="mic-button" title="சவால் வகையை பேசவும்" aria-label="சவால் வகையை பதிவு செய்யவும்">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                </div>
                <button id="generateChallengeBtn" class="generate-button">✨ <span data-label-key="generateChallengeBtn"></span></button>
                <div id="wellnessChallengeOutput" class="tip-box" aria-live="polite"></div>
                <button id="wellnessChallengeAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
            </div>

            <div id="medicationReminderSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="medicationReminderSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="medicationReminderDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper flex-col items-stretch mb-4">
                    <label for="medicationNameInput" class="sr-only">மருந்தின் பெயர்</label>
                    <input type="text" id="medicationNameInput" class="input-field mb-4" placeholder="மருந்தின் பெயர்" aria-label="மருந்தின் பெயர்">
                    
                    <label for="medicationTimeInput" class="sr-only">நேரம் (HH:MM)</label>
                    <input type="time" id="medicationTimeInput" class="input-field mb-4" aria-label="நேரம் (HH:MM)">
                </div>
                <button id="addMedicationReminderBtn" class="action-button"></button>
                <ul id="medicationRemindersList" class="list-disc list-inside text-left text-gray-700 mt-4 result-box"></ul>
            </div>

            <div id="bodyPainMappingSection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="bodyPainMappingSectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="bodyPainMappingDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="body-map-container">
                    <img src="https://via.placeholder.com/300x500?text=Body+Map" alt="Human Body Map" class="body-map-image" id="bodyMapImage">
                    <div id="painDotsContainer"></div>
                </div>
                <div class="input-wrapper mt-4">
                    <input type="text" id="painDescriptionInput" class="input-field" placeholder="வலி விளக்கம்" aria-label="வலி விளக்கம்">
                </div>
                <button id="addPainEntryBtn" class="action-button mt-4"></button>
                <ul id="painEntriesList" class="list-disc list-inside text-left text-gray-700 mt-4 result-box"></ul>
                <button id="analyzePainEntriesBtn" class="action-button mt-4">✨ <span data-label-key="analyzePainEntriesBtn"></span></button>
                <div id="painAnalysisOutput" class="tip-box" aria-live="polite"></div>
                <button id="painAnalysisAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
            </div>

            <div id="firstAidEmergencySection" class="feature-section">
                <button class="back-button" data-target="allFeatureIconsContainer">← பின்செல்</button>
                <h2 id="firstAidEmergencySectionTitle" class="text-2xl font-semibold text-gray-700 mb-4 mt-4"></h2>
                <p id="firstAidEmergencyDescription" class="text-gray-600 mb-4 text-lg"></p>
                <div class="input-wrapper mb-4">
                    <input type="text" id="emergencyInput" class="input-field" aria-label="அவசர நிலை அல்லது முதலுதவி தலைப்பை உள்ளிடவும்" placeholder="எ.கா. காயம், மூச்சுத் திணறல்...">
                    <button id="emergencyMicBtn" class="mic-button" title="அவசர நிலை அல்லது முதலுதவி தலைப்பை பேசவும்" aria-label="அவசர நிலை அல்லது முதலுதவி தலைப்பை பதிவு செய்யவும்">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                </div>
                <button id="getEmergencyInfoBtn" class="generate-button">✨ <span data-label-key="getEmergencyInfoBtn"></span></button>
                <div id="emergencyInfoOutput" class="tip-box" aria-live="polite"></div>
                <button id="emergencyInfoAiVoiceBtn" class="ai-voice-button mt-4" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <div id="alarmModal" class="alarm-modal">
        <div class="alarm-modal-content">
            <h3 id="alarmModalTitle">Alarm!</h3>
            <p id="alarmModalMessage"></p>
            <button id="dismissAlarmBtn">Dismiss</button>
        </div>
    </div>

    <script>
        // Language translation object
        const translations = {
            'ta': {
                mainTitle: "ஆரோக்கிய நண்பன் - உங்கள் ஆரோக்கிய வழிகாட்டி",
                descriptionText: "உங்கள் ஆரோக்கிய இலக்குகளை அடைய உங்களுக்கு உதவ நான் இங்கு இருக்கிறேன். ஒரு ஆரோக்கிய உதவிக்குறிப்பைப் பெற உங்கள் இலக்கை உள்ளிடவும் அல்லது அம்சங்களை ஆராயவும்.",
                tipSectionTitle: "உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும்",
                generateBtn: "உதவிக்குறிப்பைப் பெறுங்கள்",
                aiVoiceBtn: "AI குரல்",
                loadingText: "ஆரோக்கிய உதவிக்குறிப்பை உருவாக்குகிறது...",
                showFeaturesLabel: "அம்சங்களைக் காண்க",
                featuresPageTitle: "எங்கள் அம்சங்களை ஆராயுங்கள்",

                // Feature labels
                stepTrackerLabel: "படி டிராக்கர்",
                heartRateTrackerLabel: "இதயத் துடிப்பு",
                waterTrackerLabel: "தண்ணீர் டிராக்கர்",
                journalLabel: "மனநிலை & நன்றியுணர்வு ஜர்னல்",
                localTipsLabel: "உள்ளூர் குறிப்புகள்",
                mealPlanLabel: "உணவுத் திட்டம்",
                moodAnalysisLabel: "மனநிலை பகுப்பாய்வு",
                exerciseYogaLabel: "உடற்பயிற்சி & யோகா",
                diseasePreventionLabel: "நோய் தடுப்பு",
                wellnessChallengeLabel: "ஆரோக்கிய சவால்கள்",
                medicationReminderLabel: "மருந்து நினைவூட்டல்",
                bodyPainMappingLabel: "உடல் வலி மேப்பிங்",
                firstAidEmergencyLabel: "முதலுதவி & அவசர உதவி",

                // Step Tracker
                stepSectionTitle: "படி டிராக்கர்",
                addOneStepBtn: "ஒரு படி சேர்",
                toggleTrackingBtn: "டிராக்கிங்கை தொடங்கு/நிறுத்து",
                resetStepsBtn: "படிகளை மீட்டமை",
                stepResultOutputDefault: "உங்கள் படிகள் இங்கே காண்பிக்கப்படும்.",
                stepTipOutputDefault: "நிறைய நடப்பது உங்கள் ஆரோக்கியத்திற்கு நல்லது! 💪",


                // Heart Rate Tracker
                heartRateSectionTitle: "இதயத் துடிப்பு டிராக்கர்",
                simulateHeartRateBtn: "இதயத் துடிப்பை உருவகப்படுத்து",
                resetHeartRateBtn: "மீட்டமை",
                heartRateResultOutputDefault: "உங்கள் இதயத் துடிப்பு இங்கே காண்பிக்கப்படும்.",
                heartRateTipOutputDefault: "ஒரு சீரான இதயத் துடிப்பு ஆரோக்கியமான வாழ்க்கையின் அறிகுறியாகும். ❤️",

                // Water Tracker
                waterSectionTitle: "தண்ணீர் உட்கொள்ளல் டிராக்கர்",
                addWaterBtn: "200 மிலி தண்ணீர் சேர்",
                resetWaterBtn: "மீட்டமை",
                waterResultOutputDefault: "உங்கள் தண்ணீர் உட்கொள்ளல் இங்கே காண்பிக்கப்படும்.",
                waterTipOutputDefault: "நாள் முழுவதும் hydrated ஆக இருங்கள்! 💧",

                // Journal
                journalSectionTitle: "மனநிலை & நன்றியுணர்வு ஜர்னல்",
                journalDescription: "உங்கள் மனநிலையையும், நீங்கள் நன்றியுள்ள விஷயங்களையும் பதிவு செய்யுங்கள். இது உங்கள் உணர்ச்சிகளைக் கண்காணிக்கவும், நேர்மறையை வளர்க்கவும் உதவும்.",
                saveJournalEntryBtn: "பதிவை சேமி",
                analyzeMoodJournalBtn: "மனநிலையை பகுப்பாய்வு செய்",
                journalEntriesOutputDefault: "உங்கள் ஜர்னல் பதிவுகள் இங்கே காண்பிக்கப்படும்.",
                moodAnalysisOutputDefault: "உங்கள் மனநிலை பகுப்பாய்வு இங்கே காண்பிக்கப்படும்.",

                // Local Tips
                localTipsSectionTitle: "உள்ளூர் ஆரோக்கிய குறிப்புகள்",
                localTipsDescription: "உங்கள் உள்ளூர் இயற்கை வளங்கள் மற்றும் பாரம்பரிய நடைமுறைகள் தொடர்பான ஆரோக்கிய குறிப்புகளைப் பெறுங்கள்.",
                getLocalTipBtn: "உதவிக்குறிப்பைப் பெறுங்கள்",

                // Meal Plan
                mealPlanSectionTitle: "உணவுத் திட்டப் பரிந்துரைகள்",
                mealPlanDescription: "உங்கள் உணவு இலக்குகள், விருப்பங்கள் மற்றும் ஒவ்வாமைகளின் அடிப்படையில் தனிப்பயனாக்கப்பட்ட உணவுத் திட்டங்களைப் பெறுங்கள்.",
                generateMealPlanBtn: "உணவுத் திட்டத்தை உருவாக்கு",

                // Mood Analysis (detailed)
                moodAnalysisSectionTitle: "உணர்வுப் பதிவேடு பகுப்பாய்வு",
                moodAnalysisDescription: "உங்கள் மனநிலை பற்றிய விரிவான பதிவை எழுதுங்கள், நாங்கள் அதை பகுப்பாய்வு செய்து நுண்ணறிவுகளை வழங்குவோம்.",
                analyzeMoodBtn: "மனநிலையை பகுப்பாய்வு செய்",

                // Exercise & Yoga
                exerciseYogaSectionTitle: "உடற்பயிற்சி & யோகா",
                exerciseYogaDescription: "உங்கள் இலக்குகளுக்கு ஏற்ப உடற்பயிற்சி அல்லது யோகா நடைமுறைகளுக்கான பரிந்துரைகளைப் பெறுங்கள்.",
                generateExercisePlanBtn: "திட்டத்தை உருவாக்கு",

                // Disease Prevention
                diseasePreventionSectionTitle: "நோய் தடுப்பு",
                diseasePreventionDescription: "பொதுவான நோய்கள் மற்றும் அவற்றை எவ்வாறு தடுப்பது என்பது பற்றிய தகவல்களைப் பெறுங்கள்.",
                generatePreventionTipsBtn: "தடுப்பு குறிப்புகளைப் பெறுங்கள்",

                // Wellness Challenges
                wellnessChallengeSectionTitle: "ஆரோக்கிய சவால்கள்",
                wellnessChallengeDescription: "பல்வேறு ஆரோக்கிய சவால்களில் பங்கேற்று உங்கள் ஆரோக்கிய பயணத்தில் உத்வேகம் பெறுங்கள்.",
                generateChallengeBtn: "சவாலை உருவாக்கு",

                // Medication Reminder
                medicationReminderSectionTitle: "மருந்து நினைவூட்டல்",
                medicationReminderDescription: "உங்கள் மருந்து நேரங்களை நிர்வகிக்க நினைவூட்டல்களை அமைக்கவும்.",
                addMedicationReminderBtn: "நினைவூட்டலை சேர்",
                noReminders: "நினைவூட்டல்கள் எதுவும் இல்லை.",
                alarmModalTitle: "மருந்து நேரம்!",
                alarmModalMessage: "உங்கள் மருந்தை எடுத்துக் கொள்ள வேண்டிய நேரம்!",
                dismissAlarmBtn: "நிறுத்து",

                // Body Pain Mapping
                bodyPainMappingSectionTitle: "உடல் வலி மேப்பிங்",
                bodyPainMappingDescription: "உடல் வரைபடத்தில் வலி உள்ள பகுதிகளைக் குறியிட்டு உங்கள் வலி அனுபவங்களைக் கண்காணிக்கவும்.",
                addPainEntryBtn: "வலி பதிவை சேர்",
                analyzePainEntriesBtn: "வலியை பகுப்பாய்வு செய்",
                noPainEntries: "வலி பதிவுகள் எதுவும் இல்லை.",

                // First Aid & Emergency
                firstAidEmergencySectionTitle: "முதலுதவி & அவசர உதவி",
                firstAidEmergencyDescription: "அவசர காலங்களில் முதலுதவி மற்றும் முக்கியமான தகவல்களை விரைவாக அணுகவும்.",
                getEmergencyInfoBtn: "தகவல் பெறு",
            },
            'en': {
                mainTitle: "Arogya Nanban - Your Health Guide",
                descriptionText: "I'm here to help you achieve your health goals. Enter your goal to get a health tip or explore features.",
                tipSectionTitle: "Enter Your Health Goal",
                generateBtn: "Get Tip",
                aiVoiceBtn: "AI Voice",
                loadingText: "Generating health tip...",
                showFeaturesLabel: "See Features",
                featuresPageTitle: "Explore Our Features",

                // Feature labels
                stepTrackerLabel: "Step Tracker",
                heartRateTrackerLabel: "Heart Rate",
                waterTrackerLabel: "Water Tracker",
                journalLabel: "Mood & Gratitude Journal",
                localTipsLabel: "Local Tips",
                mealPlanLabel: "Meal Plan",
                moodAnalysisLabel: "Mood Analysis",
                exerciseYogaLabel: "Exercise & Yoga",
                diseasePreventionLabel: "Disease Prevention",
                wellnessChallengeLabel: "Wellness Challenges",
                medicationReminderLabel: "Medication Reminder",
                bodyPainMappingLabel: "Body Pain Mapping",
                firstAidEmergencyLabel: "First Aid & Emergency",

                // Step Tracker
                stepSectionTitle: "Step Tracker",
                addOneStepBtn: "Add One Step",
                toggleTrackingBtn: "Start/Stop Tracking",
                resetStepsBtn: "Reset Steps",
                stepResultOutputDefault: "Your steps will be displayed here.",
                stepTipOutputDefault: "Walking a lot is good for your health! 💪",

                // Heart Rate Tracker
                heartRateSectionTitle: "Heart Rate Tracker",
                simulateHeartRateBtn: "Simulate Heart Rate",
                resetHeartRateBtn: "Reset",
                heartRateResultOutputDefault: "Your heart rate will be displayed here.",
                heartRateTipOutputDefault: "A consistent heart rate is a sign of a healthy life. ❤️",

                // Water Tracker
                waterSectionTitle: "Water Intake Tracker",
                addWaterBtn: "Add 200 ml Water",
                resetWaterBtn: "Reset",
                waterResultOutputDefault: "Your water intake will be displayed here.",
                waterTipOutputDefault: "Stay hydrated throughout the day! 💧",

                // Journal
                journalSectionTitle: "Mood & Gratitude Journal",
                journalDescription: "Record your mood and what you're grateful for. This helps track your emotions and cultivate positivity.",
                saveJournalEntryBtn: "Save Entry",
                analyzeMoodJournalBtn: "Analyze Mood",
                journalEntriesOutputDefault: "Your journal entries will be displayed here.",
                moodAnalysisOutputDefault: "Your mood analysis will be displayed here.",

                // Local Tips
                localTipsSectionTitle: "Local Health Tips",
                localTipsDescription: "Get health tips related to your local natural resources and traditional practices.",
                getLocalTipBtn: "Get Tip",

                // Meal Plan
                mealPlanSectionTitle: "Meal Plan Recommendations",
                mealPlanDescription: "Get personalized meal plans based on your diet goals, preferences, and allergies.",
                generateMealPlanBtn: "Generate Meal Plan",

                // Mood Analysis (detailed)
                moodAnalysisSectionTitle: "Detailed Mood Analysis",
                moodAnalysisDescription: "Write a detailed entry about your mood, and we'll analyze it to provide insights.",
                analyzeMoodBtn: "Analyze Mood",

                // Exercise & Yoga
                exerciseYogaSectionTitle: "Exercise & Yoga",
                exerciseYogaDescription: "Get recommendations for exercise or yoga routines tailored to your goals.",
                generateExercisePlanBtn: "Generate Plan",

                // Disease Prevention
                diseasePreventionSectionTitle: "Disease Prevention",
                diseasePreventionDescription: "Get information on common diseases and how to prevent them.",
                generatePreventionTipsBtn: "Get Prevention Tips",

                // Wellness Challenges
                wellnessChallengeSectionTitle: "Wellness Challenges",
                wellnessChallengeDescription: "Participate in various wellness challenges and stay motivated on your health journey.",
                generateChallengeBtn: "Generate Challenge",

                // Medication Reminder
                medicationReminderSectionTitle: "Medication Reminder",
                medicationReminderDescription: "Set reminders to manage your medication timings.",
                addMedicationReminderBtn: "Add Reminder",
                noReminders: "No reminders set.",
                alarmModalTitle: "Alarm!",
                alarmModalMessage: "It's time to take your medication!",
                dismissAlarmBtn: "Dismiss",

                // Body Pain Mapping
                bodyPainMappingSectionTitle: "Body Pain Mapping",
                bodyPainMappingDescription: "Mark areas of pain on the body map and track your pain experiences.",
                addPainEntryBtn: "Add Pain Entry",
                analyzePainEntriesBtn: "Analyze Pain",
                noPainEntries: "No pain entries yet.",

                // First Aid & Emergency
                firstAidEmergencySectionTitle: "First Aid & Emergency",
                firstAidEmergencyDescription: "Quickly access first aid and crucial information for emergencies.",
                getEmergencyInfoBtn: "Get Info",
            }
        };

        let currentLanguage = 'ta'; // Default language

        // Function to update content based on selected language
        function updateContent() {
            const elements = document.querySelectorAll('[id]');
            elements.forEach(element => {
                const key = element.id;
                if (translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });
            // Update data-label-key elements
            document.querySelectorAll('[data-label-key]').forEach(element => {
                const key = element.getAttribute('data-label-key');
                if (translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });

            // Update placeholders and aria-labels separately as textContent doesn't work for them
            document.getElementById('goalInput').setAttribute('placeholder', currentLanguage === 'ta' ? 'உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும்...' : 'Enter your health goal...');
            document.getElementById('goalInput').setAttribute('aria-label', currentLanguage === 'ta' ? 'உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும்' : 'Enter your health goal');

            document.getElementById('micBtn').setAttribute('title', currentLanguage === 'ta' ? 'உங்கள் இலக்கைப் பேசுங்கள்' : 'Speak your goal');
            document.getElementById('micBtn').setAttribute('aria-label', currentLanguage === 'ta' ? 'உங்கள் ஆரோக்கிய இலக்கைப் பதிவு செய்யவும்' : 'Record your health goal');

            document.getElementById('localTipCategory').setAttribute('placeholder', currentLanguage === 'ta' ? 'எ.கா. மஞ்சள், முருங்கை, தியானம்...' : 'e.g., Turmeric, Moringa, Meditation...');
            document.getElementById('localTipCategory').setAttribute('aria-label', currentLanguage === 'ta' ? 'உதவிக்குறிப்பு வகையை உள்ளிடவும்' : 'Enter tip category');
            document.getElementById('localTipMicBtn').setAttribute('title', currentLanguage === 'ta' ? 'உதவிக்குறிப்பு வகையை பேசவும்' : 'Speak tip category');
            document.getElementById('localTipMicBtn').setAttribute('aria-label', currentLanguage === 'ta' ? 'உதவிக்குறிப்பு வகையைப் பதிவு செய்யவும்' : 'Record tip category');


            document.getElementById('dietGoalInput').setAttribute('placeholder', currentLanguage === 'ta' ? 'எ.கா. எடை குறைப்பு, தசை வளர்ச்சி...' : 'e.g., Weight loss, Muscle gain...');
            document.getElementById('dietGoalInput').setAttribute('aria-label', currentLanguage === 'ta' ? 'உணவு இலக்கு' : 'Diet goal');
            document.getElementById('dietGoalMicBtn').setAttribute('title', currentLanguage === 'ta' ? 'உணவு இலக்கைப் பேசவும்' : 'Speak diet goal');
            document.getElementById('dietGoalMicBtn').setAttribute('aria-label', currentLanguage === 'ta' ? 'உணவு இலக்கைப் பதிவு செய்யவும்' : 'Record diet goal');

            document.getElementById('dietPreferenceSelect').querySelector('option[value=""]').textContent = currentLanguage === 'ta' ? 'உணவு விருப்பத்தைத் தேர்ந்தெடுக்கவும்' : 'Select Diet Preference';
            document.getElementById('dietPreferenceSelect').querySelector('option[value="vegetarian"]').textContent = currentLanguage === 'ta' ? 'சைவம்' : 'Vegetarian';
            document.getElementById('dietPreferenceSelect').querySelector('option[value="non-vegetarian"]').textContent = currentLanguage === 'ta' ? 'அசைவம்' : 'Non-Vegetarian';
            document.getElementById('dietPreferenceSelect').querySelector('option[value="vegan"]').textContent = currentLanguage === 'ta' ? 'முழு சைவம்' : 'Vegan';
            document.getElementById('dietPreferenceSelect').setAttribute('aria-label', currentLanguage === 'ta' ? 'உணவு விருப்பம்' : 'Diet preference');

            document.getElementById('allergiesInput').setAttribute('placeholder', currentLanguage === 'ta' ? 'எ.கா. நிலக்கடலை, பால்...' : 'e.g., Peanuts, Dairy...');
            document.getElementById('allergiesInput').setAttribute('aria-label', currentLanguage === 'ta' ? 'ஒவ்வாமைகள்' : 'Allergies');
            document.getElementById('allergiesMicBtn').setAttribute('title', currentLanguage === 'ta' ? 'ஒவ்வாமைகளைப் பேசவும்' : 'Speak allergies');
            document.getElementById('allergiesMicBtn').setAttribute('aria-label', currentLanguage === 'ta' ? 'ஒவ்வாமைகளைப் பதிவு செய்யவும்' : 'Record allergies');

            document.getElementById('moodSelect').querySelector('option[value=""]').textContent = currentLanguage === 'ta' ? 'உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்' : 'Select your mood';
            document.getElementById('moodSelect').querySelector('option[value="happy"]').textContent = currentLanguage === 'ta' ? 'மகிழ்ச்சி 😄' : 'Happy 😄';
            document.getElementById('moodSelect').querySelector('option[value="neutral"]').textContent = currentLanguage === 'ta' ? 'சாதாரணம் 😐' : 'Neutral 😐';
            document.getElementById('moodSelect').querySelector('option[value="sad"]').textContent = currentLanguage === 'ta' ? 'சோகம் 😔' : 'Sad 😔';
            document.getElementById('moodSelect').querySelector('option[value="stressed"]').textContent = currentLanguage === 'ta' ? 'மன அழுத்தம் 😩' : 'Stressed 😩';
            document.getElementById('moodSelect').querySelector('option[value="energetic"]').textContent = currentLanguage === 'ta' ? 'ஆற்றல் 💪' : 'Energetic 💪';
            document.getElementById('moodSelect').setAttribute('aria-label', currentLanguage === 'ta' ? 'உங்கள் மனநிலையைத் தேர்ந்தெடுக்கவும்' : 'Select your mood');

            document.getElementById('gratitudeInput').setAttribute('placeholder', currentLanguage === 'ta' ? 'நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்...' : 'Write something you are grateful for...');
            document.getElementById('gratitudeInput').setAttribute('aria-label', currentLanguage === 'ta' ? 'நீங்கள் நன்றியுள்ள ஒரு விஷயத்தை எழுதுங்கள்' : 'Write something you are grateful for');

            document.getElementById('moodEntryInput').setAttribute('placeholder', currentLanguage === 'ta' ? 'உங்கள் மனநிலை பற்றி எழுதுங்கள்...' : 'Write about your mood...');
            document.getElementById('moodEntryInput').setAttribute('aria-label', currentLanguage === 'ta' ? 'உங்கள் மனநிலை பற்றி எழுதுங்கள்' : 'Write about your mood');

            document.getElementById('exerciseGoalInput').setAttribute('placeholder', currentLanguage === 'ta' ? 'எ.கா. நெகிழ்வுத்தன்மை, வலிமை...' : 'e.g., Flexibility, Strength...');
            document.getElementById('exerciseGoalInput').setAttribute('aria-label', currentLanguage === 'ta' ? 'உங்கள் உடற்பயிற்சி/யோகா இலக்கை உள்ளிடவும்' : 'Enter your exercise/yoga goal');
            document.getElementById('exerciseGoalMicBtn').setAttribute('title', currentLanguage === 'ta' ? 'உங்கள் இலக்கைப் பேசவும்' : 'Speak your goal');
            document.getElementById('exerciseGoalMicBtn').setAttribute('aria-label', currentLanguage === 'ta' ? 'உங்கள் இலக்கைப் பதிவு செய்யவும்' : 'Record your goal');

            document.getElementById('diseaseInput').setAttribute('placeholder', currentLanguage === 'ta' ? 'எ.கா. நீரிழிவு, சளி...' : 'e.g., Diabetes, Cold...');
            document.getElementById('diseaseInput').setAttribute('aria-label', currentLanguage === 'ta' ? 'நோய் அல்லது தடுப்பு குறிப்பை உள்ளிடவும்' : 'Enter disease or prevention keyword');
            document.getElementById('diseaseMicBtn').setAttribute('title', currentLanguage === 'ta' ? 'நோய்/தடுப்பு குறிப்பை பேசவும்' : 'Speak disease/prevention keyword');
            document.getElementById('diseaseMicBtn').setAttribute('aria-label', currentLanguage === 'ta' ? 'நோய்/தடுப்பு குறிப்பை பதிவு செய்யவும்' : 'Record disease/prevention keyword');

            document.getElementById('challengeTypeInput').setAttribute('placeholder', currentLanguage === 'ta' ? 'எ.கா. 30 நாள் தண்ணீர் சவால்...' : 'e.g., 30-day water challenge...');
            document.getElementById('challengeTypeInput').setAttribute('aria-label', currentLanguage === 'ta' ? 'சவால் வகையை உள்ளிடவும்' : 'Enter challenge type');
            document.getElementById('challengeTypeMicBtn').setAttribute('title', currentLanguage === 'ta' ? 'சவால் வகையை பேசவும்' : 'Speak challenge type');
            document.getElementById('challengeTypeMicBtn').setAttribute('aria-label', currentLanguage === 'ta' ? 'சவால் வகையை பதிவு செய்யவும்' : 'Record challenge type');

            document.getElementById('medicationNameInput').setAttribute('placeholder', currentLanguage === 'ta' ? 'மருந்தின் பெயர்' : 'Medication Name');
            document.getElementById('medicationNameInput').setAttribute('aria-label', currentLanguage === 'ta' ? 'மருந்தின் பெயர்' : 'Medication Name');
            document.getElementById('medicationTimeInput').setAttribute('aria-label', currentLanguage === 'ta' ? 'நேரம் (HH:MM)' : 'Time (HH:MM)');

            document.getElementById('painDescriptionInput').setAttribute('placeholder', currentLanguage === 'ta' ? 'வலி விளக்கம்' : 'Pain Description');
            document.getElementById('painDescriptionInput').setAttribute('aria-label', currentLanguage === 'ta' ? 'வலி விளக்கம்' : 'Pain Description');

            document.getElementById('emergencyInput').setAttribute('placeholder', currentLanguage === 'ta' ? 'எ.கா. காயம், மூச்சுத் திணறல்...' : 'e.g., Injury, Choking...');
            document.getElementById('emergencyInput').setAttribute('aria-label', currentLanguage === 'ta' ? 'அவசர நிலை அல்லது முதலுதவி தலைப்பை உள்ளிடவும்' : 'Enter emergency or first aid topic');
            document.getElementById('emergencyMicBtn').setAttribute('title', currentLanguage === 'ta' ? 'அவசர நிலை அல்லது முதலுதவி தலைப்பை பேசவும்' : 'Speak emergency or first aid topic');
            document.getElementById('emergencyMicBtn').setAttribute('aria-label', currentLanguage === 'ta' ? 'அவசர நிலை அல்லது முதலுதவி தலைப்பை பதிவு செய்யவும்' : 'Record emergency or first aid topic');

            // Set default text for tracker outputs if they are empty
            document.getElementById('stepResultOutput').innerHTML = `<em>${translations[currentLanguage].stepResultOutputDefault}</em>`;
            document.getElementById('stepTipOutput').innerHTML = `<em>${translations[currentLanguage].stepTipOutputDefault}</em>`;
            document.getElementById('heartRateResultOutput').innerHTML = `<em>${translations[currentLanguage].heartRateResultOutputDefault}</em>`;
            document.getElementById('heartRateTipOutput').innerHTML = `<em>${translations[currentLanguage].heartRateTipOutputDefault}</em>`;
            document.getElementById('waterResultOutput').innerHTML = `<em>${translations[currentLanguage].waterResultOutputDefault}</em>`;
            document.getElementById('waterTipOutput').innerHTML = `<em>${translations[currentLanguage].waterTipOutputDefault}</em>`;
            document.getElementById('journalEntriesOutput').innerHTML = `<em>${translations[currentLanguage].journalEntriesOutputDefault}</em>`;
            document.getElementById('moodAnalysisOutput').innerHTML = `<em>${translations[currentLanguage].moodAnalysisOutputDefault}</em>`;
            document.getElementById('medicationRemindersList').innerHTML = `<em>${translations[currentLanguage].noReminders}</em>`;
            document.getElementById('painEntriesList').innerHTML = `<em>${translations[currentLanguage].noPainEntries}</em>`;


            // Splash screen button text (if applicable, though it fades out)
            // if (document.getElementById('splashScreenBtn')) {
            //     document.getElementById('splashScreenBtn').textContent = currentLanguage === 'ta' ? 'தொடரவும்' : 'Continue';
            // }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const splashScreen = document.getElementById('splashScreen');
            const mainContent = document.getElementById('mainContent');
            const languageSelect = document.getElementById('languageSelect');

            // Hide splash screen after 2 seconds and show main content
            setTimeout(() => {
                splashScreen.classList.add('fade-out');
                splashScreen.addEventListener('transitionend', () => {
                    splashScreen.style.display = 'none';
                    mainContent.style.display = 'block';
                    document.body.classList.add('main-content-active');
                }, { once: true });
            }, 2000);

            languageSelect.addEventListener('change', (event) => {
                currentLanguage = event.target.value;
                updateContent();
            });

            // Initial content update
            updateContent();

            const goalInput = document.getElementById('goalInput');
            const generateBtn = document.getElementById('generateBtn');
            const tipOutput = document.getElementById('tipOutput');
            const loading = document.getElementById('loading');
            const loadingText = document.getElementById('loadingText');
            const micBtn = document.getElementById('micBtn');
            const aiVoiceBtn = document.getElementById('aiVoiceBtn');
            const ttsVoiceSelect = document.getElementById('ttsVoiceSelect');

            let recognition;
            let synth = window.speechSynthesis;
            let voices = [];
            let currentUtterance = null; // To keep track of the current spoken utterance

            // Initialize Tone.js for alarm sound
            const synthTone = new Tone.Synth().toDestination();

            function populateVoiceList() {
                voices = synth.getVoices().filter(voice => voice.lang.startsWith('ta') || voice.lang.startsWith('en'));
                ttsVoiceSelect.innerHTML = ''; // Clear existing options

                // Add default "Browser Default" option
                const defaultOption = document.createElement('option');
                defaultOption.value = 'default';
                defaultOption.textContent = currentLanguage === 'ta' ? 'இயல்புநிலை குரல்' : 'Browser Default Voice';
                ttsVoiceSelect.appendChild(defaultOption);

                voices.forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voice.name;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    if (voice.default) {
                        option.selected = true; // Select default voice if available
                    }
                    ttsVoiceSelect.appendChild(option);
                });
            }

            // Populate voices when they are loaded
            synth.onvoiceschanged = populateVoiceList;
            // Also call it once in case voices are already loaded
            populateVoiceList();

            aiVoiceBtn.addEventListener('click', () => {
                if (currentUtterance && synth.speaking) {
                    synth.cancel(); // Stop current speech
                    aiVoiceBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>`;
                    return;
                }

                const textToSpeak = tipOutput.textContent.trim();
                if (textToSpeak) {
                    speakText(textToSpeak);
                } else {
                    alert(currentLanguage === 'ta' ? 'தயவுசெய்து ஒரு உதவிக்குறிப்பை முதலில் உருவாக்கவும்.' : 'Please generate a tip first.');
                }
            });

            function speakText(text, outputElementId = 'tipOutput') {
                if (synth.speaking) {
                    synth.cancel(); // Stop any current speech before starting new one
                }

                currentUtterance = new SpeechSynthesisUtterance(text);
                const selectedVoiceName = ttsVoiceSelect.value;
                const selectedVoice = voices.find(voice => voice.name === selectedVoiceName) || voices.find(voice => voice.default);

                if (selectedVoice) {
                    currentUtterance.voice = selectedVoice;
                } else {
                    // Fallback to a default voice for the current language if no specific voice is selected or found
                    const defaultLangVoice = voices.find(voice => voice.lang.startsWith(currentLanguage));
                    if (defaultLangVoice) {
                        currentUtterance.voice = defaultLangVoice;
                    }
                }

                currentUtterance.lang = currentLanguage;
                currentUtterance.pitch = 1;
                currentUtterance.rate = 1;

                currentUtterance.onstart = () => {
                    const aiVoiceButton = document.getElementById(`${outputElementId.replace('Output', '')}AiVoiceBtn`) || aiVoiceBtn;
                    aiVoiceButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-x">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <line x1="22" y1="9" x2="16" y2="15"></line>
                            <line x1="16" y1="9" x2="22" y2="15"></line>
                        </svg>`;
                };

                currentUtterance.onend = () => {
                    const aiVoiceButton = document.getElementById(`${outputElementId.replace('Output', '')}AiVoiceBtn`) || aiVoiceBtn;
                    aiVoiceButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-volume-2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M23.31 1.69a16 16 0 0 1 0 20.62"></path>
                        </svg>`;
                };

                currentUtterance.onerror = (event) => {
                    console.error('SpeechSynthesisUtterance.onerror', event);
                    alert(currentLanguage === 'ta' ? 'குரல் உருவாக்கத்தில் பிழை ஏற்பட்டது.' : 'Error in speech synthesis.');
                };

                synth.speak(currentUtterance);
            }

            // Function to generate tip and speak
            async function generateTipAndSpeak(query, outputElement, aiVoiceButton, speakPrompt = true) {
                loading.style.display = 'flex';
                loadingText.textContent = translations[currentLanguage].loadingText;
                outputElement.innerHTML = '';
                aiVoiceButton.style.display = 'none';

                try {
                    const response = await fetch('YOUR_API_ENDPOINT', { // Replace with your actual API endpoint
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ goal: query, language: currentLanguage }),
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    const tip = data.tip || translations[currentLanguage].noTipFound;
                    outputElement.innerHTML = `<p>${tip}</p>`;
                    aiVoiceButton.style.display = 'inline-flex';
                    if (speakPrompt) {
                        speakText(tip, outputElement.id); // Pass the outputElement's ID
                    }
                } catch (error) {
                    console.error('Error fetching health tip:', error);
                    outputElement.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உதவிக்குறிப்பைப் பெறுவதில் பிழை ஏற்பட்டது. மீண்டும் முயற்சிக்கவும்.' : 'Failed to fetch tip. Please try again.'}</p>`;
                    aiVoiceBtn.style.display = 'none';
                } finally {
                    loading.style.display = 'none';
                }
            }


            generateBtn.addEventListener('click', () => {
                const goal = goalInput.value.trim();
                if (goal) {
                    generateTipAndSpeak(goal, tipOutput, aiVoiceBtn, true);
                } else {
                    tipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'தயவுசெய்து ஒரு ஆரோக்கிய இலக்கை உள்ளிடவும்.' : 'Please enter a health goal.'}</p>`;
                }
            });

            // Speech recognition setup
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';

                recognition.onstart = () => {
                    micBtn.classList.add('recording');
                    micBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic-off">
                            <line x1="1" y1="1" x2="23" y2="23"></line>
                            <path d="M9 9v3a3 3 0 0 0 5.12 2.22M16 16v-4a4 4 0 0 0-8-1.88M15 9.3V4a3 3 0 0 0-6 0v.3"></path>
                            <path d="M5 9.09V12a7 7 0 0 0 14 0v-2.91"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>`;
                };

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    goalInput.value = transcript;
                    micBtn.classList.remove('recording');
                    micBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>`;
                };

                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    micBtn.classList.remove('recording');
                    micBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>`;
                    alert(currentLanguage === 'ta' ? 'குரல் உள்ளீட்டில் பிழை ஏற்பட்டது.' : 'Error in voice input.');
                };

                recognition.onend = () => {
                    micBtn.classList.remove('recording');
                    micBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>`;
                };

                micBtn.addEventListener('click', () => {
                    recognition.start();
                });
            } else {
                micBtn.style.display = 'none';
                console.warn('Speech Recognition not supported in this browser.');
            }

            // --- Feature Navigation ---
            const toggleFeaturesBtn = document.getElementById('toggleFeaturesBtn');
            const initialView = document.getElementById('initialView');
            const featuresContainer = document.getElementById('featuresContainer');
            const allFeatureIconsContainer = document.getElementById('allFeatureIconsContainer');
            const backToMainFromFeaturesContainerBtn = document.getElementById('backToMainFromFeaturesContainer');

            toggleFeaturesBtn.addEventListener('click', () => {
                initialView.style.display = 'none';
                featuresContainer.style.display = 'block';
                allFeatureIconsContainer.style.display = 'flex'; // Show the icons
                backToMainFromFeaturesContainerBtn.style.display = 'inline-flex';
                document.body.classList.add('main-content-active');
                updateContent(); // Update text for the new view
            });

            backToMainFromFeaturesContainerBtn.addEventListener('click', () => {
                featuresContainer.style.display = 'none';
                initialView.style.display = 'block';
                document.body.classList.remove('main-content-active');
                updateContent(); // Update text for the main view
            });

            document.querySelectorAll('.feature-icon').forEach(icon => {
                icon.addEventListener('click', (event) => {
                    const targetSectionId = event.currentTarget.dataset.section;
                    // Hide all feature sections first
                    document.querySelectorAll('.feature-section').forEach(section => {
                        section.style.display = 'none';
                    });
                    // Hide the icons container
                    allFeatureIconsContainer.style.display = 'none';
                    // Show the selected feature section
                    document.getElementById(targetSectionId).style.display = 'block';
                    // Show the back button for this specific section
                    document.getElementById(targetSectionId).querySelector('.back-button').style.display = 'inline-flex';
                    // Hide the general back button for the features container
                    backToMainFromFeaturesContainerBtn.style.display = 'none';
                    document.body.classList.add('main-content-active'); // Ensure scrolling is active
                    updateContent(); // Update text for the new view
                });
            });

            document.querySelectorAll('.feature-section .back-button').forEach(button => {
                button.addEventListener('click', (event) => {
                    const targetContainerId = event.currentTarget.dataset.target;
                    // Hide the current feature section
                    event.currentTarget.closest('.feature-section').style.display = 'none';
                    // Show the icons container
                    document.getElementById(targetContainerId).style.display = 'flex';
                    // Show the general back button for the features container
                    backToMainFromFeaturesContainerBtn.style.display = 'inline-flex';
                    document.body.classList.add('main-content-active'); // Ensure scrolling is active
                    updateContent(); // Update text for the icons view
                });
            });


            // --- Step Tracker Functionality ---
            let steps = 0;
            let isTracking = false;
            let stepInterval;
            const currentStepsDisplay = document.getElementById('currentStepsDisplay');
            const addOneStepBtn = document.getElementById('addOneStepBtn');
            const toggleTrackingBtn = document.getElementById('toggleTrackingBtn');
            const resetStepsBtn = document.getElementById('resetStepsBtn');
            const stepResultOutput = document.getElementById('stepResultOutput');
            const stepTipOutput = document.getElementById('stepTipOutput');

            addOneStepBtn.addEventListener('click', () => {
                steps++;
                currentStepsDisplay.value = steps;
                stepResultOutput.innerHTML = `<p>${currentLanguage === 'ta' ? `நீங்கள் இப்போது ${steps} படிகள் எடுத்துள்ளீர்கள்.` : `You have now taken ${steps} steps.`}</p>`;
                if (steps >= 1000) {
                    stepTipOutput.innerHTML = `<p class="text-green-600">${currentLanguage === 'ta' ? 'அருமை! நீங்கள் 1000 படிகளுக்கு மேல் கடந்துவிட்டீர்கள். தொடர்ந்து இருங்கள்!' : 'Great! You\'ve surpassed 1000 steps. Keep going!'}</p>`;
                } else {
                    stepTipOutput.innerHTML = `<em>${translations[currentLanguage].stepTipOutputDefault}</em>`;
                }
            });

            toggleTrackingBtn.addEventListener('click', () => {
                if (isTracking) {
                    clearInterval(stepInterval);
                    toggleTrackingBtn.textContent = currentLanguage === 'ta' ? 'டிராக்கிங்கை தொடங்கு' : 'Start Tracking';
                    stepResultOutput.innerHTML = `<p>${currentLanguage === 'ta' ? 'படி டிராக்கிங் நிறுத்தப்பட்டது.' : 'Step tracking stopped.'}</p>`;
                } else {
                    stepInterval = setInterval(() => {
                        steps += Math.floor(Math.random() * 10) + 1; // Simulate random steps
                        currentStepsDisplay.value = steps;
                        stepResultOutput.innerHTML = `<p>${currentLanguage === 'ta' ? `நீங்கள் இப்போது ${steps} படிகள் எடுத்துள்ளீர்கள்.` : `You have now taken ${steps} steps.`}</p>`;
                        if (steps >= 1000) {
                            stepTipOutput.innerHTML = `<p class="text-green-600">${currentLanguage === 'ta' ? 'அருமை! நீங்கள் 1000 படிகளுக்கு மேல் கடந்துவிட்டீர்கள். தொடர்ந்து இருங்கள்!' : 'Great! You\'ve surpassed 1000 steps. Keep going!'}</p>`;
                        } else {
                            stepTipOutput.innerHTML = `<em>${translations[currentLanguage].stepTipOutputDefault}</em>`;
                        }
                    }, 2000); // Add steps every 2 seconds
                    toggleTrackingBtn.textContent = currentLanguage === 'ta' ? 'டிராக்கிங்கை நிறுத்து' : 'Stop Tracking';
                    stepResultOutput.innerHTML = `<p>${currentLanguage === 'ta' ? 'படி டிராக்கிங் தொடங்கப்பட்டது.' : 'Step tracking started.'}</p>`;
                }
                isTracking = !isTracking;
            });

            resetStepsBtn.addEventListener('click', () => {
                steps = 0;
                currentStepsDisplay.value = steps;
                clearInterval(stepInterval);
                isTracking = false;
                toggleTrackingBtn.textContent = currentLanguage === 'ta' ? 'டிராக்கிங்கை தொடங்கு' : 'Start Tracking';
                stepResultOutput.innerHTML = `<em>${translations[currentLanguage].stepResultOutputDefault}</em>`;
                stepTipOutput.innerHTML = `<em>${translations[currentLanguage].stepTipOutputDefault}</em>`;
            });

            // --- Heart Rate Tracker Functionality ---
            const currentHeartRateDisplay = document.getElementById('currentHeartRateDisplay');
            const simulateHeartRateBtn = document.getElementById('simulateHeartRateBtn');
            const resetHeartRateBtn = document.getElementById('resetHeartRateBtn');
            const heartRateResultOutput = document.getElementById('heartRateResultOutput');
            const heartRateTipOutput = document.getElementById('heartRateTipOutput');

            let heartRateInterval;

            simulateHeartRateBtn.addEventListener('click', () => {
                clearInterval(heartRateInterval); // Clear any existing interval
                heartRateResultOutput.innerHTML = `<p>${currentLanguage === 'ta' ? 'இதயத் துடிப்பு அளவிடப்படுகிறது...' : 'Measuring heart rate...'}</p>`;

                let simulatedRate = 70; // Start with a normal rate

                heartRateInterval = setInterval(() => {
                    // Simulate slight variations
                    simulatedRate += Math.floor(Math.random() * 5) - 2; // +/- 2 bpm
                    // Keep within a reasonable range
                    if (simulatedRate < 60) simulatedRate = 60;
                    if (simulatedRate > 100) simulatedRate = 100;

                    currentHeartRateDisplay.value = `${simulatedRate} BPM`;
                    heartRateResultOutput.innerHTML = `<p>${currentLanguage === 'ta' ? `உங்கள் இதயத் துடிப்பு: ${simulatedRate} BPM.` : `Your heart rate: ${simulatedRate} BPM.`}</p>`;

                    if (simulatedRate > 90) {
                        heartRateTipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உங்கள் இதயத் துடிப்பு சற்றே அதிகமாக உள்ளது. ஓய்வெடுக்க முயற்சிக்கவும்.' : 'Your heart rate is a bit high. Try to relax.'}</p>`;
                    } else if (simulatedRate < 60) {
                        heartRateTipOutput.innerHTML = `<p class="text-orange-600">${currentLanguage === 'ta' ? 'உங்கள் இதயத் துடிப்பு சற்றே குறைவாக உள்ளது. மருத்துவரை அணுகவும்.' : 'Your heart rate is a bit low. Consult a doctor.'}</p>`;
                    } else {
                        heartRateTipOutput.innerHTML = `<p class="text-green-600">${currentLanguage === 'ta' ? 'உங்கள் இதயத் துடிப்பு இயல்பாக உள்ளது. அருமை!' : 'Your heart rate is normal. Great!'}</p>`;
                    }
                }, 3000); // Update every 3 seconds
            });

            resetHeartRateBtn.addEventListener('click', () => {
                clearInterval(heartRateInterval);
                currentHeartRateDisplay.value = '0';
                heartRateResultOutput.innerHTML = `<em>${translations[currentLanguage].heartRateResultOutputDefault}</em>`;
                heartRateTipOutput.innerHTML = `<em>${translations[currentLanguage].heartRateTipOutputDefault}</em>`;
            });

            // --- Water Tracker Functionality ---
            let waterIntake = 0;
            const waterIntakeDisplay = document.getElementById('waterIntakeDisplay');
            const addWaterBtn = document.getElementById('addWaterBtn');
            const resetWaterBtn = document.getElementById('resetWaterBtn');
            const waterResultOutput = document.getElementById('waterResultOutput');
            const waterTipOutput = document.getElementById('waterTipOutput');
            const dailyWaterGoal = 2000; // in ml

            addWaterBtn.addEventListener('click', () => {
                waterIntake += 200; // Add 200 ml per click
                waterIntakeDisplay.value = `${waterIntake} ml`;
                waterResultOutput.innerHTML = `<p>${currentLanguage === 'ta' ? `நீங்கள் இப்போது ${waterIntake} மிலி தண்ணீர் குடித்துள்ளீர்கள்.` : `You have now consumed ${waterIntake} ml of water.`}</p>`;

                if (waterIntake >= dailyWaterGoal) {
                    waterTipOutput.innerHTML = `<p class="text-green-600">${currentLanguage === 'ta' ? 'வாழ்த்துக்கள்! உங்கள் தினசரி தண்ணீர் இலக்கை அடைந்துவிட்டீர்கள்!' : 'Congratulations! You\'ve reached your daily water goal!'}</p>`;
                } else if (waterIntake >= dailyWaterGoal * 0.75) {
                    waterTipOutput.innerHTML = `<p class="text-blue-600">${currentLanguage === 'ta' ? 'அருமை! நீங்கள் கிட்டத்தட்ட உங்கள் இலக்கை அடைந்துவிட்டீர்கள்.' : 'Great! You\'re almost at your goal.'}</p>`;
                } else {
                    waterTipOutput.innerHTML = `<em>${translations[currentLanguage].waterTipOutputDefault}</em>`;
                }
            });

            resetWaterBtn.addEventListener('click', () => {
                waterIntake = 0;
                waterIntakeDisplay.value = '0 ml';
                waterResultOutput.innerHTML = `<em>${translations[currentLanguage].waterResultOutputDefault}</em>`;
                waterTipOutput.innerHTML = `<em>${translations[currentLanguage].waterTipOutputDefault}</em>`;
            });

            // --- Mood & Gratitude Journal Functionality ---
            const moodSelect = document.getElementById('moodSelect');
            const gratitudeInput = document.getElementById('gratitudeInput');
            const saveJournalEntryBtn = document.getElementById('saveJournalEntryBtn');
            const journalEntriesOutput = document.getElementById('journalEntriesOutput');
            const analyzeMoodJournalBtn = document.getElementById('analyzeMoodJournalBtn');
            const moodAnalysisOutput = document.getElementById('moodAnalysisOutput');

            let journalEntries = [];

            function renderJournalEntries() {
                if (journalEntries.length === 0) {
                    journalEntriesOutput.innerHTML = `<em>${translations[currentLanguage].journalEntriesOutputDefault}</em>`;
                    return;
                }
                journalEntriesOutput.innerHTML = '';
                journalEntries.forEach((entry, index) => {
                    const li = document.createElement('li');
                    li.textContent = `${entry.date}: Mood - ${entry.mood}, Gratitude - ${entry.gratitude}`;
                    journalEntriesOutput.appendChild(li);
                });
            }

            saveJournalEntryBtn.addEventListener('click', () => {
                const mood = moodSelect.value;
                const gratitude = gratitudeInput.value.trim();
                if (mood && gratitude) {
                    const date = new Date().toLocaleDateString(currentLanguage === 'ta' ? 'ta-IN' : 'en-US');
                    journalEntries.push({ date, mood, gratitude });
                    renderJournalEntries();
                    moodSelect.value = '';
                    gratitudeInput.value = '';
                    moodAnalysisOutput.innerHTML = `<em>${translations[currentLanguage].moodAnalysisOutputDefault}</em>`; // Clear analysis on new entry
                } else {
                    alert(currentLanguage === 'ta' ? 'மனநிலை மற்றும் நன்றியுணர்வு இரண்டையும் உள்ளிடவும்.' : 'Please select a mood and enter a gratitude entry.');
                }
            });

            analyzeMoodJournalBtn.addEventListener('click', async () => {
                if (journalEntries.length === 0) {
                    moodAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'பகுப்பாய்வு செய்ய ஜர்னல் பதிவுகள் இல்லை.' : 'No journal entries to analyze.'}</p>`;
                    return;
                }

                loading.style.display = 'flex';
                loadingText.textContent = currentLanguage === 'ta' ? 'மனநிலையைப் பகுப்பாய்வு செய்கிறது...' : 'Analyzing mood...';
                moodAnalysisOutput.innerHTML = '';

                const journalText = journalEntries.map(entry => `On ${entry.date}, my mood was ${entry.mood} and I was grateful for: ${entry.gratitude}`).join('\n');

                try {
                    const response = await fetch('YOUR_API_ENDPOINT_FOR_MOOD_ANALYSIS', { // Replace with your actual API endpoint
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ journalEntries: journalText, language: currentLanguage }),
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    const analysis = data.analysis || translations[currentLanguage].moodAnalysisOutputDefault;
                    moodAnalysisOutput.innerHTML = `<p>${analysis}</p>`;
                } catch (error) {
                    console.error('Error analyzing mood:', error);
                    moodAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'மனநிலையைப் பகுப்பாய்வு செய்வதில் பிழை ஏற்பட்டது. மீண்டும் முயற்சிக்கவும்.' : 'Failed to analyze mood. Please try again.'}</p>`;
                } finally {
                    loading.style.display = 'none';
                }
            });

            // Initial render for journal
            renderJournalEntries();


            // --- Local Health Tips Functionality ---
            const localTipCategory = document.getElementById('localTipCategory');
            const localTipMicBtn = document.getElementById('localTipMicBtn');
            const getLocalTipBtn = document.getElementById('getLocalTipBtn');
            const localTipOutput = document.getElementById('localTipOutput');
            const localTipAiVoiceBtn = document.getElementById('localTipAiVoiceBtn');
            const localTipCategoryDropdown = document.getElementById('localTipCategoryDropdown');

            const localTipCategories = ["மஞ்சள்", "முருங்கை", "தியானம்", "யோகா", "ஆயுர்வேதம்", "பாரம்பரிய உணவு", "மூலிகை மருத்துவம்", "உடற்பயிற்சி"];
            let localTipRecognition;

            // Populate dropdown
            function populateLocalTipDropdown() {
                localTipCategoryDropdown.innerHTML = '';
                localTipCategories.forEach(category => {
                    const div = document.createElement('div');
                    div.textContent = category;
                    div.addEventListener('click', () => {
                        localTipCategory.value = category;
                        localTipCategoryDropdown.classList.add('hidden');
                    });
                    localTipCategoryDropdown.appendChild(div);
                });
            }
            populateLocalTipDropdown();

            localTipCategory.addEventListener('input', () => {
                const query = localTipCategory.value.toLowerCase();
                const filteredCategories = localTipCategories.filter(cat => cat.toLowerCase().includes(query));
                localTipCategoryDropdown.innerHTML = '';
                if (filteredCategories.length > 0 && query.length > 0) {
                    filteredCategories.forEach(category => {
                        const div = document.createElement('div');
                        div.textContent = category;
                        div.addEventListener('click', () => {
                            localTipCategory.value = category;
                            localTipCategoryDropdown.classList.add('hidden');
                        });
                        localTipCategoryDropdown.appendChild(div);
                    });
                    localTipCategoryDropdown.classList.remove('hidden');
                } else {
                    localTipCategoryDropdown.classList.add('hidden');
                }
            });

            localTipCategory.addEventListener('focus', () => {
                if (localTipCategory.value === '') {
                    populateLocalTipDropdown(); // Show all on focus if empty
                    localTipCategoryDropdown.classList.remove('hidden');
                }
            });

            document.addEventListener('click', (event) => {
                if (!localTipCategory.contains(event.target) && !localTipCategoryDropdown.contains(event.target)) {
                    localTipCategoryDropdown.classList.add('hidden');
                }
            });


            if ('webkitSpeechRecognition' in window) {
                localTipRecognition = new webkitSpeechRecognition();
                localTipRecognition.continuous = false;
                localTipRecognition.interimResults = false;
                localTipRecognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';

                localTipRecognition.onstart = () => {
                    localTipMicBtn.classList.add('recording');
                };

                localTipRecognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    localTipCategory.value = transcript;
                    localTipMicBtn.classList.remove('recording');
                };

                localTipRecognition.onerror = (event) => {
                    console.error('Local tip speech recognition error:', event.error);
                    localTipMicBtn.classList.remove('recording');
                };

                localTipRecognition.onend = () => {
                    localTipMicBtn.classList.remove('recording');
                };

                localTipMicBtn.addEventListener('click', () => {
                    localTipRecognition.start();
                });
            } else {
                localTipMicBtn.style.display = 'none';
            }

            getLocalTipBtn.addEventListener('click', () => {
                const category = localTipCategory.value.trim();
                if (category) {
                    // Call the generateTipAndSpeak function with the specific output element and AI voice button
                    generateTipAndSpeak(`local health tip about ${category}`, localTipOutput, localTipAiVoiceBtn, true);
                } else {
                    localTipOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உதவிக்குறிப்பு வகையை உள்ளிடவும்.' : 'Please enter a tip category.'}</p>`;
                }
            });

            localTipAiVoiceBtn.addEventListener('click', () => {
                const textToSpeak = localTipOutput.textContent.trim();
                if (textToSpeak) {
                    speakText(textToSpeak, 'localTipOutput');
                } else {
                    alert(currentLanguage === 'ta' ? 'தயவுசெய்து ஒரு உதவிக்குறிப்பை முதலில் உருவாக்கவும்.' : 'Please generate a tip first.');
                }
            });


            // --- Meal Plan Functionality ---
            const dietGoalInput = document.getElementById('dietGoalInput');
            const dietPreferenceSelect = document.getElementById('dietPreferenceSelect');
            const allergiesInput = document.getElementById('allergiesInput');
            const generateMealPlanBtn = document.getElementById('generateMealPlanBtn');
            const mealPlanOutput = document.getElementById('mealPlanOutput');
            const mealPlanAiVoiceBtn = document.getElementById('mealPlanAiVoiceBtn');
            const dietGoalMicBtn = document.getElementById('dietGoalMicBtn');
            const allergiesMicBtn = document.getElementById('allergiesMicBtn');

            let dietGoalRecognition, allergiesRecognition;

            if ('webkitSpeechRecognition' in window) {
                dietGoalRecognition = new webkitSpeechRecognition();
                dietGoalRecognition.continuous = false;
                dietGoalRecognition.interimResults = false;
                dietGoalRecognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';

                dietGoalRecognition.onstart = () => dietGoalMicBtn.classList.add('recording');
                dietGoalRecognition.onresult = (event) => { dietGoalInput.value = event.results[0][0].transcript; dietGoalMicBtn.classList.remove('recording'); };
                dietGoalRecognition.onerror = () => dietGoalMicBtn.classList.remove('recording');
                dietGoalRecognition.onend = () => dietGoalMicBtn.classList.remove('recording');
                dietGoalMicBtn.addEventListener('click', () => dietGoalRecognition.start());

                allergiesRecognition = new webkitSpeechRecognition();
                allergiesRecognition.continuous = false;
                allergiesRecognition.interimResults = false;
                allergiesRecognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';

                allergiesRecognition.onstart = () => allergiesMicBtn.classList.add('recording');
                allergiesRecognition.onresult = (event) => { allergiesInput.value = event.results[0][0].transcript; allergiesMicBtn.classList.remove('recording'); };
                allergiesRecognition.onerror = () => allergiesMicBtn.classList.remove('recording');
                allergiesRecognition.onend = () => allergiesMicBtn.classList.remove('recording');
                allergiesMicBtn.addEventListener('click', () => allergiesRecognition.start());
            } else {
                dietGoalMicBtn.style.display = 'none';
                allergiesMicBtn.style.display = 'none';
            }

            generateMealPlanBtn.addEventListener('click', () => {
                const dietGoal = dietGoalInput.value.trim();
                const dietPreference = dietPreferenceSelect.value;
                const allergies = allergiesInput.value.trim();

                if (dietGoal && dietPreference) {
                    const query = `Generate a ${dietPreference} meal plan for ${dietGoal}` + (allergies ? ` avoiding ${allergies}` : '');
                    generateTipAndSpeak(query, mealPlanOutput, mealPlanAiVoiceBtn, true);
                } else {
                    mealPlanOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உணவு இலக்கு மற்றும் விருப்பத்தைத் தேர்ந்தெடுக்கவும்.' : 'Please enter a diet goal and select a preference.'}</p>`;
                }
            });

            mealPlanAiVoiceBtn.addEventListener('click', () => {
                const textToSpeak = mealPlanOutput.textContent.trim();
                if (textToSpeak) {
                    speakText(textToSpeak, 'mealPlanOutput');
                } else {
                    alert(currentLanguage === 'ta' ? 'தயவுசெய்து ஒரு உணவுத் திட்டத்தை முதலில் உருவாக்கவும்.' : 'Please generate a meal plan first.');
                }
            });

            // --- Detailed Mood Analysis Functionality ---
            const moodEntryInput = document.getElementById('moodEntryInput');
            const analyzeMoodBtn = document.getElementById('analyzeMoodBtn');
            const moodAnalysisOutputDetailed = document.getElementById('moodAnalysisOutputDetailed');
            const moodAnalysisAiVoiceBtn = document.getElementById('moodAnalysisAiVoiceBtn');

            analyzeMoodBtn.addEventListener('click', () => {
                const moodEntry = moodEntryInput.value.trim();
                if (moodEntry) {
                    // This query is intentionally generic to allow the AI to analyze the mood.
                    generateTipAndSpeak(`Analyze the following mood entry: "${moodEntry}"`, moodAnalysisOutputDetailed, moodAnalysisAiVoiceBtn, true);
                } else {
                    moodAnalysisOutputDetailed.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'பகுப்பாய்வு செய்ய உங்கள் மனநிலை பற்றி எழுதுங்கள்.' : 'Please write about your mood to analyze.'}</p>`;
                }
            });

            moodAnalysisAiVoiceBtn.addEventListener('click', () => {
                const textToSpeak = moodAnalysisOutputDetailed.textContent.trim();
                if (textToSpeak) {
                    speakText(textToSpeak, 'moodAnalysisOutputDetailed');
                } else {
                    alert(currentLanguage === 'ta' ? 'தயவுசெய்து மனநிலை பகுப்பாய்வை முதலில் உருவாக்கவும்.' : 'Please generate a mood analysis first.');
                }
            });

            // --- Exercise & Yoga Functionality ---
            const exerciseGoalInput = document.getElementById('exerciseGoalInput');
            const exerciseGoalMicBtn = document.getElementById('exerciseGoalMicBtn');
            const generateExercisePlanBtn = document.getElementById('generateExercisePlanBtn');
            const exerciseYogaOutput = document.getElementById('exerciseYogaOutput');
            const exerciseYogaAiVoiceBtn = document.getElementById('exerciseYogaAiVoiceBtn');

            let exerciseRecognition;

            if ('webkitSpeechRecognition' in window) {
                exerciseRecognition = new webkitSpeechRecognition();
                exerciseRecognition.continuous = false;
                exerciseRecognition.interimResults = false;
                exerciseRecognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';

                exerciseRecognition.onstart = () => exerciseGoalMicBtn.classList.add('recording');
                exerciseRecognition.onresult = (event) => { exerciseGoalInput.value = event.results[0][0].transcript; exerciseGoalMicBtn.classList.remove('recording'); };
                exerciseRecognition.onerror = () => exerciseGoalMicBtn.classList.remove('recording');
                exerciseRecognition.onend = () => exerciseGoalMicBtn.classList.remove('recording');
                exerciseGoalMicBtn.addEventListener('click', () => exerciseRecognition.start());
            } else {
                exerciseGoalMicBtn.style.display = 'none';
            }

            generateExercisePlanBtn.addEventListener('click', () => {
                const exerciseGoal = exerciseGoalInput.value.trim();
                if (exerciseGoal) {
                    generateTipAndSpeak(`Suggest exercise or yoga routines for ${exerciseGoal}`, exerciseYogaOutput, exerciseYogaAiVoiceBtn, true);
                } else {
                    exerciseYogaOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'உங்கள் உடற்பயிற்சி/யோகா இலக்கை உள்ளிடவும்.' : 'Please enter your exercise/yoga goal.'}</p>`;
                }
            });

            exerciseYogaAiVoiceBtn.addEventListener('click', () => {
                const textToSpeak = exerciseYogaOutput.textContent.trim();
                if (textToSpeak) {
                    speakText(textToSpeak, 'exerciseYogaOutput');
                } else {
                    alert(currentLanguage === 'ta' ? 'தயவுசெய்து ஒரு உடற்பயிற்சி திட்டத்தை முதலில் உருவாக்கவும்.' : 'Please generate an exercise plan first.');
                }
            });

            // --- Disease Prevention Functionality ---
            const diseaseInput = document.getElementById('diseaseInput');
            const diseaseMicBtn = document.getElementById('diseaseMicBtn');
            const generatePreventionTipsBtn = document.getElementById('generatePreventionTipsBtn');
            const diseasePreventionOutput = document.getElementById('diseasePreventionOutput');
            const diseasePreventionAiVoiceBtn = document.getElementById('diseasePreventionAiVoiceBtn');

            let diseaseRecognition;

            if ('webkitSpeechRecognition' in window) {
                diseaseRecognition = new webkitSpeechRecognition();
                diseaseRecognition.continuous = false;
                diseaseRecognition.interimResults = false;
                diseaseRecognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';

                diseaseRecognition.onstart = () => diseaseMicBtn.classList.add('recording');
                diseaseRecognition.onresult = (event) => { diseaseInput.value = event.results[0][0].transcript; diseaseMicBtn.classList.remove('recording'); };
                diseaseRecognition.onerror = () => diseaseMicBtn.classList.remove('recording');
                diseaseRecognition.onend = () => diseaseMicBtn.classList.remove('recording');
                diseaseMicBtn.addEventListener('click', () => diseaseRecognition.start());
            } else {
                diseaseMicBtn.style.display = 'none';
            }

            generatePreventionTipsBtn.addEventListener('click', () => {
                const disease = diseaseInput.value.trim();
                if (disease) {
                    generateTipAndSpeak(`Provide prevention tips for ${disease}`, diseasePreventionOutput, diseasePreventionAiVoiceBtn, true);
                } else {
                    diseasePreventionOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'நோய் அல்லது தடுப்பு குறிப்பை உள்ளிடவும்.' : 'Please enter a disease or prevention keyword.'}</p>`;
                }
            });

            diseasePreventionAiVoiceBtn.addEventListener('click', () => {
                const textToSpeak = diseasePreventionOutput.textContent.trim();
                if (textToSpeak) {
                    speakText(textToSpeak, 'diseasePreventionOutput');
                } else {
                    alert(currentLanguage === 'ta' ? 'தயவுசெய்து தடுப்பு குறிப்புகளை முதலில் உருவாக்கவும்.' : 'Please generate prevention tips first.');
                }
            });

            // --- Wellness Challenge Functionality ---
            const challengeTypeInput = document.getElementById('challengeTypeInput');
            const challengeTypeMicBtn = document.getElementById('challengeTypeMicBtn');
            const generateChallengeBtn = document.getElementById('generateChallengeBtn');
            const wellnessChallengeOutput = document.getElementById('wellnessChallengeOutput');
            const wellnessChallengeAiVoiceBtn = document.getElementById('wellnessChallengeAiVoiceBtn');

            let challengeRecognition;

            if ('webkitSpeechRecognition' in window) {
                challengeRecognition = new webkitSpeechRecognition();
                challengeRecognition.continuous = false;
                challengeRecognition.interimResults = false;
                challengeRecognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';

                challengeRecognition.onstart = () => challengeTypeMicBtn.classList.add('recording');
                challengeRecognition.onresult = (event) => { challengeTypeInput.value = event.results[0][0].transcript; challengeTypeMicBtn.classList.remove('recording'); };
                challengeRecognition.onerror = () => challengeTypeMicBtn.classList.remove('recording');
                challengeRecognition.onend = () => challengeTypeMicBtn.classList.remove('recording');
                challengeTypeMicBtn.addEventListener('click', () => challengeRecognition.start());
            } else {
                challengeTypeMicBtn.style.display = 'none';
            }

            generateChallengeBtn.addEventListener('click', () => {
                const challengeType = challengeTypeInput.value.trim();
                if (challengeType) {
                    generateTipAndSpeak(`Generate a wellness challenge for: ${challengeType}`, wellnessChallengeOutput, wellnessChallengeAiVoiceBtn, true);
                } else {
                    wellnessChallengeOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'சவால் வகையை உள்ளிடவும்.' : 'Please enter a challenge type.'}</p>`;
                }
            });

            wellnessChallengeAiVoiceBtn.addEventListener('click', () => {
                const textToSpeak = wellnessChallengeOutput.textContent.trim();
                if (textToSpeak) {
                    speakText(textToSpeak, 'wellnessChallengeOutput');
                } else {
                    alert(currentLanguage === 'ta' ? 'தயவுசெய்து ஒரு சவாலை முதலில் உருவாக்கவும்.' : 'Please generate a challenge first.');
                }
            });

            // --- Medication Reminder Functionality ---
            const medicationNameInput = document.getElementById('medicationNameInput');
            const medicationTimeInput = document.getElementById('medicationTimeInput');
            const addMedicationReminderBtn = document.getElementById('addMedicationReminderBtn');
            const medicationRemindersList = document.getElementById('medicationRemindersList');
            const alarmModal = document.getElementById('alarmModal');
            const alarmModalTitle = document.getElementById('alarmModalTitle');
            const alarmModalMessage = document.getElementById('alarmModalMessage');
            const dismissAlarmBtn = document.getElementById('dismissAlarmBtn');

            let reminders = [];
            let alarmTimeout; // To store the timeout ID for alarms

            function renderReminders() {
                medicationRemindersList.innerHTML = '';
                if (reminders.length === 0) {
                    medicationRemindersList.innerHTML = `<em>${translations[currentLanguage].noReminders}</em>`;
                    return;
                }
                reminders.sort((a, b) => {
                    const timeA = new Date(`2000/01/01 ${a.time}`);
                    const timeB = new Date(`2000/01/01 ${b.time}`);
                    return timeA - timeB;
                });

                reminders.forEach((reminder, index) => {
                    const li = document.createElement('li');
                    li.className = 'flex justify-between items-center py-2 border-b last:border-b-0';
                    li.innerHTML = `
                        <span>${reminder.name} at ${reminder.time}</span>
                        <button class="text-red-500 hover:text-red-700 font-bold ml-4" data-index="${index}">X</button>
                    `;
                    medicationRemindersList.appendChild(li);
                });
                // Add event listeners for new delete buttons
                medicationRemindersList.querySelectorAll('button').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const index = event.target.dataset.index;
                        reminders.splice(index, 1);
                        saveReminders();
                        renderReminders();
                    });
                });
            }

            function saveReminders() {
                localStorage.setItem('medicationReminders', JSON.stringify(reminders));
                setAlarms(); // Recalculate alarms after saving
            }

            function loadReminders() {
                const storedReminders = localStorage.getItem('medicationReminders');
                if (storedReminders) {
                    reminders = JSON.parse(storedReminders);
                    renderReminders();
                    setAlarms();
                }
            }

            function setAlarms() {
                // Clear any existing alarm timeouts
                if (alarmTimeout) {
                    clearTimeout(alarmTimeout);
                }

                const now = new Date();
                let nearestAlarmTime = null;

                reminders.forEach(reminder => {
                    const [hour, minute] = reminder.time.split(':').map(Number);
                    const alarmDate = new Date();
                    alarmDate.setHours(hour, minute, 0, 0);

                    // If the alarm time has already passed today, set it for tomorrow
                    if (alarmDate <= now) {
                        alarmDate.setDate(alarmDate.getDate() + 1);
                    }

                    if (nearestAlarmTime === null || alarmDate < nearestAlarmTime) {
                        nearestAlarmTime = alarmDate;
                    }
                });

                if (nearestAlarmTime) {
                    const delay = nearestAlarmTime.getTime() - now.getTime();
                    console.log(`Setting alarm for ${nearestAlarmTime} in ${delay / 1000} seconds`);

                    alarmTimeout = setTimeout(() => {
                        playAlarmSound();
                        alarmModalTitle.textContent = translations[currentLanguage].alarmModalTitle;
                        alarmModalMessage.textContent = translations[currentLanguage].alarmModalMessage;
                        alarmModal.classList.add('show');
                        // After alarm, remove it from the list (or reschedule for next day if recurring feature is added)
                        // For now, it will just ring once and stay in the list until manually dismissed.
                        // In a real app, you'd likely remove it or mark as taken.
                    }, delay);
                }
            }

            function playAlarmSound() {
                // Play a simple tone
                synthTone.triggerAttackRelease("C4", "8n");
            }

            addMedicationReminderBtn.addEventListener('click', () => {
                const name = medicationNameInput.value.trim();
                const time = medicationTimeInput.value;

                if (name && time) {
                    reminders.push({ name, time });
                    saveReminders();
                    renderReminders();
                    medicationNameInput.value = '';
                    medicationTimeInput.value = '';
                } else {
                    alert(currentLanguage === 'ta' ? 'மருந்தின் பெயர் மற்றும் நேரத்தை உள்ளிடவும்.' : 'Please enter medication name and time.');
                }
            });

            dismissAlarmBtn.addEventListener('click', () => {
                alarmModal.classList.remove('show');
                synthTone.triggerRelease(); // Stop sound
            });

            loadReminders(); // Load reminders when the page loads

            // --- Body Pain Mapping Functionality ---
            const bodyMapImage = document.getElementById('bodyMapImage');
            const painDotsContainer = document.getElementById('painDotsContainer');
            const painDescriptionInput = document.getElementById('painDescriptionInput');
            const addPainEntryBtn = document.getElementById('addPainEntryBtn');
            const painEntriesList = document.getElementById('painEntriesList');
            const analyzePainEntriesBtn = document.getElementById('analyzePainEntriesBtn');
            const painAnalysisOutput = document.getElementById('painAnalysisOutput');
            const painAnalysisAiVoiceBtn = document.getElementById('painAnalysisAiVoiceBtn');

            let painEntries = [];
            let selectedPainDot = null; // To keep track of the currently selected dot

            function renderPainEntries() {
                painEntriesList.innerHTML = '';
                if (painEntries.length === 0) {
                    painEntriesList.innerHTML = `<em>${translations[currentLanguage].noPainEntries}</em>`;
                    return;
                }
                painEntries.forEach((entry, index) => {
                    const li = document.createElement('li');
                    li.className = 'flex justify-between items-center py-2 border-b last:border-b-0';
                    li.innerHTML = `
                        <span>${entry.location} (${entry.x.toFixed(2)}, ${entry.y.toFixed(2)}): ${entry.description}</span>
                        <button class="text-red-500 hover:text-red-700 font-bold ml-4" data-index="${index}">X</button>
                    `;
                    painEntriesList.appendChild(li);
                });
                painEntriesList.querySelectorAll('button').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const index = event.target.dataset.index;
                        painEntries.splice(index, 1);
                        renderPainDots(); // Re-render dots as well
                        savePainEntries();
                        renderPainEntries();
                    });
                });
            }

            function savePainEntries() {
                localStorage.setItem('bodyPainEntries', JSON.stringify(painEntries));
            }

            function loadPainEntries() {
                const storedEntries = localStorage.getItem('bodyPainEntries');
                if (storedEntries) {
                    painEntries = JSON.parse(storedEntries);
                    renderPainDots();
                    renderPainEntries();
                }
            }

            function renderPainDots() {
                painDotsContainer.innerHTML = ''; // Clear existing dots
                painEntries.forEach((entry, index) => {
                    const dot = document.createElement('div');
                    dot.className = 'pain-dot';
                    dot.style.left = `${entry.x * 100}%`;
                    dot.style.top = `${entry.y * 100}%`;
                    dot.dataset.index = index;
                    dot.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent click on image
                        // Deselect previous dot
                        if (selectedPainDot) {
                            selectedPainDot.classList.remove('selected');
                        }
                        // Select current dot
                        dot.classList.add('selected');
                        selectedPainDot = dot;
                        // Populate description for editing
                        painDescriptionInput.value = entry.description;
                    });
                    painDotsContainer.appendChild(dot);
                });
            }

            bodyMapImage.addEventListener('click', (event) => {
                const rect = bodyMapImage.getBoundingClientRect();
                const x = (event.clientX - rect.left) / rect.width;
                const y = (event.clientY - rect.top) / rect.height;

                // Deselect previous dot if new one is being added
                if (selectedPainDot) {
                    selectedPainDot.classList.remove('selected');
                    selectedPainDot = null;
                }

                // Add a new entry when clicking on the map
                painEntries.push({ x, y, description: '', location: 'Body' }); // Default location, can be refined
                savePainEntries();
                renderPainDots();
                renderPainEntries(); // Update list to show new empty entry
                painDescriptionInput.value = ''; // Clear description input
            });

            addPainEntryBtn.addEventListener('click', () => {
                if (selectedPainDot) {
                    const index = selectedPainDot.dataset.index;
                    painEntries[index].description = painDescriptionInput.value.trim();
                    painEntries[index].location = 'Body Area ' + (parseInt(index) + 1); // Simple naming
                    savePainEntries();
                    renderPainEntries();
                    painDescriptionInput.value = '';
                    selectedPainDot.classList.remove('selected');
                    selectedPainDot = null;
                } else {
                    alert(currentLanguage === 'ta' ? 'வரைபடத்தில் ஒரு வலிப் புள்ளியைத் தேர்ந்தெடுத்து விளக்கத்தைச் சேர்க்கவும்.' : 'Please select a pain dot on the map and add a description.');
                }
            });

            analyzePainEntriesBtn.addEventListener('click', () => {
                if (painEntries.length === 0) {
                    painAnalysisOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'பகுப்பாய்வு செய்ய வலி பதிவுகள் இல்லை.' : 'No pain entries to analyze.'}</p>`;
                    return;
                }
                const painData = painEntries.map(entry => `${entry.location}: ${entry.description}`).join('; ');
                generateTipAndSpeak(`Analyze the following pain entries: ${painData}. Provide potential causes or general advice.`, painAnalysisOutput, painAnalysisAiVoiceBtn, true);
            });

            painAnalysisAiVoiceBtn.addEventListener('click', () => {
                const textToSpeak = painAnalysisOutput.textContent.trim();
                if (textToSpeak) {
                    speakText(textToSpeak, 'painAnalysisOutput');
                } else {
                    alert(currentLanguage === 'ta' ? 'தயவுசெய்து வலி பகுப்பாய்வை முதலில் உருவாக்கவும்.' : 'Please generate pain analysis first.');
                }
            });

            loadPainEntries(); // Load pain entries when the page loads

            // --- First Aid & Emergency Functionality ---
            const emergencyInput = document.getElementById('emergencyInput');
            const emergencyMicBtn = document.getElementById('emergencyMicBtn');
            const getEmergencyInfoBtn = document.getElementById('getEmergencyInfoBtn');
            const emergencyInfoOutput = document.getElementById('emergencyInfoOutput');
            const emergencyInfoAiVoiceBtn = document.getElementById('emergencyInfoAiVoiceBtn');

            let emergencyRecognition;

            if ('webkitSpeechRecognition' in window) {
                emergencyRecognition = new webkitSpeechRecognition();
                emergencyRecognition.continuous = false;
                emergencyRecognition.interimResults = false;
                emergencyRecognition.lang = currentLanguage === 'ta' ? 'ta-IN' : 'en-US';

                emergencyRecognition.onstart = () => emergencyMicBtn.classList.add('recording');
                emergencyRecognition.onresult = (event) => { emergencyInput.value = event.results[0][0].transcript; emergencyMicBtn.classList.remove('recording'); };
                emergencyRecognition.onerror = () => emergencyMicBtn.classList.remove('recording');
                emergencyRecognition.onend = () => emergencyMicBtn.classList.remove('recording');
                emergencyMicBtn.addEventListener('click', () => emergencyRecognition.start());
            } else {
                emergencyMicBtn.style.display = 'none';
            }

            getEmergencyInfoBtn.addEventListener('click', () => {
                const emergencyTopic = emergencyInput.value.trim();
                if (emergencyTopic) {
                    generateTipAndSpeak(`Provide first aid or emergency information for: ${emergencyTopic}`, emergencyInfoOutput, emergencyInfoAiVoiceBtn, true);
                } else {
                    emergencyInfoOutput.innerHTML = `<p class="text-red-600">${currentLanguage === 'ta' ? 'அவசர நிலை அல்லது முதலுதவி தலைப்பை உள்ளிடவும்.' : 'Please enter an emergency or first aid topic.'}</p>`;
                }
            });

            emergencyInfoAiVoiceBtn.addEventListener('click', () => {
                const textToSpeak = emergencyInfoOutput.textContent.trim();
                if (textToSpeak) {
                    speakText(textToSpeak, 'emergencyInfoOutput');
                } else {
                    alert(currentLanguage === 'ta' ? 'தயவுசெய்து அவசர தகவல்களை முதலில் உருவாக்கவும்.' : 'Please generate emergency information first.');
                }
            });
        });
    </script>
</body>
</html>
